# NexusBook æ–‡æ¡£æ¨¡å‹è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

NexusBook çš„**æ–‡æ¡£æ¨¡å‹**æ˜¯ä¸€ä¸ªçµæ´»ã€é«˜åº¦å¯æ‰©å±•çš„æŠ½è±¡æ¡†æ¶ï¼Œç”¨äºç®¡ç†ç»“æ„åŒ–æ•°æ®æ–‡æ¡£ã€‚æ— è®ºæ˜¯è®¢è´§å•ã€å‘ç¥¨ã€äº§å“æ¸…å•ã€é¡¹ç›®è®¡åˆ’ç­‰ä»»ä½•ç±»å‹çš„è¡¨æ ¼å‹æ–‡æ¡£ï¼Œéƒ½å¯ä»¥é€šè¿‡è¿™ä¸ªç»Ÿä¸€çš„æ¨¡å‹æ¥ç®¡ç†ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Document Bundle                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Properties   â”‚  â”‚   Metadata   â”‚  â”‚    Views     â”‚       â”‚
â”‚  â”‚ (è®¢å•æ—¶é—´ã€   â”‚  â”‚  (å­—æ®µé…ç½®)   â”‚  â”‚  (è§†å›¾å®šä¹‰)   â”‚       â”‚
â”‚  â”‚  é—¨åº—ã€é‡‘é¢)  â”‚  â”‚              â”‚  â”‚              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 Data (è¡Œé›†åˆ)                           â”‚ â”‚
â”‚  â”‚  - åˆ—è¡¨è¡Œï¼ˆæœ€æ ¸å¿ƒçš„æ•°æ®ï¼‰                                â”‚ â”‚
â”‚  â”‚  - æ”¯æŒåˆ›å»º/æ›´æ–°/åˆ é™¤/æŸ¥è¯¢                               â”‚ â”‚
â”‚  â”‚  - æ”¯æŒæ‰¹é‡æ“ä½œ                                          â”‚ â”‚
â”‚  â”‚  - æ”¯æŒåˆ†é¡µ                                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Comments    â”‚  â”‚  Revisions   â”‚  â”‚   Settings   â”‚       â”‚
â”‚  â”‚  (è¯„è®ºè®¨è®º)   â”‚  â”‚  (ä¿®è®¢å†å²)   â”‚  â”‚  (æ–‡æ¡£è®¾ç½®)   â”‚       â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚              â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ ¸å¿ƒå±‚æ¬¡ç»“æ„

### 1. Propertiesï¼ˆæ–‡æ¡£å±æ€§ï¼‰- å…ƒä¿¡æ¯å±‚

å­˜å‚¨**æ–‡æ¡£æœ¬èº«çš„å±æ€§ä¿¡æ¯**ï¼Œä¸åŒäºæ•°æ®è¡Œçš„å†…å®¹ã€‚

#### ç”¨é€”
- **è®¢è´§å•**ï¼šè®¢å•æ—¶é—´ã€é—¨åº—ã€æ€»é‡‘é¢ã€æ€»æ•°é‡ã€çŠ¶æ€ã€å¤‡æ³¨
- **å‘ç¥¨**ï¼šå‘ç¥¨å·ã€å¼€ç¥¨æ—¶é—´ã€ä»˜æ¬¾æœŸé™ã€ç¨ç‡ã€æ”¶æ¬¾æ–¹ä¿¡æ¯
- **äº§å“**ï¼šSKUã€å“ç‰Œã€åˆ†ç±»ã€ä¾›åº”å•†ã€ç”Ÿäº§æ—¥æœŸ
- **é¡¹ç›®**ï¼šé¡¹ç›®åç§°ã€è´Ÿè´£äººã€é¢„ç®—ã€æˆªæ­¢æ—¥æœŸã€ä¼˜å…ˆçº§

#### æ•°æ®ç»“æ„
```typescript
model DocumentProperties {
  id: string;              // å±æ€§è®°å½•ID
  docId: string;           // æ–‡æ¡£ID
  docType: string;         // æ–‡æ¡£ç±»å‹ï¼ˆpurchaseOrder, invoiceç­‰ï¼‰
  
  properties?: {           // çµæ´»çš„é”®å€¼å¯¹å¯¹è±¡
    [key: string]: any     // æ”¯æŒä»»æ„å±æ€§
  };
  
  version?: int64;         // å¹¶å‘æ§åˆ¶ç‰ˆæœ¬å·
  createdAt?: string;      // åˆ›å»ºæ—¶é—´
  updatedAt?: string;      // æ›´æ–°æ—¶é—´
  updatedBy?: string;      // æœ€åä¿®æ”¹äºº
}
```

#### API ç«¯ç‚¹
```
GET    /doc/{docType}/{docId}/properties          # è·å–å±æ€§
POST   /doc/{docType}/{docId}/properties          # åˆ›å»ºå±æ€§
PUT    /doc/{docType}/{docId}/properties          # æ›¿æ¢å±æ€§ï¼ˆå…¨é‡ï¼‰
PATCH  /doc/{docType}/{docId}/properties          # æ›´æ–°å±æ€§ï¼ˆéƒ¨åˆ†ï¼‰
GET    /doc/{docType}/{docId}/properties/history  # æŸ¥çœ‹å±æ€§å†å²
DELETE /doc/{docType}/{docId}/properties          # åˆ é™¤å±æ€§
```

#### ç¤ºä¾‹ï¼šè®¢è´§å•å±æ€§
```bash
# åˆ›å»ºè®¢è´§å•å±æ€§
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/properties' \
  -H 'Authorization: Bearer TOKEN' \
  -H 'Content-Type: application/json' \
  -d '{
    "id": "prop-001",
    "docId": "order-123",
    "docType": "purchaseOrder",
    "properties": {
      "orderTime": "2024-12-01T10:00:00Z",
      "store": "Beijing Branch",
      "amount": 5000.00,
      "quantity": 50,
      "status": "pending",
      "notes": "Urgent delivery required"
    }
  }'

# éƒ¨åˆ†æ›´æ–°å±æ€§ï¼ˆä»…æ›´æ–°é‡‘é¢å’Œæ•°é‡ï¼‰
curl -X PATCH 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/properties?merge=true' \
  -H 'Authorization: Bearer TOKEN' \
  -d '{
    "properties": {
      "amount": 6000.00,
      "quantity": 60
    }
  }'
```

### 2. Metadataï¼ˆå…ƒæ•°æ®ï¼‰- å­—æ®µå®šä¹‰å±‚

å®šä¹‰æ–‡æ¡£çš„**å­—æ®µç»“æ„**ï¼Œæè¿°æ¯ä¸ªå­—æ®µçš„ç±»å‹ã€éªŒè¯è§„åˆ™ã€æ˜¾ç¤ºæ–¹å¼ç­‰ã€‚

#### ç”¨é€”
- å®šä¹‰æ–‡æ¡£åŒ…å«å“ªäº›å­—æ®µï¼ˆå¦‚è®¢è´§å•çš„"äº§å“åç§°""æ•°é‡""å•ä»·"ç­‰ï¼‰
- æŒ‡å®šå­—æ®µçš„æ•°æ®ç±»å‹ï¼ˆæ–‡æœ¬ã€æ•°å­—ã€æ—¥æœŸã€é€‰æ‹©ç­‰ï¼‰
- é…ç½®å­—æ®µçš„éªŒè¯è§„åˆ™ã€æ˜¾ç¤ºåç§°ã€å¸®åŠ©æç¤ºç­‰
- å®šä¹‰å­—æ®µçš„è¯»å†™æƒé™

#### æ•°æ®ç»“æ„æ¦‚è§ˆ
```typescript
model Metadata {
  id: string;              // å…ƒæ•°æ®ID
  docId: string;
  docType: string;
  
  fields?: Field[];        // å­—æ®µå®šä¹‰æ•°ç»„
  version?: int64;
  createdAt?: string;
  updatedAt?: string;
}

model Field {
  id: string;              // å­—æ®µIDï¼ˆåœ¨è¡¨å•ä¸­ä½œä¸ºcolumnï¼‰
  name: string;            // å­—æ®µæ˜¾ç¤ºå
  type: "text" | "number" | "date" | "select" | ...;
  required?: boolean;
  pattern?: string;        // éªŒè¯æ­£åˆ™
  description?: string;    // å­—æ®µè¯´æ˜
}
```

#### ç¤ºä¾‹
```json
{
  "id": "meta-order-123",
  "docId": "order-123",
  "docType": "purchaseOrder",
  "fields": [
    {
      "id": "productName",
      "name": "äº§å“åç§°",
      "type": "text",
      "required": true
    },
    {
      "id": "quantity",
      "name": "æ•°é‡",
      "type": "number",
      "required": true,
      "pattern": "^[1-9]\\d*$"
    },
    {
      "id": "price",
      "name": "å•ä»·",
      "type": "number",
      "required": true
    }
  ]
}
```

### 3. Dataï¼ˆæ•°æ®ï¼‰- å†…å®¹å±‚

å­˜å‚¨**å®é™…çš„æ•°æ®è¡Œ**ï¼Œè¿™æ˜¯æ–‡æ¡£çš„æ ¸å¿ƒå†…å®¹ã€‚

#### ç”¨é€”
- è®¢è´§å•çš„æ¯ä¸€ä¸ªè®¢å•é¡¹ï¼ˆäº§å“åç§°ã€æ•°é‡ã€å•ä»·ç­‰ï¼‰
- å‘ç¥¨çš„æ¯ä¸€æ¡æ˜ç»†è¡Œ
- åº“å­˜è¡¨çš„æ¯ä¸€æ¡äº§å“è®°å½•
- é¡¹ç›®è®¡åˆ’çš„æ¯ä¸€ä¸ªä»»åŠ¡è¡Œ

#### æ•°æ®ç»“æ„
```typescript
model Row {
  id: string;              // è¡ŒID
  
  values: {                // å­—æ®µå€¼é›†åˆ
    fieldId: string;       // å­—æ®µIDï¼ˆå¯¹åº”Metadataä¸­å®šä¹‰ï¼‰
    value: {               // å®é™…å€¼ï¼Œæ”¯æŒå¤šç§ç±»å‹
      text?: string;
      number?: number;
      date?: string;
      select?: string;
    };
  }[];
  
  version?: int64;         // ç”¨äºå¹¶å‘æ§åˆ¶
  createdAt?: string;
  createdBy?: string;
  updatedAt?: string;
  updatedBy?: string;
}
```

#### API ç«¯ç‚¹
```
GET    /doc/{docType}/{docId}/rows                          # æŸ¥è¯¢è¡Œï¼ˆåˆ†é¡µï¼‰
POST   /doc/{docType}/{docId}/rows                          # åˆ›å»ºè¡Œ
PUT    /doc/{docType}/{docId}/rows/{rowId}                  # æ›´æ–°è¡Œ
DELETE /doc/{docType}/{docId}/rows/{rowId}                  # åˆ é™¤è¡Œ

POST   /doc/{docType}/{docId}/rows/batch-create             # æ‰¹é‡åˆ›å»º
POST   /doc/{docType}/{docId}/rows/batch-update             # æ‰¹é‡æ›´æ–°
POST   /doc/{docType}/{docId}/rows/batch-delete             # æ‰¹é‡åˆ é™¤
```

#### ç¤ºä¾‹
```bash
# åˆ›å»ºä¸€è¡Œæ•°æ®
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/rows' \
  -H 'Authorization: Bearer TOKEN' \
  -d '{
    "values": [
      {
        "fieldId": "productName",
        "value": { "text": "iPhone 15" }
      },
      {
        "fieldId": "quantity",
        "value": { "number": 10 }
      },
      {
        "fieldId": "price",
        "value": { "number": 799.99 }
      }
    ]
  }'

# æ‰¹é‡åˆ›å»º100æ¡æ•°æ®
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/rows/batch-create' \
  -H 'Authorization: Bearer TOKEN' \
  -d '{
    "rows": [
      { "values": [...] },
      { "values": [...] },
      ...
    ]
  }'
```

### 4. Viewsï¼ˆè§†å›¾ï¼‰- å±•ç¤ºå±‚

å®šä¹‰**ä¸åŒçš„æ•°æ®å±•ç¤ºæ–¹å¼**ã€‚åŒä¸€ä»½æ•°æ®å¯ä»¥ç”¨å¤šç§è§†å›¾å±•ç¤ºã€‚

#### ç”¨é€”
- **è¡¨æ ¼è§†å›¾**ï¼šæ ‡å‡†è¡Œåˆ—è¡¨å±•ç¤º
- **çœ‹æ¿è§†å›¾**ï¼šæŒ‰çŠ¶æ€åˆ†ç±»å±•ç¤º
- **æ—¥å†è§†å›¾**ï¼šæŒ‰æ—¥æœŸç»„ç»‡
- **ç»Ÿè®¡è§†å›¾**ï¼šæ•°æ®æ±‡æ€»å±•ç¤º
- **è‡ªå®šä¹‰è§†å›¾**ï¼šç”¨æˆ·å®šä¹‰çš„è¿‡æ»¤/æ’åº/åˆ†ç»„æ–¹å¼

#### æ•°æ®ç»“æ„æ¦‚è§ˆ
```typescript
model View {
  id: string;              // è§†å›¾ID
  name: string;            // è§†å›¾åç§°
  type: "table" | "kanban" | "calendar" | "chart" | ...;
  
  config?: {               // è§†å›¾é…ç½®
    columns?: string[];    // æ˜¾ç¤ºçš„å­—æ®µ
    filters?: Filter[];    // è¿‡æ»¤æ¡ä»¶
    sort?: SortField[];    // æ’åºè§„åˆ™
    groupBy?: string;      // åˆ†ç»„å­—æ®µ
  };
}
```

#### ç¤ºä¾‹
```json
{
  "id": "view-pending",
  "name": "å¾…å¤„ç†è®¢å•",
  "type": "table",
  "config": {
    "columns": ["productName", "quantity", "price"],
    "filters": [
      {
        "fieldId": "status",
        "operator": "equals",
        "value": "pending"
      }
    ],
    "sort": [
      {
        "fieldId": "orderTime",
        "direction": "desc"
      }
    ]
  }
}
```

### 5. Commentsï¼ˆè¯„è®ºï¼‰- åä½œå±‚

åœ¨**ä»»ä½•ä½ç½®**ï¼ˆæ–‡æ¡£ã€å­—æ®µã€è¡Œã€å•å…ƒæ ¼ï¼‰æ·»åŠ **è¯„è®ºã€è®¨è®ºå’Œåé¦ˆ**ã€‚

#### ç”¨é€”
- å¯¹æ•´ä¸ªè®¢è´§å•è¿›è¡Œè®¨è®º
- å¯¹æŸä¸€è¡Œäº§å“æå‡ºé—®é¢˜
- å¯¹æŸä¸ªå­—æ®µå€¼è¿›è¡Œè¯„è®º
- å¯¹æŸä¸ªå•å…ƒæ ¼æ ‡è®°é—®é¢˜

#### æ ¸å¿ƒç‰¹æ€§
- **ç²¾ç¡®å®šä½**ï¼šæ”¯æŒåœ¨æ–‡æ¡£/å­—æ®µ/è¡Œ/å•å…ƒæ ¼çº§åˆ«è¯„è®º
- **è¯„è®ºçº¿ç¨‹**ï¼šé€šè¿‡ `parentId` å½¢æˆå›å¤é“¾
- **è¡¨æƒ…ååº”**ï¼šå¯ä»¥å¯¹è¯„è®ºæ·»åŠ  emoji ååº”
- **è§£å†³çŠ¶æ€**ï¼šæ ‡è®°è¯„è®ºæ˜¯å¦å·²è§£å†³

#### æ•°æ®ç»“æ„æ¦‚è§ˆ
```typescript
model Comment {
  id: string;
  
  target: {                // è¯„è®ºä½ç½®ï¼ˆç²¾ç¡®åˆ°å„å±‚çº§ï¼‰
    scope: "document" | "field" | "row" | "cell";
    fieldId?: string;
    rowId?: string;
  };
  
  parentId?: string;       // å›å¤çš„è¯„è®ºIDï¼ˆç”¨äºçº¿ç¨‹ï¼‰
  content: string;         // è¯„è®ºå†…å®¹
  mentions?: string[];     // @æåŠçš„ç”¨æˆ·
  
  reactions?: {            // emojiè¡¨æƒ…ååº”
    emoji: string;         // è¡¨æƒ…ç¬¦å·
    users: string[];       // æ·»åŠ ååº”çš„ç”¨æˆ·
    count: int32;
  }[];
  
  resolved?: boolean;      // æ˜¯å¦å·²è§£å†³
  replyCount?: int32;      // å›å¤æ•°é‡
  
  createdAt?: string;
  createdBy?: string;
}
```

#### API ç«¯ç‚¹
```
GET    /doc/{docType}/{docId}/comments                       # æŸ¥è¯¢è¯„è®º
POST   /doc/{docType}/{docId}/comments                       # åˆ›å»ºè¯„è®º
PUT    /doc/{docType}/{docId}/comments/{commentId}           # æ›´æ–°è¯„è®º
DELETE /doc/{docType}/{docId}/comments/{commentId}           # åˆ é™¤è¯„è®º

POST   /doc/{docType}/{docId}/comments/{commentId}/pin       # ç½®é¡¶è¯„è®º
POST   /doc/{docType}/{docId}/comments/{commentId}/resolve   # æ ‡è®°è§£å†³
POST   /doc/{docType}/{docId}/comments/{commentId}/reactions # æ·»åŠ ååº”
```

#### ç¤ºä¾‹
```bash
# å¯¹æ•´ä¸ªæ–‡æ¡£è¿›è¡Œè¯„è®º
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/comments' \
  -H 'Authorization: Bearer TOKEN' \
  -d '{
    "content": "è¯·å°½å¿«å¤„ç†è¿™ä¸ªè®¢å•",
    "target": {
      "scope": "document"
    },
    "mentions": ["@user-456"]
  }'

# å¯¹æŸä¸€è¡Œè¿›è¡Œè¯„è®º
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/comments' \
  -d '{
    "content": "è¿™è¡Œçš„æ•°é‡ä¼¼ä¹æœ‰è¯¯",
    "target": {
      "scope": "row",
      "rowId": "row-001"
    }
  }'

# å¯¹æŸä¸ªå•å…ƒæ ¼è¿›è¡Œè¯„è®º
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/comments' \
  -d '{
    "content": "å•ä»·éœ€è¦ç¡®è®¤",
    "target": {
      "scope": "cell",
      "rowId": "row-001",
      "fieldId": "price"
    }
  }'

# å›å¤æŸä¸ªè¯„è®ºï¼ˆçº¿ç¨‹ï¼‰
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/comments' \
  -d '{
    "content": "æˆ‘æ¥æ£€æŸ¥ä¸€ä¸‹",
    "parentId": "comment-001"
  }'

# å¯¹è¯„è®ºæ·»åŠ è¡¨æƒ…ååº”
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/comments/comment-001/reactions' \
  -d '{
    "emoji": "ğŸ‘"
  }'
```

### 6. Revisionsï¼ˆä¿®è®¢ï¼‰- ç‰ˆæœ¬æ§åˆ¶å±‚

è®°å½•æ–‡æ¡£**æ‰€æœ‰çš„å˜æ›´å†å²**ï¼Œæ”¯æŒç‰ˆæœ¬æ¯”å¯¹å’Œå›æ»šã€‚

#### ç”¨é€”
- è·Ÿè¸ªè°åœ¨ä»€ä¹ˆæ—¶å€™ä¿®æ”¹äº†ä»€ä¹ˆ
- å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚
- å®¡è®¡å®Œæ•´çš„å˜æ›´å†å²
- å¿…è¦æ—¶å›æ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬

#### æ ¸å¿ƒç‰¹æ€§
- **å®Œæ•´è®°å½•**ï¼šè®°å½•æ¯ä¸€ä¸ªæ“ä½œï¼ˆåˆ›å»º/æ›´æ–°/åˆ é™¤ï¼‰
- **å¤šäººåä½œ**ï¼šè®°å½•æ‰€æœ‰å‚ä¸ç¼–è¾‘çš„äººå‘˜
- **è¯·æ±‚å…³è”**ï¼šä¿®è®¢ç”±åˆå¹¶è¯·æ±‚è‡ªåŠ¨ç”Ÿæˆ
- **é“¾å¼å†å²**ï¼šé€šè¿‡ `previousRevisionId` å¿«é€Ÿå¯¼èˆª

#### æ•°æ®ç»“æ„æ¦‚è§ˆ
```typescript
model ChangeOperation {
  id: string;
  
  type: string;            // æ“ä½œç±»å‹ï¼šrow-create/update/deleteç­‰
  
  target: {                // æ“ä½œç›®æ ‡ä½ç½®
    kind: string;
    rowId?: string;
    fieldId?: string;
  };
  
  oldValue?: any;          // ä¿®æ”¹å‰çš„å€¼
  newValue?: any;          // ä¿®æ”¹åçš„å€¼
  operator?: string;       // æ“ä½œäºº
  timestamp?: string;      // æ“ä½œæ—¶é—´
  note?: string;           // æ“ä½œè¯´æ˜
}

model Revision {
  id: string;
  version: int64;          // ç‰ˆæœ¬å·
  
  requestId?: string;      // æºåˆå¹¶è¯·æ±‚ID
  title?: string;
  description?: string;
  
  contributors?: string[]; // æ‰€æœ‰è´¡çŒ®è€…
  mergedBy?: string;       // åˆå¹¶æ‰§è¡Œè€…
  
  changes?: ChangeOperation[];  // æ‰€æœ‰å˜æ›´æ“ä½œ
  
  stats?: {                // ç»Ÿè®¡ä¿¡æ¯
    rowsCreated?: int32;
    rowsUpdated?: int32;
    rowsDeleted?: int32;
    fieldsCreated?: int32;
    fieldsUpdated?: int32;
    fieldsDeleted?: int32;
  };
  
  previousRevisionId?: string;  // å‰ä¸€ä¸ªä¿®è®¢ID
  createdAt?: string;
}
```

#### API ç«¯ç‚¹
```
GET    /doc/{docType}/{docId}/revisions                      # æŸ¥è¯¢ä¿®è®¢å†å²
GET    /doc/{docType}/{docId}/revisions/{revId}              # è·å–ä¿®è®¢è¯¦æƒ…
GET    /doc/{docType}/{docId}/revisions/{revId}/operations   # æŸ¥çœ‹ä¿®è®¢ä¸­çš„æ‰€æœ‰æ“ä½œ
GET    /doc/{docType}/{docId}/revisions/{revId}/diff         # å¯¹æ¯”ä¸¤ä¸ªä¿®è®¢
GET    /doc/{docType}/{docId}/revisions/history              # æŸ¥è¯¢ç‰¹å®šå¯¹è±¡çš„å˜æ›´å†å²
POST   /doc/{docType}/{docId}/revisions/{revId}/revert       # å›æ»šåˆ°æŒ‡å®šä¿®è®¢
```

#### ç¤ºä¾‹
```bash
# æŸ¥çœ‹ä¿®è®¢å†å²
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/revisions' \
  -H 'Authorization: Bearer TOKEN'

# å¯¹æ¯”ä¸¤ä¸ªä¿®è®¢ä¹‹é—´çš„å·®å¼‚
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/revisions/rev-002/diff?base=rev-001' \
  -H 'Authorization: Bearer TOKEN'

# æŸ¥è¯¢æŸè¡Œçš„å®Œæ•´å˜æ›´å†å²
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/revisions/history?targetKind=row&rowId=row-001' \
  -H 'Authorization: Bearer TOKEN'

# å›æ»šåˆ°æŒ‡å®šä¿®è®¢
curl -X POST 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/revisions/rev-001/revert' \
  -H 'Authorization: Bearer TOKEN' \
  -d '{
    "reason": "æ¢å¤åˆ°ä¹‹å‰çš„çŠ¶æ€"
  }'
```

### 7. Settingsï¼ˆè®¾ç½®ï¼‰- é…ç½®å±‚

æ–‡æ¡£çº§åˆ«çš„**é…ç½®å’Œé€‰é¡¹**ã€‚

#### ç”¨é€”
- æ–‡æ¡£çš„è®¿é—®æƒé™
- é€šçŸ¥è®¾ç½®
- å·¥ä½œæµé…ç½®
- è‡ªå®šä¹‰è§„åˆ™

#### ç¤ºä¾‹
```json
{
  "id": "settings-order-123",
  "docType": "purchaseOrder",
  "permissions": {
    "view": ["user-1", "team-1"],
    "edit": ["user-1", "user-2"],
    "delete": ["user-1"],
    "share": ["user-1"]
  },
  "notifications": {
    "onCommentAdd": true,
    "onDataChange": true,
    "onMerge": true
  },
  "workflow": {
    "requiresApproval": true,
    "approvers": ["user-manager"]
  }
}
```

## èšåˆæŸ¥è¯¢ï¼ˆDocBundleï¼‰

### æ¦‚å¿µ
ä¸€æ¬¡æ€§è·å–æ–‡æ¡£çš„å¤šä¸ªå±‚æ¬¡çš„æ•°æ®ï¼Œé¿å…å¤šæ¬¡è¯·æ±‚ã€‚

### ä½¿ç”¨åœºæ™¯
- é¡µé¢åˆå§‹åŒ–ï¼šåŠ è½½æ–‡æ¡£çš„æ‰€æœ‰å¿…è¦ä¿¡æ¯
- æ–‡æ¡£é¢„è§ˆï¼šå¿«é€Ÿè·å–æ–‡æ¡£æ‘˜è¦
- æ•°æ®å¯¼å‡ºï¼šæ”¶é›†å®Œæ•´çš„æ–‡æ¡£æ•°æ®

### è¯·æ±‚ç¤ºä¾‹

```bash
# è·å–å®Œæ•´çš„è®¢è´§å•ä¿¡æ¯
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123?include=properties,metadata,views,data,comments,revisions,settings&page=1&pageSize=20' \
  -H 'Authorization: Bearer TOKEN'

# åªè·å–å…ƒæ•°æ®å’Œæ•°æ®
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123?include=metadata,data&page=1&pageSize=50' \
  -H 'Authorization: Bearer TOKEN'

# è·å–å±æ€§å’Œæœ€è¿‘çš„è¯„è®º/ä¿®è®¢
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123?include=properties,comments,revisions&commentsLimit=5&revisionsLimit=3' \
  -H 'Authorization: Bearer TOKEN'
```

### å“åº”ç¤ºä¾‹
```json
{
  "properties": {
    "id": "prop-001",
    "docId": "order-123",
    "properties": {
      "orderTime": "2024-12-01T10:00:00Z",
      "store": "Beijing Branch",
      "amount": 5000.00,
      "quantity": 50
    }
  },
  "metadata": {
    "id": "meta-001",
    "fields": [
      { "id": "productName", "name": "äº§å“åç§°", "type": "text" },
      { "id": "quantity", "name": "æ•°é‡", "type": "number" }
    ]
  },
  "data": {
    "items": [
      {
        "id": "row-001",
        "values": [
          { "fieldId": "productName", "value": { "text": "iPhone 15" } },
          { "fieldId": "quantity", "value": { "number": 10 } }
        ]
      }
    ],
    "pageSize": 20,
    "totalItems": 100
  },
  "comments": [
    {
      "id": "comment-001",
      "target": { "scope": "document" },
      "content": "è¯·å°½å¿«å¤„ç†"
    }
  ],
  "revisions": [
    {
      "id": "rev-002",
      "version": 2,
      "changes": [...],
      "mergedBy": "user-1"
    }
  ]
}
```

## å·¥ä½œæµé›†æˆ

### å®Œæ•´çš„è®¢è´§å·¥ä½œæµ

```
1. åˆ›å»ºæ–‡æ¡£
   â”œâ”€ åˆå§‹åŒ– Propertiesï¼ˆè®¢å•æ—¶é—´ã€é—¨åº—ç­‰ï¼‰
   â”œâ”€ åˆ›å»º Metadataï¼ˆå­—æ®µå®šä¹‰ï¼‰
   â””â”€ åˆ›å»º Viewï¼ˆæ˜¾ç¤ºæ–¹å¼ï¼‰

2. æ·»åŠ æ•°æ®
   â”œâ”€ åˆ›å»º Rowï¼ˆäº§å“è¡Œï¼‰
   â”œâ”€ æ›´æ–° Rowï¼ˆä¿®æ”¹æ•°é‡/ä»·æ ¼ï¼‰
   â””â”€ å¯é€‰ï¼šåˆ›å»ºå¤šä¸ª Viewï¼ˆä¸åŒçš„è¿‡æ»¤è§†è§’ï¼‰

3. åä½œä¸è®¨è®º
   â”œâ”€ æ·»åŠ  Commentï¼ˆåœ¨è¡Œ/å•å…ƒæ ¼çº§åˆ«åé¦ˆï¼‰
   â”œâ”€ æåŠç›¸å…³äººå‘˜
   â””â”€ æ ‡è®°è¯„è®ºå·²è§£å†³

4. å˜æ›´ç®¡ç†
   â”œâ”€ ç”¨æˆ·ç¼–è¾‘æ•°æ®äº§ç”Ÿ ChangeOperation
   â”œâ”€ è‡ªåŠ¨ç”Ÿæˆä¿®è®¢è®°å½•æ¯ä¸ªæ“ä½œ
   â””â”€ Revision è®°å½•å®Œæ•´çš„ contributors

5. åˆå¹¶è¯·æ±‚
   â”œâ”€ åˆ›å»º Requestï¼ˆèšåˆæ‰€æœ‰å¾…åˆå¹¶å˜æ›´ï¼‰
   â”œâ”€ å®¡æ ¸ Requestï¼ˆæŸ¥çœ‹ diffï¼‰
   â””â”€ åˆå¹¶æ—¶ï¼š
      â”œâ”€ ç”Ÿæˆ Revisionï¼ˆå†»ç»“æ‰€æœ‰æ“ä½œï¼‰
      â”œâ”€ è®°å½• contributorsï¼ˆæ‰€æœ‰ç¼–è¾‘è€…ï¼‰
      â””â”€ æ›´æ–° generatedRevisionId

6. å›æº¯
   â”œâ”€ æŸ¥çœ‹ Revision å†å²
   â”œâ”€ æ¯”å¯¹ä¸¤ä¸ªç‰ˆæœ¬å·®å¼‚
   â”œâ”€ æŸ¥çœ‹è°æ”¹äº†ä»€ä¹ˆ
   â””â”€ å¿…è¦æ—¶å›æ»šåˆ°ä¹‹å‰ç‰ˆæœ¬
```

## ä½¿ç”¨åœºæ™¯è¯¦è§£

### åœºæ™¯1ï¼šè®¢è´§å•ï¼ˆPurchase Orderï¼‰

#### å±æ€§ï¼ˆPropertiesï¼‰
```json
{
  "orderTime": "2024-12-01T10:00:00Z",
  "store": "Beijing Branch",
  "totalAmount": 5000.00,
  "totalQuantity": 50,
  "status": "pending",
  "priority": "high",
  "notes": "Urgent delivery required"
}
```

#### å…ƒæ•°æ®ï¼ˆMetadataï¼‰
```json
{
  "fields": [
    { "id": "productName", "name": "äº§å“åç§°", "type": "text" },
    { "id": "quantity", "name": "æ•°é‡", "type": "number" },
    { "id": "price", "name": "å•ä»·", "type": "number" },
    { "id": "total", "name": "å°è®¡", "type": "number" }
  ]
}
```

#### æ•°æ®ï¼ˆDataï¼‰
```
| äº§å“åç§°      | æ•°é‡ | å•ä»·   | å°è®¡    |
|-------------|------|--------|---------|
| iPhone 15   | 10   | 799.99 | 7999.90 |
| iPad Pro    | 5    | 1099.99| 5499.95 |
| MacBook Air | 2    | 1999.99| 3999.98 |
```

#### å·¥ä½œæµ
1. è®¢å•å‘˜åˆ›å»ºè®¢è´§å•ï¼ˆåˆå§‹åŒ– Propertiesï¼‰
2. å¤šä¸ªé‡‡è´­å‘˜æ·»åŠ äº§å“è¡Œï¼ˆå¢åŠ  Dataï¼‰
3. ç»ç†å¯¹æŸäº›è¡Œæ·»åŠ è¯„è®ºï¼Œæå‡ºä¿®æ”¹æ„è§ï¼ˆCommentï¼‰
4. é‡‡è´­å‘˜æ ¹æ®åé¦ˆä¿®æ”¹æ•°æ®ï¼ˆChangeOperationï¼‰
5. ç»ç†å®¡æ ¸å¹¶åˆå¹¶ï¼ˆRequest â†’ Revisionï¼‰
6. è‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„ä¿®è®¢å†å²ï¼ˆRevision with all ChangeOperationsï¼‰

### åœºæ™¯2ï¼šå‘ç¥¨ï¼ˆInvoiceï¼‰

#### å±æ€§ï¼ˆPropertiesï¼‰
```json
{
  "invoiceNumber": "INV-2024-001",
  "issueDate": "2024-12-01",
  "dueDate": "2025-01-01",
  "totalAmount": 10000.00,
  "taxRate": 0.13,
  "taxAmount": 1300.00,
  "paymentStatus": "pending",
  "paymentMethod": "bank_transfer"
}
```

#### å…ƒæ•°æ®ï¼ˆMetadataï¼‰
```json
{
  "fields": [
    { "id": "description", "name": "æè¿°", "type": "text" },
    { "id": "quantity", "name": "æ•°é‡", "type": "number" },
    { "id": "unitPrice", "name": "å•ä»·", "type": "number" },
    { "id": "lineTotal", "name": "é‡‘é¢", "type": "number" }
  ]
}
```

### åœºæ™¯3ï¼šåº“å­˜è¡¨ï¼ˆInventoryï¼‰

#### å±æ€§ï¼ˆPropertiesï¼‰
```json
{
  "warehouseId": "warehouse-001",
  "warehouseName": "Beijing Warehouse",
  "lastUpdated": "2024-12-01T10:00:00Z",
  "totalItems": 1000,
  "totalValue": 50000.00
}
```

#### å…ƒæ•°æ®ï¼ˆMetadataï¼‰
```json
{
  "fields": [
    { "id": "sku", "name": "SKU", "type": "text" },
    { "id": "productName", "name": "äº§å“åç§°", "type": "text" },
    { "id": "quantity", "name": "æ•°é‡", "type": "number" },
    { "id": "lastRestockDate", "name": "æœ€åè¡¥è´§æ—¶é—´", "type": "date" },
    { "id": "status", "name": "çŠ¶æ€", "type": "select" }
  ]
}
```

## æœ€ä½³å®è·µ

### 1. å±æ€§è®¾è®¡
- âœ… ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼ˆcamelCaseï¼‰
- âœ… å±æ€§ååº”è¯¥è‡ªæè¿°ï¼ˆ`orderTime` è€Œä¸æ˜¯ `time`ï¼‰
- âœ… ç›¸å…³å±æ€§å¯ä»¥åˆ†ç»„ä½¿ç”¨ä¸‹åˆ’çº¿ï¼ˆ`shipping_address`, `billing_address`ï¼‰
- âŒ é¿å…è¿‡äºå¤æ‚çš„åµŒå¥—ç»“æ„
- âŒ é¿å…åœ¨å±æ€§ä¸­å­˜å‚¨åˆ—è¡¨æ•°æ®ï¼ˆåº”è¯¥ç”¨ Data è¡Œï¼‰

### 2. å…ƒæ•°æ®è®¾è®¡
- âœ… å­—æ®µID åº”è¯¥å¯¹åº”æ•°æ®ä¸­çš„å®é™…å­—æ®µ
- âœ… æä¾›æ¸…æ™°çš„å­—æ®µè¯´æ˜å’ŒéªŒè¯è§„åˆ™
- âœ… æ ¹æ®å­—æ®µç±»å‹è®¾ç½®é€‚å½“çš„éªŒè¯
- âŒ é¿å…é¢‘ç¹ä¿®æ”¹å…ƒæ•°æ®ï¼ˆä¼šå½±å“å·²æœ‰æ•°æ®ï¼‰
- âŒ ä¸è¦åœ¨å…ƒæ•°æ®ä¸­å­˜å‚¨é»˜è®¤å€¼ï¼ˆåº”åœ¨åˆ›å»ºæ•°æ®æ—¶å¤„ç†ï¼‰

### 3. æ•°æ®æ“ä½œ
- âœ… ä¼˜å…ˆä½¿ç”¨æ‰¹é‡æ“ä½œï¼ˆbatch-create/update/deleteï¼‰
- âœ… æä¾›æœ‰æ„ä¹‰çš„ç‰ˆæœ¬å·ä»¥æ”¯æŒä¹è§‚é”
- âœ… å¯¹å¤§é‡ä¿®æ”¹ä½¿ç”¨åˆå¹¶è¯·æ±‚ï¼ˆRequestï¼‰
- âŒ é¿å…é¢‘ç¹çš„å•è¡Œæ“ä½œï¼ˆåº”è¯¥æ‰¹é‡å¤„ç†ï¼‰
- âŒ ä¸è¦ä¾èµ–ä¿®è®¢æ¥æ¢å¤é”™è¯¯æ•°æ®ï¼ˆåº”è¯¥ä½¿ç”¨é€‚å½“çš„éªŒè¯ï¼‰

### 4. è¯„è®ºå’Œåä½œ
- âœ… å¯¹ä¸åŒä½ç½®çš„è¯„è®ºä½¿ç”¨ç²¾ç¡®çš„ target å®šä½
- âœ… ä½¿ç”¨ mentionsï¼ˆ@æåŠï¼‰æ¥å¸å¼•æ³¨æ„
- âœ… åŠæ—¶æ ‡è®°å·²è§£å†³çš„è¯„è®º
- âŒ ä¸è¦åœ¨è¯„è®ºä¸­ä¿å­˜ç»“æ„åŒ–æ•°æ®ï¼ˆåº”è¯¥ä¿®æ”¹å®é™…æ•°æ®ï¼‰
- âŒ é¿å…è¿‡åº¦çš„è¯„è®ºï¼ˆåº”è¯¥åœ¨é—®é¢˜è§£å†³åæ¸…ç†ï¼‰

### 5. ç‰ˆæœ¬å’Œå®¡è®¡
- âœ… å¯¹é‡è¦çš„ä¿®æ”¹åˆ›å»ºæœ‰æ„ä¹‰çš„ä¿®è®¢è¯´æ˜
- âœ… å®šæœŸæŸ¥çœ‹ä¿®è®¢å†å²ä»¥å®¡è®¡å˜æ›´
- âœ… ä½¿ç”¨ä¿®è®¢æ¥è¿½è¸ªæ•°æ®çš„æ¼”å˜è¿‡ç¨‹
- âŒ ä¸è¦æ»¥ç”¨å›æ»šåŠŸèƒ½ï¼ˆåº”è¯¥æ˜ç¡®ä¿®æ”¹è€Œä¸æ˜¯é¢‘ç¹å›æ»šï¼‰
- âŒ é¿å…åˆ é™¤é‡è¦çš„ä¿®è®¢è®°å½•

## æ€§èƒ½è€ƒè™‘

### åˆ†é¡µå’Œé™åˆ¶
```bash
# å¯¹äºå¤§é‡æ•°æ®ï¼Œä½¿ç”¨åˆ†é¡µ
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123/rows?page=1&pageSize=100' \
  -H 'Authorization: Bearer TOKEN'

# åœ¨èšåˆæŸ¥è¯¢ä¸­é™åˆ¶è¯„è®º/ä¿®è®¢æ•°é‡
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123?include=comments,revisions&commentsLimit=10&revisionsLimit=5' \
  -H 'Authorization: Bearer TOKEN'
```

### é€‰æ‹©éœ€è¦çš„æ•°æ®
```bash
# åªè·å–å¿…è¦çš„æ•°æ®éƒ¨åˆ†
curl 'https://open.nexusbook.app/api/v1/doc/purchaseOrder/order-123?include=properties,metadata' \
  -H 'Authorization: Bearer TOKEN'
# é¿å…è·å–æ•´ä¸ªæ•°æ®é›†
```

### ç¼“å­˜ç­–ç•¥
- å…ƒæ•°æ®å˜åŒ–è¾ƒå°‘ï¼Œå¯ä»¥é•¿æœŸç¼“å­˜
- æ•°æ®å’Œè¯„è®ºå˜åŒ–é¢‘ç¹ï¼Œè€ƒè™‘çŸ­æœŸç¼“å­˜
- ä¿®è®¢é€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œå¯ä»¥æ°¸ä¹…ç¼“å­˜

## æ€»ç»“

NexusBook çš„æ–‡æ¡£æ¨¡å‹é€šè¿‡**åˆ†å±‚è®¾è®¡**æä¾›äº†é«˜åº¦çš„çµæ´»æ€§ï¼š

- **Properties** - æ–‡æ¡£çš„å…ƒä¿¡æ¯ï¼ˆè®¢å•æ—¶é—´ã€é—¨åº—ç­‰ï¼‰
- **Metadata** - å­—æ®µå®šä¹‰ï¼ˆç»“æ„ï¼‰
- **Data** - å®é™…çš„æ•°æ®è¡Œï¼ˆå†…å®¹ï¼‰
- **Views** - å±•ç¤ºæ–¹å¼ï¼ˆè§†è§’ï¼‰
- **Comments** - ç²¾ç¡®ä½ç½®çš„åä½œè®¨è®º
- **Revisions** - å®Œæ•´çš„å˜æ›´å†å²å’Œç‰ˆæœ¬æ§åˆ¶
- **Settings** - æ–‡æ¡£é…ç½®å’Œæƒé™

è¿™ä¸ªè®¾è®¡æ”¯æŒï¼š
âœ… ä¸åŒç±»å‹çš„æ–‡æ¡£ï¼ˆè®¢è´§å•ã€å‘ç¥¨ã€åº“å­˜ç­‰ï¼‰
âœ… å¤šäººåä½œå’Œå®¡æ‰¹å·¥ä½œæµ
âœ… å®Œæ•´çš„å®¡è®¡è·Ÿè¸ª
âœ… çµæ´»çš„æ•°æ®æŸ¥è¯¢å’Œå±•ç¤º
âœ… ç‰ˆæœ¬æ§åˆ¶å’Œæ•°æ®æ¢å¤
âœ… ç²¾ç¡®ä½ç½®çš„è¯„è®ºå’Œåé¦ˆ
