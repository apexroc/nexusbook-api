# æ±‡æ€»å­—æ®µ

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp)
- [api/shared/common.tsp](file://api/shared/common.tsp)
- [api/document/core/data.tsp](file://api/document/core/data.tsp)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp)
- [docs-src/references/field-types.md](file://docs-src/references/field-types.md)
- [docs-src/guides/data-operations.md](file://docs-src/guides/data-operations.md)
- [docs-src/guides/best-practices.md](file://docs-src/guides/best-practices.md)
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–åˆ†æ](#ä¾èµ–åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹
æœ¬æ–‡ä»¶èšç„¦äº NexusBook API ä¸­â€œæ±‡æ€»å­—æ®µï¼ˆRollupï¼‰â€çš„è¯¦ç»†åŠŸèƒ½è¯´æ˜ï¼Œå›´ç»• RollupConfig æ¨¡å‹çš„ä¸‰ä¸ªæ ¸å¿ƒå±æ€§ relationFieldIdã€targetFieldId ä¸ agg èšåˆå‡½æ•°å±•å¼€ï¼Œè§£é‡Šå¦‚ä½•é€šè¿‡å…³è”å­—æ®µå®šä½ç›®æ ‡æ•°æ®é›†ï¼Œå¹¶å¯¹æŒ‡å®šå­—æ®µæ‰§è¡Œè®¡æ•°ã€æ±‚å’Œã€å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ç­‰èšåˆæ“ä½œã€‚æ–‡æ¡£è¿˜æä¾›å®é™…ä½¿ç”¨æ¡ˆä¾‹ï¼ˆå¦‚ç»Ÿè®¡æŸé¡¹ç›®ä¸‹çš„ä»»åŠ¡å®Œæˆæ•°é‡ã€è®¡ç®—å®¢æˆ·è®¢å•æ€»é‡‘é¢ï¼‰ï¼Œå¹¶è®¨è®ºæœåŠ¡ç«¯èšåˆæŸ¥è¯¢çš„æ‰§è¡Œæ–¹å¼ã€æ•°æ®åº“å±‚é¢çš„ä¼˜åŒ–ç­–ç•¥ä¸ç»“æœç¼“å­˜æœºåˆ¶ï¼Œä»¥åŠåœ¨å¤§è§„æ¨¡æ•°æ®åœºæ™¯ä¸‹çš„åˆ†é¡µå¤„ç†æ–¹æ¡ˆã€‚

## é¡¹ç›®ç»“æ„
ä¸æ±‡æ€»å­—æ®µç›´æ¥ç›¸å…³çš„æ ¸å¿ƒæ–‡ä»¶åˆ†å¸ƒåœ¨ä»¥ä¸‹æ¨¡å—ï¼š
- å­—æ®µä¸è®¡ç®—é…ç½®ï¼šapi/document/core/metadata.tsp
- é€šç”¨ç±»å‹ä¸èšåˆæšä¸¾ï¼šapi/shared/common.tsp
- æ•°æ®æŸ¥è¯¢ä¸åˆ†ç»„èšåˆæ¥å£ï¼šapi/document/core/data.tsp
- èšåˆæ–‡æ¡£åŒ…æ¥å£ï¼šapi/document/aggregate/index.tsp
- å­—æ®µç±»å‹å‚è€ƒä¸ç¤ºä¾‹ï¼šdocs-src/references/field-types.md
- æ•°æ®æ“ä½œä¸åˆ†é¡µå®è·µï¼šdocs-src/guides/data-operations.md
- æœ€ä½³å®è·µä¸ç¼“å­˜ç­–ç•¥ï¼šdocs-src/guides/best-practices.md
- æ¶æ„æ¦‚è§ˆä¸æŸ¥è¯¢èƒ½åŠ›ï¼šdocs-src/guides/architecture.md

```mermaid
graph TB
subgraph "æ–‡æ¡£ä¸å…ƒæ•°æ®"
M["RollupConfig å®šä¹‰<br/>api/document/core/metadata.tsp"]
C["AggregationFn æšä¸¾<br/>api/shared/common.tsp"]
FT["å­—æ®µç±»å‹å‚è€ƒ<br/>docs-src/references/field-types.md"]
end
subgraph "æŸ¥è¯¢ä¸èšåˆ"
Q["ç»“æ„åŒ–æŸ¥è¯¢æ¥å£<br/>api/document/core/data.tsp"]
G["åˆ†ç»„èšåˆæ¥å£<br/>api/document/core/data.tsp"]
A["èšåˆæ–‡æ¡£åŒ…æ¥å£<br/>api/document/aggregate/index.tsp"]
end
subgraph "æŒ‡å—ä¸æœ€ä½³å®è·µ"
DO["æ•°æ®æ“ä½œæŒ‡å—<br/>docs-src/guides/data-operations.md"]
BP["æœ€ä½³å®è·µä¸ç¼“å­˜<br/>docs-src/guides/best-practices.md"]
AR["æ¶æ„æ¦‚è§ˆ<br/>docs-src/guides/architecture.md"]
end
M --> Q
M --> G
C --> Q
C --> G
FT --> M
A --> Q
A --> G
DO --> Q
DO --> G
BP --> A
AR --> Q
AR --> G
```

å›¾è¡¨æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L35-L90)
- [docs-src/references/field-types.md](file://docs-src/references/field-types.md#L316-L351)
- [docs-src/guides/data-operations.md](file://docs-src/guides/data-operations.md#L294-L359)
- [docs-src/guides/best-practices.md](file://docs-src/guides/best-practices.md#L213-L279)
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L7-L68)

ç« èŠ‚æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L35-L90)
- [docs-src/references/field-types.md](file://docs-src/references/field-types.md#L316-L351)
- [docs-src/guides/data-operations.md](file://docs-src/guides/data-operations.md#L294-L359)
- [docs-src/guides/best-practices.md](file://docs-src/guides/best-practices.md#L213-L279)
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L7-L68)

## æ ¸å¿ƒç»„ä»¶
- RollupConfig æ¨¡å‹
  - relationFieldIdï¼šå…³è”å­—æ®µ IDï¼Œç”¨äºå®šä½â€œè¢«æ±‡æ€»â€çš„æ•°æ®è¡Œé›†åˆ
  - targetFieldIdï¼šç›®æ ‡å­—æ®µ IDï¼Œç”¨äºåœ¨è¢«æ±‡æ€»çš„æ•°æ®è¡Œä¸­é€‰å–å…·ä½“æ•°å€¼å­—æ®µ
  - aggï¼šèšåˆå‡½æ•°ï¼Œæ”¯æŒ countã€sumã€avgã€minã€max
- AggregationFn æšä¸¾ä¸ Aggregation æ¨¡å‹
  - AggregationFn å®šä¹‰äº†å¯ç”¨çš„èšåˆå‡½æ•°
  - Aggregation æ¨¡å‹ç”¨äºåˆ†ç»„æŸ¥è¯¢ä¸­çš„èšåˆå®šä¹‰
- æŸ¥è¯¢ä¸åˆ†é¡µ
  - ç»“æ„åŒ–æŸ¥è¯¢æ¥å£æ”¯æŒè¿‡æ»¤ã€æ’åºã€åˆ†é¡µ
  - åˆ†ç»„èšåˆæ¥å£æ”¯æŒå¤šçº§åˆ†ç»„ä¸èšåˆ
  - èšåˆæ–‡æ¡£åŒ…æ¥å£æ”¯æŒä¸€æ¬¡æ€§è·å–å…ƒæ•°æ®ã€è§†å›¾ã€æ•°æ®ã€è¯„è®ºã€ä¿®è®¢ä¸è®¾ç½®

ç« èŠ‚æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/shared/common.tsp](file://api/shared/common.tsp#L305-L317)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L35-L90)

## æ¶æ„æ¦‚è§ˆ
NexusBook çš„æŸ¥è¯¢èƒ½åŠ›åŒ…å«è¿‡æ»¤ã€æ’åºã€åˆ†ç»„ä¸èšåˆï¼Œæ–‡æ¡£èšåˆæ¥å£æ”¯æŒä¸€æ¬¡æ€§æ‹‰å–å¤šç§æ•°æ®ï¼Œä»¥é™ä½å®¢æˆ·ç«¯å¾€è¿”æ¬¡æ•°ã€‚æ¶æ„å›¾å±•ç¤ºäº†æ–‡æ¡£æŠ½è±¡ã€æ ¸å¿ƒæ•°æ®å±‚ã€åä½œå±‚ã€å·¥ä½œæµå±‚ä¸æŸ¥è¯¢èƒ½åŠ›ä¹‹é—´çš„å…³ç³»ã€‚

```mermaid
graph TB
subgraph "Document æ–‡æ¡£æŠ½è±¡"
Doc["ğŸ“„ Document<br/>{doc-type}/{doc-id}"]
Props["ğŸ·ï¸ Properties<br/>æ–‡æ¡£å±æ€§"]
Meta["ğŸ“‹ Metadata<br/>å­—æ®µå®šä¹‰"]
Views["ğŸ‘ï¸ Views<br/>è§†å›¾é…ç½®"]
Data["ğŸ“Š Data<br/>æ•°æ®è¡Œ"]
Settings["âš™ï¸ Settings<br/>é…ç½®"]
end
subgraph "æŸ¥è¯¢èƒ½åŠ› Query Engine"
Filter["ğŸ” Filter<br/>è¿‡æ»¤å™¨"]
Sort["ğŸ“¶ Sort<br/>æ’åº"]
Group["ğŸ“Š Group<br/>åˆ†ç»„èšåˆ"]
Aggregate["ğŸ¯ Aggregate<br/>èšåˆæŸ¥è¯¢"]
end
subgraph "è®¤è¯æˆæƒ Auth"
OAuth["ğŸ” OAuth2/OIDC"]
Token["ğŸ« JWT Token"]
Scope["ğŸ”‘ Scopes"]
end
Doc --> Props
Doc --> Meta
Doc --> Views
Doc --> Data
Doc --> Settings
Data --> Filter
Data --> Sort
Data --> Group
Doc --> Aggregate
OAuth --> Token
Token --> Scope
Scope --> Doc
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L7-L68)

ç« èŠ‚æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L7-L68)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### RollupConfig æ¨¡å‹ä¸èšåˆå‡½æ•°
RollupConfig ç”¨äºå®šä¹‰â€œæ±‡æ€»å­—æ®µâ€çš„è®¡ç®—è§„åˆ™ï¼Œå…¶ä¸‰ä¸ªæ ¸å¿ƒå±æ€§å¦‚ä¸‹ï¼š
- relationFieldIdï¼šå…³è”å­—æ®µ IDï¼Œç”¨äºå®šä½â€œè¢«æ±‡æ€»â€çš„æ•°æ®è¡Œé›†åˆ
- targetFieldIdï¼šç›®æ ‡å­—æ®µ IDï¼Œç”¨äºåœ¨è¢«æ±‡æ€»çš„æ•°æ®è¡Œä¸­é€‰å–å…·ä½“æ•°å€¼å­—æ®µ
- aggï¼šèšåˆå‡½æ•°ï¼Œæ”¯æŒ countã€sumã€avgã€minã€max

```mermaid
classDiagram
class RollupConfig {
+string relationFieldId
+string targetFieldId
+AggregationFn agg
}
class AggregationFn {
<<enumeration>>
+count
+sum
+avg
+min
+max
}
class Aggregation {
+AggregationFn kind
+string field
}
RollupConfig --> AggregationFn : "ä½¿ç”¨"
Aggregation --> AggregationFn : "ä½¿ç”¨"
```

å›¾è¡¨æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/shared/common.tsp](file://api/shared/common.tsp#L305-L317)

ç« èŠ‚æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/shared/common.tsp](file://api/shared/common.tsp#L305-L317)

### å­—æ®µç±»å‹ä¸ rollup é…ç½®ç¤ºä¾‹
å­—æ®µç±»å‹å‚è€ƒæ–‡æ¡£æä¾›äº† rollup çš„é…ç½®ç¤ºä¾‹ä¸æ”¯æŒçš„èšåˆå‡½æ•°åˆ—è¡¨ï¼Œä¾¿äºåœ¨å…ƒæ•°æ®ä¸­å®šä¹‰æ±‡æ€»å­—æ®µã€‚

ç« èŠ‚æ¥æº
- [docs-src/references/field-types.md](file://docs-src/references/field-types.md#L316-L351)

### ç»“æ„åŒ–æŸ¥è¯¢ä¸åˆ†ç»„èšåˆ
- ç»“æ„åŒ–æŸ¥è¯¢æ¥å£æ”¯æŒè¿‡æ»¤ã€æ’åºã€åˆ†é¡µï¼Œé€‚åˆå¸¸è§„æ•°æ®æŸ¥è¯¢
- åˆ†ç»„èšåˆæ¥å£æ”¯æŒå¤šçº§åˆ†ç»„ä¸èšåˆï¼Œé€‚åˆç»Ÿè®¡åˆ†æåœºæ™¯

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant API as "æ•°æ®æŸ¥è¯¢æ¥å£"
participant Engine as "æŸ¥è¯¢å¼•æ“"
participant DB as "æ•°æ®åº“"
Client->>API : "POST /doc/{docType}/{docId}/query"
API->>Engine : "è§£æ QueryRequestè¿‡æ»¤/æ’åº/åˆ†é¡µ/åˆ†ç»„"
Engine->>DB : "æ‰§è¡Œ SQL/ç´¢å¼•æ‰«æ"
DB-->>Engine : "è¿”å›æ•°æ®/èšåˆç»“æœ"
Engine-->>API : "å°è£…åˆ†é¡µ/åˆ†ç»„èšåˆç»“æœ"
API-->>Client : "ApiResponse<Page/GroupedResult>"
```

å›¾è¡¨æ¥æº
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)
- [api/shared/common.tsp](file://api/shared/common.tsp#L179-L203)
- [api/shared/common.tsp](file://api/shared/common.tsp#L334-L357)
- [api/shared/common.tsp](file://api/shared/common.tsp#L470-L497)

ç« èŠ‚æ¥æº
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)
- [api/shared/common.tsp](file://api/shared/common.tsp#L179-L203)
- [api/shared/common.tsp](file://api/shared/common.tsp#L334-L357)
- [api/shared/common.tsp](file://api/shared/common.tsp#L470-L497)

### èšåˆæ–‡æ¡£åŒ…æ¥å£
èšåˆæ–‡æ¡£åŒ…æ¥å£æ”¯æŒä¸€æ¬¡æ€§è·å–å…ƒæ•°æ®ã€è§†å›¾ã€æ•°æ®ã€è¯„è®ºã€ä¿®è®¢ä¸è®¾ç½®ï¼Œç»“åˆ include å‚æ•°æŒ‰éœ€åŠ è½½ï¼Œæœ‰åŠ©äºå‡å°‘ç½‘ç»œå¾€è¿”ä¸å‰ç«¯æ¸²æŸ“å‹åŠ›ã€‚

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant Bundle as "èšåˆæ–‡æ¡£åŒ…æ¥å£"
participant Engine as "æŸ¥è¯¢å¼•æ“"
participant DB as "æ•°æ®åº“"
Client->>Bundle : "GET /doc/{docType}/{docId}?include=..."
Bundle->>Engine : "æŒ‰ include ç»„è£…æŸ¥è¯¢è®¡åˆ’"
Engine->>DB : "å¹¶è¡Œ/æ‰¹é‡è¯»å–å…ƒæ•°æ®/æ•°æ®/è¯„è®º/ä¿®è®¢/è®¾ç½®"
DB-->>Engine : "è¿”å›å„éƒ¨åˆ†æ•°æ®"
Engine-->>Bundle : "ç»„è£… DocBundle"
Bundle-->>Client : "ApiResponse<DocBundle>"
```

å›¾è¡¨æ¥æº
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L35-L90)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L92-L126)

ç« èŠ‚æ¥æº
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L35-L90)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L92-L126)

### å®é™…ä½¿ç”¨æ¡ˆä¾‹
- ç»Ÿè®¡æŸé¡¹ç›®ä¸‹çš„ä»»åŠ¡å®Œæˆæ•°é‡
  - åœ¨é¡¹ç›®æ–‡æ¡£ä¸­å®šä¹‰ä¸€ä¸ª rollup å­—æ®µï¼ŒrelationFieldId æŒ‡å‘â€œä»»åŠ¡â€å…³è”å­—æ®µï¼ŒtargetFieldId æŒ‡å‘â€œçŠ¶æ€â€å­—æ®µï¼Œagg é€‰æ‹© countï¼›å½“â€œçŠ¶æ€â€ä¸ºâ€œå®Œæˆâ€æ—¶ï¼Œå¯é€šè¿‡è¿‡æ»¤å™¨åœ¨æŸ¥è¯¢é˜¶æ®µç­›é€‰åå†èšåˆï¼Œæˆ–åœ¨ rollup ä¸­æŒ‰éœ€é…ç½® lookup/rollup çš„ç»„åˆ
- è®¡ç®—å®¢æˆ·è®¢å•çš„æ€»é‡‘é¢
  - åœ¨å®¢æˆ·æ–‡æ¡£ä¸­å®šä¹‰ä¸€ä¸ª rollup å­—æ®µï¼ŒrelationFieldId æŒ‡å‘â€œè®¢å•â€å…³è”å­—æ®µï¼ŒtargetFieldId æŒ‡å‘â€œé‡‘é¢â€å­—æ®µï¼Œagg é€‰æ‹© sumï¼›è‹¥å­˜åœ¨æŠ˜æ‰£/ç¨è´¹ç­‰å­é¡¹ï¼Œå¯åœ¨è®¢å•æ˜ç»†ä¸­å†åšä¸€å±‚ rollup æˆ–ä½¿ç”¨åˆ†ç»„èšåˆæ¥å£è¿›è¡Œå¤šå­—æ®µèšåˆ

ç« èŠ‚æ¥æº
- [docs-src/references/field-types.md](file://docs-src/references/field-types.md#L316-L351)
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)

## ä¾èµ–åˆ†æ
RollupConfig ä¸é€šç”¨èšåˆç±»å‹çš„å…³ç³»å¦‚ä¸‹ï¼š
- RollupConfig ä½¿ç”¨ AggregationFn æšä¸¾å®šä¹‰èšåˆå‡½æ•°
- åˆ†ç»„æŸ¥è¯¢ä½¿ç”¨ Aggregation æ¨¡å‹å®šä¹‰èšåˆå‡½æ•°ä¸ç›®æ ‡å­—æ®µ
- æŸ¥è¯¢æ¥å£ï¼ˆç»“æ„åŒ–æŸ¥è¯¢ä¸åˆ†ç»„èšåˆï¼‰ä¾èµ–é€šç”¨çš„è¿‡æ»¤ã€æ’åºã€åˆ†é¡µä¸åˆ†ç»„æ¨¡å‹

```mermaid
graph LR
RC["RollupConfig<br/>api/document/core/metadata.tsp"] --> AF["AggregationFn<br/>api/shared/common.tsp"]
AG["Aggregation<br/>api/shared/common.tsp"] --> AF
QRY["ç»“æ„åŒ–æŸ¥è¯¢æ¥å£<br/>api/document/core/data.tsp"] --> AF
GRP["åˆ†ç»„èšåˆæ¥å£<br/>api/document/core/data.tsp"] --> AF
GRP --> AG
```

å›¾è¡¨æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/shared/common.tsp](file://api/shared/common.tsp#L305-L317)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)

ç« èŠ‚æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L112-L144)
- [api/shared/common.tsp](file://api/shared/common.tsp#L297-L303)
- [api/shared/common.tsp](file://api/shared/common.tsp#L305-L317)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)

## æ€§èƒ½è€ƒè™‘
- æœåŠ¡ç«¯èšåˆæŸ¥è¯¢çš„æ•°æ®åº“ä¼˜åŒ–ç­–ç•¥
  - ä½¿ç”¨åˆé€‚çš„ç´¢å¼•ï¼šé’ˆå¯¹ relationFieldIdã€targetFieldId æ‰€åœ¨å­—æ®µå»ºç«‹ç´¢å¼•ï¼ŒåŠ é€Ÿå…³è”ä¸è¿‡æ»¤
  - è¿‡æ»¤å‰ç½®ï¼šåœ¨èšåˆå‰é€šè¿‡ filters ç¼©å°æ•°æ®é›†ï¼Œå‡å°‘èšåˆè®¡ç®—é‡
  - åˆ†ç»„è£å‰ªï¼šä»…åœ¨å¿…è¦æ—¶å¯ç”¨ includeRowsï¼Œé¿å…è¿”å›å¤§é‡æ˜ç»†æ•°æ®
  - æ‰¹é‡è¯»å–ï¼šèšåˆæ–‡æ¡£åŒ…æ¥å£æ”¯æŒä¸€æ¬¡æ€§æ‹‰å–å¤šéƒ¨åˆ†æ•°æ®ï¼Œå‡å°‘å¤šæ¬¡å¾€è¿”
- ç»“æœç¼“å­˜æœºåˆ¶
  - å…ƒæ•°æ®ä¸è§†å›¾ç­‰é™æ€æˆ–ä½é¢‘å˜åŒ–æ•°æ®å¯é‡‡ç”¨çŸ­æœŸç¼“å­˜ï¼ˆå¦‚æœ€ä½³å®è·µä¸­å»ºè®®çš„åˆ†é’Ÿçº§ TTLï¼‰
  - å¯¹äºé«˜é¢‘ä½†ç¨³å®šçš„èšåˆç»“æœï¼Œå¯è€ƒè™‘åœ¨åº”ç”¨å±‚ç¼“å­˜çƒ­ç‚¹æŸ¥è¯¢ç»“æœï¼Œç»“åˆå¤±æ•ˆç­–ç•¥
- å¤§è§„æ¨¡æ•°æ®ä¸‹çš„åˆ†é¡µå¤„ç†
  - ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆcursorï¼‰å¤„ç†æ·±åˆ†é¡µï¼Œé¿å… offset æ·±ç¿»é¡µå¯¼è‡´çš„æ€§èƒ½é€€åŒ–
  - åˆç†è®¾ç½®åˆ†é¡µå¤§å°ï¼ˆå¦‚ 20-100ï¼‰ï¼Œå¹³è¡¡è¯·æ±‚æ¬¡æ•°ä¸å“åº”æ—¶é—´
  - å¯¹äºè¶…å¤§æ•°æ®é›†ï¼Œä¼˜å…ˆä½¿ç”¨è¿‡æ»¤ä¸åˆ†ç»„èšåˆæ¥å£ï¼Œé¿å…ä¸€æ¬¡æ€§è¿”å›å…¨é‡æ˜ç»†

ç« èŠ‚æ¥æº
- [docs-src/guides/data-operations.md](file://docs-src/guides/data-operations.md#L294-L359)
- [docs-src/guides/best-practices.md](file://docs-src/guides/best-practices.md#L213-L279)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L329-L441)

## æ•…éšœæ’æŸ¥æŒ‡å—
- ç‰ˆæœ¬å†²çªä¸å¹¶å‘æ§åˆ¶
  - å†™æ“ä½œéœ€æºå¸¦ requestIdï¼Œå¹¶ä½¿ç”¨ç‰ˆæœ¬å·è¿›è¡Œä¹è§‚é”æ§åˆ¶ï¼›è‹¥å‡ºç°ç‰ˆæœ¬å†²çªï¼Œéœ€é‡æ–°è·å–æœ€æ–°æ•°æ®å¹¶é‡è¯•
- æŸ¥è¯¢æ€§èƒ½é—®é¢˜
  - æ£€æŸ¥æ˜¯å¦ç¼ºå°‘å¿…è¦çš„ç´¢å¼•ï¼›ç¡®è®¤ filters æ˜¯å¦åˆç†ï¼›é¿å…ä¸€æ¬¡æ€§è¯·æ±‚è¿‡å¤š include éƒ¨åˆ†
- åˆ†é¡µå¼‚å¸¸
  - ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µæ›¿ä»£æ·±åº¦ offsetï¼›ç¡®ä¿ cursor å‚æ•°æ­£ç¡®ä¼ é€’
- ç¼“å­˜å‘½ä¸­ç‡ä½
  - æ£€æŸ¥ç¼“å­˜é”®ä¸è¿‡æœŸæ—¶é—´ï¼›å¯¹çƒ­ç‚¹æ•°æ®å¢åŠ ç¼“å­˜å±‚ï¼›é¿å…é¢‘ç¹å˜æ›´å…ƒæ•°æ®å¯¼è‡´ç¼“å­˜å¤±æ•ˆ

ç« èŠ‚æ¥æº
- [docs-src/guides/best-practices.md](file://docs-src/guides/best-practices.md#L103-L142)
- [docs-src/guides/data-operations.md](file://docs-src/guides/data-operations.md#L294-L359)

## ç»“è®º
RollupConfig é€šè¿‡ relationFieldIdã€targetFieldId ä¸ agg ä¸‰ä¸ªå…³é”®å±æ€§ï¼Œå®ç°äº†å¯¹å…³è”æ•°æ®çš„çµæ´»èšåˆã€‚ç»“åˆç»“æ„åŒ–æŸ¥è¯¢ä¸åˆ†ç»„èšåˆæ¥å£ï¼Œå¯ä»¥åœ¨æœåŠ¡ç«¯é«˜æ•ˆå®Œæˆç»Ÿè®¡åˆ†æï¼›é…åˆè¿‡æ»¤ã€æ’åºã€åˆ†é¡µä¸ç¼“å­˜ç­–ç•¥ï¼Œå¯åœ¨å¤§è§„æ¨¡æ•°æ®åœºæ™¯ä¸‹ä¿æŒè‰¯å¥½çš„æ€§èƒ½ä¸ç”¨æˆ·ä½“éªŒã€‚å»ºè®®åœ¨è®¾è®¡é˜¶æ®µå……åˆ†è€ƒè™‘å­—æ®µç´¢å¼•ã€æŸ¥è¯¢è®¡åˆ’ä¸ç¼“å­˜ç­–ç•¥ï¼Œä»¥è·å¾—ç¨³å®šé«˜æ•ˆçš„æ±‡æ€»èƒ½åŠ›ã€‚

## é™„å½•
- å­—æ®µç±»å‹å‚è€ƒä¸ rollup ç¤ºä¾‹
  - å‚è€ƒè·¯å¾„ï¼šdocs-src/references/field-types.md
- æ•°æ®æ“ä½œä¸åˆ†é¡µå®è·µ
  - å‚è€ƒè·¯å¾„ï¼šdocs-src/guides/data-operations.md
- æœ€ä½³å®è·µä¸ç¼“å­˜ç­–ç•¥
  - å‚è€ƒè·¯å¾„ï¼šdocs-src/guides/best-practices.md
- æ¶æ„æ¦‚è§ˆä¸æŸ¥è¯¢èƒ½åŠ›
  - å‚è€ƒè·¯å¾„ï¼šdocs-src/guides/architecture.md