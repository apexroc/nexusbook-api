# è¯„è®ºç³»ç»Ÿ

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [comments.tsp](file://api/document/content/comments.tsp)
- [index.tsp](file://api/document/content/index.tsp)
- [common.tsp](file://api/shared/common.tsp)
- [document-model.md](file://docs-src/guides/document-model.md)
- [WEBHOOK_GUIDE.md](file://api/extensions/webhooks/WEBHOOK_GUIDE.md)
- [webhooks.md](file://docs-src/guides/webhooks.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–åˆ†æ](#ä¾èµ–åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹
æœ¬æ–‡ä»¶é¢å‘ NexusBook API çš„è¯„è®ºç³»ç»Ÿï¼Œå›´ç»• Comments æ¨¡å‹ä¸ CommentsApi æ¥å£ï¼Œç³»ç»Ÿæ€§é˜è¿°ä»¥ä¸‹ä¸»é¢˜ï¼š
- å¦‚ä½•é€šè¿‡ target.scopeã€fieldIdã€rowId ç­‰å­—æ®µå®ç°æ–‡æ¡£ã€å­—æ®µã€è¡Œã€å•å…ƒæ ¼å››çº§ç²¾ç¡®å®šä½
- çº¿ç¨‹åŒ–è¯„è®ºæœºåˆ¶ï¼ˆparentIdï¼‰çš„å®ç°æ–¹å¼ä¸åµŒå¥—ç»“æ„å¤„ç†
- è¡¨æƒ…ååº”ï¼ˆreactionsï¼‰çš„æ•°æ®ç»“æ„è®¾è®¡ä¸å¢åˆ æ”¹æ“ä½œ
- å·²è§£å†³çŠ¶æ€ï¼ˆresolvedï¼‰çš„ä¸šåŠ¡æ„ä¹‰ä¸ UI å‘ˆç°å»ºè®®
- ç»“åˆæ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼Œç»™å‡ºåˆ›å»ºæ–‡æ¡£çº§ã€è¡Œçº§ã€å•å…ƒæ ¼çº§è¯„è®ºçš„å®Œæ•´ API è°ƒç”¨è·¯å¾„
- è¯„è®ºæŸ¥è¯¢çš„åˆ†é¡µç­–ç•¥ä¸è¿‡æ»¤æ¡ä»¶
- è¯„è®ºé€šçŸ¥æœºåˆ¶çš„é›†æˆå»ºè®®ï¼ˆåŸºäºç°æœ‰ Webhook äº‹ä»¶ï¼‰

## é¡¹ç›®ç»“æ„
è¯„è®ºç³»ç»Ÿä½äºæ–‡æ¡£å†…å®¹æ¨¡å—ä¸‹ï¼Œé‡‡ç”¨ TypeSpec å®šä¹‰ç»Ÿä¸€çš„è¯„è®ºæ¨¡å‹ä¸ API æ¥å£ï¼Œå¹¶é€šè¿‡å…±äº«ç±»å‹æä¾›é€šç”¨å“åº”ä¸åˆ†é¡µèƒ½åŠ›ã€‚

```mermaid
graph TB
subgraph "æ–‡æ¡£å†…å®¹æ¨¡å—"
A["content/index.tsp<br/>å¯¼å…¥ comments.tsp"]
B["content/comments.tsp<br/>è¯„è®ºæ¨¡å‹ä¸æ¥å£"]
end
subgraph "å…±äº«ç±»å‹"
C["shared/common.tsp<br/>ApiResponse/Page/UserRef/Attachment ç­‰"]
end
subgraph "æ–‡æ¡£æ¨¡å‹å‚è€ƒ"
D["guides/document-model.md<br/>è¯„è®ºå±‚çº§ä¸ç¤ºä¾‹"]
end
subgraph "é€šçŸ¥é›†æˆ"
E["extensions/webhooks/WEBHOOK_GUIDE.md<br/>è¯„è®ºç›¸å…³äº‹ä»¶"]
F["docs-src/guides/webhooks.md<br/>Webhook é›†æˆç¤ºä¾‹"]
end
A --> B
B --> C
D --> B
E --> B
F --> B
```

å›¾è¡¨æ¥æº
- [index.tsp](file://api/document/content/index.tsp#L1-L13)
- [comments.tsp](file://api/document/content/comments.tsp#L1-L40)
- [common.tsp](file://api/shared/common.tsp#L153-L203)
- [document-model.md](file://docs-src/guides/document-model.md#L354-L410)
- [WEBHOOK_GUIDE.md](file://api/extensions/webhooks/WEBHOOK_GUIDE.md#L72-L111)
- [webhooks.md](file://docs-src/guides/webhooks.md#L83-L121)

ç« èŠ‚æ¥æº
- [index.tsp](file://api/document/content/index.tsp#L1-L13)
- [comments.tsp](file://api/document/content/comments.tsp#L1-L40)

## æ ¸å¿ƒç»„ä»¶
- è¯„è®ºç›®æ ‡å®šä½å™¨ï¼ˆCommentTargetï¼‰
  - scopeï¼šæ”¯æŒ "document"ã€"field"ã€"row"ã€"cell"
  - fieldIdï¼šå½“ scope ä¸º field æˆ– cell æ—¶å¿…å¡«
  - rowIdï¼šå½“ scope ä¸º row æˆ– cell æ—¶å¿…å¡«
- ç»Ÿä¸€è¯„è®ºæ¨¡å‹ï¼ˆCommentï¼‰
  - targetï¼šå®šä½è¯„è®ºä½ç½®
  - parentIdï¼šå›å¤å…¶ä»–è¯„è®ºå½¢æˆçº¿ç¨‹
  - contentï¼šå¯Œæ–‡æœ¬å†…å®¹
  - mentionsï¼š@æåŠç”¨æˆ·é›†åˆ
  - attachmentsï¼šé™„ä»¶é›†åˆ
  - reactionsï¼šè¡¨æƒ…ååº”é›†åˆ
  - resolved/resolvedAt/resolvedByï¼šå·²è§£å†³æ ‡è®°ä¸ä¿¡æ¯
  - pinnedï¼šç½®é¡¶æ ‡è®°
  - createdAt/createdBy/updatedAt/updatedByï¼šå…ƒä¿¡æ¯
  - replyCountï¼šç›´æ¥å›å¤æ•°
- è¡¨æƒ…ååº”ï¼ˆReactionï¼‰
  - emojiï¼šè¡¨æƒ…ä»£ç 
  - usersï¼šååº”ç”¨æˆ·é›†åˆ
  - countï¼šååº”æ•°é‡
- è¯„è®º APIï¼ˆCommentsApiï¼‰
  - listCommentsï¼šæŒ‰ä½ç½®ä¸çº¿ç¨‹è¿‡æ»¤æŸ¥è¯¢
  - createCommentï¼šåˆ›å»ºè¯„è®ºï¼ˆå«å›å¤ï¼‰
  - getCommentï¼šè·å–è¯„è®ºè¯¦æƒ…
  - updateCommentï¼šæ›´æ–°è¯„è®º
  - deleteCommentï¼šåˆ é™¤è¯„è®ºï¼ˆè¿åŒå›å¤ï¼‰
  - pinComment/unpinCommentï¼šç½®é¡¶/å–æ¶ˆç½®é¡¶
  - resolveComment/unresolveCommentï¼šæ ‡è®°å·²è§£å†³/å–æ¶ˆ
  - addReaction/removeReactionï¼šæ·»åŠ /ç§»é™¤è¡¨æƒ…ååº”

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L43-L99)
- [comments.tsp](file://api/document/content/comments.tsp#L108-L237)
- [comments.tsp](file://api/document/content/comments.tsp#L246-L471)
- [common.tsp](file://api/shared/common.tsp#L153-L203)

## æ¶æ„æ€»è§ˆ
è¯„è®ºç³»ç»Ÿé€šè¿‡ CommentsApi æš´éœ² REST æ¥å£ï¼Œç»Ÿä¸€ä½¿ç”¨ Comment æ¨¡å‹æ‰¿è½½è¯„è®ºç”Ÿå‘½å‘¨æœŸä¸åä½œèƒ½åŠ›ã€‚æŸ¥è¯¢ä¸åˆ†é¡µéµå¾ªé€šç”¨ Page ç»“æ„ï¼Œé€šçŸ¥é€šè¿‡ Webhook äº‹ä»¶æ¨é€ã€‚

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant API as "CommentsApi"
participant Model as "Comment/CommentTarget/Reaction"
participant Store as "æŒä¹…åŒ–å­˜å‚¨"
participant Notify as "Webhook é€šçŸ¥"
Client->>API : POST /doc/{docType}/{docId}/comments
API->>Model : æ ¡éªŒ Commenttarget/mentions/reactions
API->>Store : åˆ›å»ºè¯„è®ºå¹¶å†™å…¥
Store-->>API : æ–°è¯„è®ºIDä¸æ—¶é—´æˆ³
API-->>Client : ApiResponse<Comment>
Note over API,Notify : è¯„è®ºåˆ›å»ºåè§¦å‘ comment_created äº‹ä»¶
API->>Notify : æ¨é€ Webhook è½½è·
```

å›¾è¡¨æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L246-L376)
- [common.tsp](file://api/shared/common.tsp#L153-L203)
- [WEBHOOK_GUIDE.md](file://api/extensions/webhooks/WEBHOOK_GUIDE.md#L72-L111)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### è¯„è®ºæ¨¡å‹ä¸å®šä½è¯­ä¹‰
- target.scope
  - "document"ï¼šå¯¹æ•´ä¸ªæ–‡æ¡£è¿›è¡Œè®¨è®º
  - "field"ï¼šé’ˆå¯¹æŸå­—æ®µçš„è®¨è®ºï¼Œéœ€æä¾› fieldId
  - "row"ï¼šé’ˆå¯¹æŸä¸€è¡Œçš„è®¨è®ºï¼Œéœ€æä¾› rowId
  - "cell"ï¼šé’ˆå¯¹æŸå•å…ƒæ ¼çš„è®¨è®ºï¼Œéœ€æä¾› rowId ä¸ fieldId
- fieldIdã€rowId
  - ç”¨äºåœ¨å¤šå±‚çº§å®šä½ä¸­ç²¾ç¡®é”å®šç›®æ ‡
  - ä¸æ–‡æ¡£æ¨¡å‹ä¸­çš„å­—æ®µä¸è¡Œæ¦‚å¿µä¸€è‡´ï¼Œç¡®ä¿è¯„è®ºä¸æ•°æ®ç»“æ„å¯¹é½
- parentId
  - è‹¥å­˜åœ¨ï¼Œè¡¨ç¤ºè¯¥è¯„è®ºæ˜¯å¯¹å¦ä¸€æ¡è¯„è®ºçš„å›å¤ï¼Œå½¢æˆè®¨è®ºçº¿ç¨‹
  - åˆ é™¤è¯„è®ºä¼šçº§è”åˆ é™¤å…¶æ‰€æœ‰å›å¤ï¼ˆè§æ¥å£æ³¨é‡Šï¼‰

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L43-L75)
- [comments.tsp](file://api/document/content/comments.tsp#L122-L131)
- [comments.tsp](file://api/document/content/comments.tsp#L360-L376)

### çº¿ç¨‹åŒ–è¯„è®ºä¸åµŒå¥—ç»“æ„
- çº¿ç¨‹åŒ–è¯„è®ºé€šè¿‡ parentId å»ºç«‹çˆ¶å­å…³ç³»
- åµŒå¥—ç»“æ„å¤„ç†å»ºè®®
  - å±•ç¤ºæ—¶æŒ‰ createdAt/updatedAt æ’åºï¼Œæ”¯æŒå±•å¼€/æŠ˜å 
  - é€’å½’æ¸²æŸ“å­è¯„è®ºï¼Œé¿å…æ— é™æ·±åº¦å¯¼è‡´çš„æ€§èƒ½é—®é¢˜
  - é™åˆ¶æœ€å¤§åµŒå¥—å±‚çº§æˆ–é‡‡ç”¨â€œæŸ¥çœ‹æ›´å¤šå›å¤â€åˆ†é¡µåŠ è½½
- åˆ é™¤è¡Œä¸º
  - åˆ é™¤çˆ¶è¯„è®ºæ—¶ï¼Œåº”çº§è”åˆ é™¤å…¶æ‰€æœ‰å­è¯„è®ºï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L122-L131)
- [comments.tsp](file://api/document/content/comments.tsp#L360-L376)

### è¡¨æƒ…ååº”ï¼ˆreactionsï¼‰æ•°æ®ç»“æ„ä¸æ“ä½œ
- æ•°æ®ç»“æ„
  - emojiï¼šè¡¨æƒ…ä»£ç ï¼ˆå¦‚ ğŸ‘ã€â¤ï¸ ç­‰ï¼‰
  - usersï¼šå¯¹è¯¥è¡¨æƒ…åšå‡ºååº”çš„ç”¨æˆ·é›†åˆ
  - countï¼šè¯¥è¡¨æƒ…çš„æ€»æ¬¡æ•°
- å¢åˆ æ”¹æ“ä½œ
  - æ·»åŠ ååº”ï¼šPOST /doc/{docType}/{docId}/comments/{commentId}/reactions?emoji=...
  - ç§»é™¤ååº”ï¼šDELETE /doc/{docType}/{docId}/comments/{commentId}/reactions/{emoji}
- UI å»ºè®®
  - å±•ç¤ºæ¯ä¸ªè¡¨æƒ…çš„æ€»æ•°ä¸å‚ä¸è€…å¤´åƒ
  - æ”¯æŒä¸€é”®åˆ‡æ¢è‡ªå·±çš„ååº”ï¼ˆæ·»åŠ /ç§»é™¤ï¼‰
  - å¯¹é‡å¤ç‚¹å‡»è¿›è¡Œå»æŠ–å¤„ç†ï¼Œé¿å…é¢‘ç¹è¯·æ±‚

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L81-L99)
- [comments.tsp](file://api/document/content/comments.tsp#L447-L471)

### å·²è§£å†³çŠ¶æ€ï¼ˆresolvedï¼‰çš„ä¸šåŠ¡æ„ä¹‰ä¸ UI å‘ˆç°
- ä¸šåŠ¡æ„ä¹‰
  - æ ‡è®°è¯„è®ºåŠå…¶è®¨è®ºçº¿ç¨‹ä¸ºå·²è§£å†³ï¼Œä¾¿äºè¿½è¸ªé—®é¢˜é—­ç¯
  - å¯è®°å½• resolvedAt ä¸ resolvedByï¼Œå½¢æˆå®¡è®¡çº¿ç´¢
- UI å»ºè®®
  - åœ¨è¯„è®ºå¡ç‰‡ä¸Šå±•ç¤ºâ€œå·²è§£å†³â€çŠ¶æ€ä¸è§£å†³äººä¿¡æ¯
  - å¯å°†å·²è§£å†³è¯„è®ºç½®ç°æˆ–åŠ æ¨ªçº¿ï¼Œé™ä½è§†è§‰æƒé‡
  - æä¾›â€œæ ‡è®°ä¸ºå·²è§£å†³/å–æ¶ˆè§£å†³â€çš„å¿«æ·æŒ‰é’®

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L169-L204)
- [comments.tsp](file://api/document/content/comments.tsp#L408-L437)

### API è°ƒç”¨ç¤ºä¾‹ï¼ˆç»“åˆæ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼‰
ä»¥ä¸‹ç¤ºä¾‹åŸºäºæ–‡æ¡£æ¨¡å‹ä¸­çš„ç¤ºä¾‹ä¸ CommentsApi æ¥å£ï¼Œå±•ç¤ºå¦‚ä½•åˆ›å»ºä¸åŒå±‚çº§çš„è¯„è®ºã€‚è¯·å°†å ä½ç¬¦æ›¿æ¢ä¸ºçœŸå®å€¼ã€‚

- åˆ›å»ºæ–‡æ¡£çº§è¯„è®º
  - æ–¹æ³•ä¸è·¯å¾„ï¼šPOST /doc/{docType}/{docId}/comments
  - è¯·æ±‚ä½“è¦ç‚¹ï¼štarget.scope = "document"
  - å‚è€ƒç¤ºä¾‹è·¯å¾„ï¼š[æ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼ˆæ–‡æ¡£çº§è¯„è®ºï¼‰](file://docs-src/guides/document-model.md#L412-L423)

- åˆ›å»ºè¡Œçº§è¯„è®º
  - æ–¹æ³•ä¸è·¯å¾„ï¼šPOST /doc/{docType}/{docId}/comments
  - è¯·æ±‚ä½“è¦ç‚¹ï¼štarget.scope = "row"ï¼Œtarget.rowId = "{rowId}"
  - å‚è€ƒç¤ºä¾‹è·¯å¾„ï¼š[æ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼ˆè¡Œçº§è¯„è®ºï¼‰](file://docs-src/guides/document-model.md#L424-L433)

- åˆ›å»ºå•å…ƒæ ¼çº§è¯„è®º
  - æ–¹æ³•ä¸è·¯å¾„ï¼šPOST /doc/{docType}/{docId}/comments
  - è¯·æ±‚ä½“è¦ç‚¹ï¼štarget.scope = "cell"ï¼Œtarget.rowId = "{rowId}"ï¼Œtarget.fieldId = "{fieldId}"
  - å‚è€ƒç¤ºä¾‹è·¯å¾„ï¼š[æ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼ˆå•å…ƒæ ¼è¯„è®ºï¼‰](file://docs-src/guides/document-model.md#L434-L444)

- å›å¤è¯„è®ºï¼ˆçº¿ç¨‹ï¼‰
  - æ–¹æ³•ä¸è·¯å¾„ï¼šPOST /doc/{docType}/{docId}/comments
  - è¯·æ±‚ä½“è¦ç‚¹ï¼šparentId = "{commentId}"ï¼ˆå¯¹å·²æœ‰è¯„è®ºçš„å›å¤ï¼‰
  - å‚è€ƒç¤ºä¾‹è·¯å¾„ï¼š[æ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼ˆå›å¤è¯„è®ºï¼‰](file://docs-src/guides/document-model.md#L445-L451)

- æ·»åŠ è¡¨æƒ…ååº”
  - æ–¹æ³•ä¸è·¯å¾„ï¼šPOST /doc/{docType}/{docId}/comments/{commentId}/reactions?emoji=ğŸ‘
  - å‚è€ƒç¤ºä¾‹è·¯å¾„ï¼š[æ–‡æ¡£æ¨¡å‹ç¤ºä¾‹ï¼ˆæ·»åŠ ååº”ï¼‰](file://docs-src/guides/document-model.md#L452-L457)

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L246-L376)
- [document-model.md](file://docs-src/guides/document-model.md#L412-L457)

### è¯„è®ºæŸ¥è¯¢çš„åˆ†é¡µç­–ç•¥ä¸è¿‡æ»¤æ¡ä»¶
- è¿‡æ»¤æ¡ä»¶
  - scopeï¼šdocument/field/row/cell
  - fieldIdï¼šå½“ scope ä¸º field æˆ– cell æ—¶
  - rowIdï¼šå½“ scope ä¸º row æˆ– cell æ—¶
  - parentIdï¼šæŒ‡å®šè¯„è®ºçš„å›å¤
- åˆ†é¡µå‚æ•°
  - page/pageSizeï¼šä¸é€šç”¨ Page ç»“æ„é…åˆä½¿ç”¨
  - å“åº”ç»“æ„ï¼šApiResponse<Page<Comment>>
- å»ºè®®
  - é»˜è®¤ pageSize æ§åˆ¶åœ¨åˆç†èŒƒå›´ï¼ˆä¾‹å¦‚ 20~50ï¼‰ï¼Œé¿å…ä¸€æ¬¡æ€§æ‹‰å–è¿‡å¤šæ•°æ®
  - å¯¹æ·±å±‚çº¿ç¨‹è¯„è®ºé‡‡ç”¨â€œå±•å¼€åŠ è½½æ›´å¤šå›å¤â€çš„äº¤äº’æ¨¡å¼
  - å¯¹é«˜é¢‘æŸ¥è¯¢å»ºç«‹ç´¢å¼•ï¼ˆscopeã€rowIdã€fieldIdã€parentIdï¼‰

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L271-L282)
- [common.tsp](file://api/shared/common.tsp#L179-L203)

### è¯„è®ºé€šçŸ¥æœºåˆ¶é›†æˆå»ºè®®
- å¯ç”¨äº‹ä»¶
  - comment_createdï¼šåˆ›å»ºè¯„è®º
  - comment_updatedï¼šæ›´æ–°è¯„è®º
  - comment_deletedï¼šåˆ é™¤è¯„è®º
  - comment_resolvedï¼šæ ‡è®°å·²è§£å†³
  - comment_mentionedï¼š@æåŠç”¨æˆ·
- Webhook é›†æˆæ­¥éª¤
  - åœ¨å¹³å°é…ç½® Webhookï¼Œè·å–å¯†é’¥ä¸å›è°ƒåœ°å€
  - æœåŠ¡ç«¯æ¥æ”¶äº‹ä»¶åï¼ŒéªŒè¯ç­¾åï¼ˆä½¿ç”¨æä¾›çš„ç¤ºä¾‹ä»£ç ï¼‰
  - æ ¹æ®äº‹ä»¶ç±»å‹è§¦å‘å†…éƒ¨æµç¨‹ï¼ˆå¦‚å‘é€é‚®ä»¶ã€ç«™å†…ä¿¡ã€Slack é›†æˆç­‰ï¼‰
- å‚è€ƒç¤ºä¾‹
  - äº‹ä»¶ç±»å‹ä¸è½½è·ç¤ºä¾‹ï¼š[Webhook æŒ‡å—ï¼ˆè¯„è®ºäº‹ä»¶ï¼‰](file://api/extensions/webhooks/WEBHOOK_GUIDE.md#L72-L111)
  - Webhook é›†æˆç¤ºä¾‹ï¼ˆExpressï¼‰ï¼š[Webhook é›†æˆç¤ºä¾‹](file://docs-src/guides/webhooks.md#L235-L319)

ç« èŠ‚æ¥æº
- [WEBHOOK_GUIDE.md](file://api/extensions/webhooks/WEBHOOK_GUIDE.md#L72-L111)
- [webhooks.md](file://docs-src/guides/webhooks.md#L83-L121)
- [webhooks.md](file://docs-src/guides/webhooks.md#L235-L319)

## ä¾èµ–åˆ†æ
- CommentsApi ä¾èµ–å…±äº«ç±»å‹
  - ApiResponse<T>ï¼šç»Ÿä¸€å“åº”åŒ…è£…
  - Page<T>ï¼šåˆ†é¡µç»“æ„
  - UserRef/Attachmentï¼šç”¨æˆ·å¼•ç”¨ä¸é™„ä»¶
- è¯„è®ºæ¨¡å‹ä¾èµ–
  - CommentTargetï¼šå®šä½å™¨
  - Reactionï¼šè¡¨æƒ…ååº”
- æ–‡æ¡£æ¨¡å‹å‚è€ƒ
  - æ–‡æ¡£æ¨¡å‹ä¸­å¯¹ Comments çš„å±‚çº§å®šä½ä¸ç¤ºä¾‹ï¼Œä¸º API ä½¿ç”¨æä¾›ä¸Šä¸‹æ–‡

```mermaid
classDiagram
class CommentTarget {
+string scope
+string fieldId?
+string rowId?
}
class Reaction {
+string emoji
+UserRef[] users
+int32 count
}
class Comment {
+string id
+CommentTarget target
+string parentId?
+string content
+UserRef[] mentions?
+Attachment[] attachments?
+Reaction[] reactions?
+boolean resolved?
+string resolvedAt?
+UserRef resolvedBy?
+boolean pinned?
+string createdAt?
+UserRef createdBy?
+string updatedAt?
+UserRef updatedBy?
+int32 replyCount?
}
class CommentsApi {
+listComments(...)
+createComment(...)
+getComment(...)
+updateComment(...)
+deleteComment(...)
+pinComment(...)
+unpinComment(...)
+resolveComment(...)
+unresolveComment(...)
+addReaction(...)
+removeReaction(...)
}
Comment --> CommentTarget : "ä½¿ç”¨"
Comment --> Reaction : "åŒ…å«"
CommentsApi --> Comment : "è¯»å†™"
```

å›¾è¡¨æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L43-L99)
- [comments.tsp](file://api/document/content/comments.tsp#L108-L237)
- [comments.tsp](file://api/document/content/comments.tsp#L246-L471)
- [common.tsp](file://api/shared/common.tsp#L153-L203)

ç« èŠ‚æ¥æº
- [comments.tsp](file://api/document/content/comments.tsp#L43-L237)
- [common.tsp](file://api/shared/common.tsp#L153-L203)

## æ€§èƒ½è€ƒè™‘
- åˆ†é¡µä¸æ¸¸æ ‡
  - ä½¿ç”¨ page/pageSize æ§åˆ¶åˆ—è¡¨è§„æ¨¡
  - å¯¹æ·±åˆ†é¡µåœºæ™¯å»ºè®®å¼•å…¥æ¸¸æ ‡ï¼ˆcursorï¼‰ä»¥æå‡ç¨³å®šæ€§
- çº¿ç¨‹æ·±åº¦æ§åˆ¶
  - é™åˆ¶åµŒå¥—å±‚çº§ï¼Œé¿å…è¿‡æ·±æ ‘å½¢æ¸²æŸ“å¯¼è‡´å¡é¡¿
- æŸ¥è¯¢ä¼˜åŒ–
  - ä¸º scopeã€rowIdã€fieldIdã€parentId å»ºç«‹å¤åˆç´¢å¼•
  - å¯¹é«˜é¢‘è¿‡æ»¤å­—æ®µå¢åŠ è¦†ç›–ç´¢å¼•
- é™„ä»¶ä¸å¯Œæ–‡æœ¬
  - é™„ä»¶æ•°é‡ä¸å¤§å°åº”å—æ§ï¼Œé¿å…å½±å“åˆ—è¡¨åŠ è½½æ€§èƒ½
  - å¯Œæ–‡æœ¬å†…å®¹å»ºè®®å»¶è¿ŸåŠ è½½æˆ–æ‡’æ¸²æŸ“

[æœ¬èŠ‚ä¸ºé€šç”¨æŒ‡å¯¼ï¼Œæ— éœ€ç‰¹å®šæ–‡ä»¶æ¥æº]

## æ•…éšœæ’æŸ¥æŒ‡å—
- å¸¸è§é”™è¯¯ç 
  - COMMENT_NOT_FOUNDï¼šè¯„è®ºä¸å­˜åœ¨
  - PAGE_OUT_OF_RANGEï¼šåˆ†é¡µè¶…å‡ºèŒƒå›´
- æ’æŸ¥æ­¥éª¤
  - ç¡®è®¤è¯·æ±‚å‚æ•°ï¼šscopeã€fieldIdã€rowIdã€parentId æ˜¯å¦ç¬¦åˆç›®æ ‡å±‚çº§
  - æ£€æŸ¥æƒé™ï¼šä»…è¯„è®ºåˆ›å»ºè€…æˆ–ç®¡ç†å‘˜å¯ç¼–è¾‘/åˆ é™¤
  - æ ¡éªŒå“åº”ï¼šä½¿ç”¨ ApiResponse ç»“æ„æ ¸å¯¹ success/code/message/payload
- å»ºè®®çš„æ—¥å¿—
  - è®°å½•å…³é”®æ“ä½œï¼ˆåˆ›å»º/æ›´æ–°/åˆ é™¤/ç½®é¡¶/è§£å†³/ååº”ï¼‰ä¸è§¦å‘ç”¨æˆ·
  - è®°å½•å¼‚å¸¸é”™è¯¯ç ä¸å †æ ˆä¿¡æ¯ï¼Œä¾¿äºå®šä½é—®é¢˜

ç« èŠ‚æ¥æº
- [common.tsp](file://api/shared/common.tsp#L80-L152)
- [comments.tsp](file://api/document/content/comments.tsp#L271-L282)

## ç»“è®º
è¯„è®ºç³»ç»Ÿé€šè¿‡ç»Ÿä¸€çš„ Comment æ¨¡å‹ä¸ CommentsApiï¼Œå®ç°äº†æ–‡æ¡£ã€å­—æ®µã€è¡Œã€å•å…ƒæ ¼å››çº§ç²¾ç¡®å®šä½ï¼Œæ”¯æŒçº¿ç¨‹åŒ–è®¨è®ºã€è¡¨æƒ…ååº”ã€ç½®é¡¶ä¸å·²è§£å†³æ ‡è®°ï¼Œå¹¶é€šè¿‡ Webhook æä¾›é€šçŸ¥é›†æˆèƒ½åŠ›ã€‚ç»“åˆåˆç†çš„åˆ†é¡µç­–ç•¥ä¸ç´¢å¼•è®¾è®¡ï¼Œå¯åœ¨å¤§è§„æ¨¡åä½œåœºæ™¯ä¸­ä¿æŒè‰¯å¥½çš„æ€§èƒ½ä¸ç”¨æˆ·ä½“éªŒã€‚

[æœ¬èŠ‚ä¸ºæ€»ç»“ï¼Œæ— éœ€ç‰¹å®šæ–‡ä»¶æ¥æº]

## é™„å½•
- ç›¸å…³æ–‡æ¡£ä¸ç¤ºä¾‹
  - æ–‡æ¡£æ¨¡å‹ä¸è¯„è®ºç¤ºä¾‹ï¼š[æ–‡æ¡£æ¨¡å‹](file://docs-src/guides/document-model.md#L354-L457)
  - Webhook äº‹ä»¶ä¸é›†æˆç¤ºä¾‹ï¼š[Webhook æŒ‡å—](file://api/extensions/webhooks/WEBHOOK_GUIDE.md#L72-L111)ï¼Œ[Webhook é›†æˆç¤ºä¾‹](file://docs-src/guides/webhooks.md#L235-L319)

[æœ¬èŠ‚ä¸ºè¡¥å……ææ–™ï¼Œæ— éœ€ç‰¹å®šæ–‡ä»¶æ¥æº]