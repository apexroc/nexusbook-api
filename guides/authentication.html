<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤è¯æˆæƒæŒ‡å— - NexusBook API æ–‡æ¡£</title>
    <link rel="stylesheet" href="/nexusbook-api/styles/main.css?v=${Date.now()}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
    <script>
      if (window.hljs) { hljs.highlightAll(); }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body class="has-sidebar">
    <nav class="sidebar">
<div class="sidebar-header">
<a href="/nexusbook-api/index.html" class="sidebar-logo">NexusBook API</a>
</div>
<div class="sidebar-content">
<div class="sidebar-group expanded">
<div class="sidebar-group-title">å¼€å§‹ä½¿ç”¨</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/index.html">æ¦‚è§ˆ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/getting-started.html">å¿«é€Ÿå¼€å§‹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/authentication.html">è®¤è¯æˆæƒ</a>
</li>
</ul>
</div>
<div class="sidebar-group expanded">
<div class="sidebar-group-title">æ ¸å¿ƒæ¦‚å¿µ</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/document-model.html">æ–‡æ¡£æ¨¡å‹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/data-operations.html">æ•°æ®æ“ä½œ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/webhooks.html">Webhook äº‹ä»¶</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/realtime-collaboration.html">å®æ—¶ååŒ</a>
</li>
</ul>
</div>
<div class="sidebar-group expanded">
<div class="sidebar-group-title">API å‚è€ƒ</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/api/index.html">API ç«¯ç‚¹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/references/field-types.html">å­—æ®µç±»å‹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/references/error-codes.html">é”™è¯¯ç </a>
</li>
</ul>
</div>
<div class="sidebar-group ">
<div class="sidebar-group-title">å¼€å‘æŒ‡å—</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/development.html">å¼€å‘ç¯å¢ƒ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/architecture.html">æ¶æ„è®¾è®¡</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/best-practices.html">æœ€ä½³å®è·µ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/examples.html">å®Œæ•´ç¤ºä¾‹</a>
</li>
</ul>
</div>
<div class="sidebar-group ">
<div class="sidebar-group-title">å…¶ä»–èµ„æº</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/references/i18n.html">å›½é™…åŒ–</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/references/changelog.html">æ›´æ–°æ—¥å¿—</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/CONTRIBUTING.html">è´¡çŒ®æŒ‡å—</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/TROUBLESHOOTING.html">é—®é¢˜æ’æŸ¥</a>
</li>
</ul>
</div>
</div>
</nav>

    
    <div class="main-wrapper">
        <header class="header">
            <div class="container">
                <h1 class="logo"><a href="/nexusbook-api/index.html">NexusBook API</a></h1>
                <nav class="nav">
                    <a href="/nexusbook-api/index.html">é¦–é¡µ</a>
                    <a href="/nexusbook-api/api/" >API å‚è€ƒ</a>
                    <a href="/nexusbook-api/guides/getting-started.html" class="active">å¼€å‘æŒ‡å—</a>
                    <a href="/nexusbook-api/references/error-codes.html" >å‚è€ƒæ–‡æ¡£</a>
                    <a href="https://github.com/NexusBook/nexusbook-api" target="_blank">GitHub</a>
                </nav>
            </div>
        </header>

        <main class="main content-page">
            <div class="container">
                <article class="content">
                    <h1>è®¤è¯æˆæƒæŒ‡å—</h1>
<p>NexusBook API ä½¿ç”¨ OAuth2 å’Œ OIDC æ ‡å‡†è¿›è¡Œè®¤è¯å’Œæˆæƒï¼Œæä¾›å®‰å…¨å¯é çš„è®¿é—®æ§åˆ¶æœºåˆ¶ã€‚</p>
<h2>OAuth2 è®¤è¯æµç¨‹</h2>
<h3>å®¢æˆ·ç«¯å‡­è¯æµç¨‹ï¼ˆClient Credentials Flowï¼‰</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæœåŠ¡ç«¯åº”ç”¨ã€åå°ä»»åŠ¡ã€ç³»ç»Ÿé›†æˆ</p>
<p>è¿™æ˜¯æœ€ç®€å•çš„è®¤è¯æ–¹å¼ï¼Œé€‚åˆä¸éœ€è¦ç”¨æˆ·äº¤äº’çš„åœºæ™¯ã€‚</p>
<h4>æµç¨‹å›¾</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯  â”‚                                  â”‚ æˆæƒæœåŠ¡å™¨ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                                            â”‚
     â”‚  POST /token                               â”‚
     â”‚  grant_type=client_credentials             â”‚
     â”‚  client_id=xxx                             â”‚
     â”‚  client_secret=xxx                         â”‚
     â”‚  scope=doc:read data:write                 â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
     â”‚                                            â”‚
     â”‚                 access_token               â”‚
     â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                                            â”‚
</code></pre>
<h4>ç¤ºä¾‹ä»£ç </h4>
<p><strong>cURL</strong>:</p>
<pre><code class="language-bash">curl -X POST https://auth.nexusbook.com/token \
  -H &#39;Content-Type: application/x-www-form-urlencoded&#39; \
  -d &#39;grant_type=client_credentials&#39; \
  -d &#39;client_id=your_client_id&#39; \
  -d &#39;client_secret=your_client_secret&#39; \
  -d &#39;scope=doc:read data:read data:write&#39;
</code></pre>
<p><strong>JavaScript (Node.js)</strong>:</p>
<pre><code class="language-javascript">const axios = require(&#39;axios&#39;);
const qs = require(&#39;querystring&#39;);

async function getAccessToken() {
  const response = await axios.post(
    &#39;https://auth.nexusbook.com/token&#39;,
    qs.stringify({
      grant_type: &#39;client_credentials&#39;,
      client_id: &#39;your_client_id&#39;,
      client_secret: &#39;your_client_secret&#39;,
      scope: &#39;doc:read data:read data:write&#39;
    }),
    {
      headers: { &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39; }
    }
  );
  
  return response.data.access_token;
}
</code></pre>
<p><strong>Python</strong>:</p>
<pre><code class="language-python">import requests

def get_access_token():
    response = requests.post(
        &#39;https://auth.nexusbook.com/token&#39;,
        data={
            &#39;grant_type&#39;: &#39;client_credentials&#39;,
            &#39;client_id&#39;: &#39;your_client_id&#39;,
            &#39;client_secret&#39;: &#39;your_client_secret&#39;,
            &#39;scope&#39;: &#39;doc:read data:read data:write&#39;
        }
    )
    
    return response.json()[&#39;access_token&#39;]
</code></pre>
<h3>æˆæƒç æµç¨‹ï¼ˆAuthorization Code Flowï¼‰</h3>
<p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šWeb åº”ç”¨ã€ç§»åŠ¨åº”ç”¨ï¼ˆéœ€è¦ç”¨æˆ·æˆæƒï¼‰</p>
<p>è¿™æ˜¯æœ€å®‰å…¨çš„è®¤è¯æ–¹å¼ï¼Œé€‚åˆéœ€è¦ç”¨æˆ·æˆæƒçš„åœºæ™¯ã€‚</p>
<h4>æµç¨‹å›¾</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·    â”‚          â”‚  å®¢æˆ·ç«¯   â”‚          â”‚ æˆæƒæœåŠ¡å™¨ â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                     â”‚
     â”‚  è®¿é—®åº”ç”¨           â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚                     â”‚
     â”‚                    â”‚  é‡å®šå‘åˆ°æˆæƒé¡µé¢     â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
     â”‚                    â”‚                     â”‚
     â”‚                    â”‚  æ˜¾ç¤ºæˆæƒé¡µé¢         â”‚
     â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                     â”‚
     â”‚  ç”¨æˆ·æˆæƒ           â”‚                     â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
     â”‚                    â”‚                     â”‚
     â”‚                    â”‚  é‡å®šå‘+æˆæƒç         â”‚
     â”‚                    â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                     â”‚
     â”‚                    â”‚  ç”¨æˆæƒç æ¢å–Token    â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€&gt;â”‚
     â”‚                    â”‚                     â”‚
     â”‚                    â”‚  access_token       â”‚
     â”‚                    â”‚&lt;â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                     â”‚
</code></pre>
<h4>æ­¥éª¤è¯¦è§£</h4>
<p><strong>æ­¥éª¤ 1ï¼šå¼•å¯¼ç”¨æˆ·åˆ°æˆæƒé¡µé¢</strong></p>
<pre><code class="language-javascript">// æ„å»ºæˆæƒ URL
const authUrl = new URL(&#39;https://auth.nexusbook.com/authorize&#39;);
authUrl.searchParams.set(&#39;response_type&#39;, &#39;code&#39;);
authUrl.searchParams.set(&#39;client_id&#39;, &#39;your_client_id&#39;);
authUrl.searchParams.set(&#39;redirect_uri&#39;, &#39;https://yourapp.com/callback&#39;);
authUrl.searchParams.set(&#39;scope&#39;, &#39;doc:read data:read data:write&#39;);
authUrl.searchParams.set(&#39;state&#39;, generateRandomState()); // CSRF ä¿æŠ¤

// é‡å®šå‘ç”¨æˆ·
window.location.href = authUrl.toString();
</code></pre>
<p><strong>æ­¥éª¤ 2ï¼šå¤„ç†å›è°ƒå¹¶æ¢å– Token</strong></p>
<pre><code class="language-javascript">// åœ¨å›è°ƒç«¯ç‚¹å¤„ç†
app.get(&#39;/callback&#39;, async (req, res) =&gt; {
  const { code, state } = req.query;
  
  // éªŒè¯ state é˜²æ­¢ CSRF
  if (state !== expectedState) {
    return res.status(400).send(&#39;Invalid state&#39;);
  }
  
  // ç”¨æˆæƒç æ¢å– Token
  const response = await axios.post(
    &#39;https://auth.nexusbook.com/token&#39;,
    qs.stringify({
      grant_type: &#39;authorization_code&#39;,
      code: code,
      client_id: &#39;your_client_id&#39;,
      client_secret: &#39;your_client_secret&#39;,
      redirect_uri: &#39;https://yourapp.com/callback&#39;
    }),
    {
      headers: { &#39;Content-Type&#39;: &#39;application/x-www-form-urlencoded&#39; }
    }
  );
  
  const { access_token, refresh_token } = response.data;
  
  // ä¿å­˜ Token
  // ...
});
</code></pre>
<h2>OIDC é›†æˆ</h2>
<h3>å‘ç°ç«¯ç‚¹</h3>
<p>è·å– OIDC é…ç½®ä¿¡æ¯ï¼š</p>
<pre><code class="language-bash">curl https://auth.nexusbook.com/.well-known/openid-configuration
</code></pre>
<p><strong>å“åº”ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-json">{
  &quot;issuer&quot;: &quot;https://auth.nexusbook.com&quot;,
  &quot;authorization_endpoint&quot;: &quot;https://auth.nexusbook.com/authorize&quot;,
  &quot;token_endpoint&quot;: &quot;https://auth.nexusbook.com/token&quot;,
  &quot;userinfo_endpoint&quot;: &quot;https://auth.nexusbook.com/userinfo&quot;,
  &quot;jwks_uri&quot;: &quot;https://auth.nexusbook.com/jwks.json&quot;,
  &quot;scopes_supported&quot;: [&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;, &quot;doc:read&quot;, &quot;data:write&quot;],
  &quot;response_types_supported&quot;: [&quot;code&quot;, &quot;token&quot;],
  &quot;grant_types_supported&quot;: [&quot;authorization_code&quot;, &quot;client_credentials&quot;, &quot;refresh_token&quot;]
}
</code></pre>
<h3>JWKS ç«¯ç‚¹</h3>
<p>è·å– JWT éªŒè¯å…¬é’¥ï¼š</p>
<pre><code class="language-bash">curl https://auth.nexusbook.com/jwks.json
</code></pre>
<h3>UserInfo ç«¯ç‚¹</h3>
<p>è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯ï¼š</p>
<pre><code class="language-bash">curl https://auth.nexusbook.com/userinfo \
  -H &#39;Authorization: Bearer YOUR_ACCESS_TOKEN&#39;
</code></pre>
<h2>Token ç®¡ç†</h2>
<h3>Token ç»“æ„</h3>
<p>NexusBook ä½¿ç”¨ JWT (JSON Web Token) æ ¼å¼ï¼š</p>
<pre><code>eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.    # Header
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6I... # Payload
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQss... # Signature
</code></pre>
<p><strong>è§£ç åçš„ Payload</strong>ï¼š</p>
<pre><code class="language-json">{
  &quot;sub&quot;: &quot;user-12345&quot;,
  &quot;client_id&quot;: &quot;your_client_id&quot;,
  &quot;scope&quot;: &quot;doc:read data:write&quot;,
  &quot;iat&quot;: 1638360000,
  &quot;exp&quot;: 1638363600
}
</code></pre>
<h3>Token å­˜å‚¨</h3>
<p><strong>å®‰å…¨å­˜å‚¨å»ºè®®</strong>ï¼š</p>
<ol>
<li><p><strong>Web åº”ç”¨</strong>ï¼šä½¿ç”¨ HttpOnly Cookie</p>
<pre><code class="language-javascript">res.cookie(&#39;access_token&#39;, token, {
  httpOnly: true,
  secure: true,
  sameSite: &#39;strict&#39;,
  maxAge: 3600000 // 1 å°æ—¶
});
</code></pre>
</li>
<li><p><strong>ç§»åŠ¨åº”ç”¨</strong>ï¼šä½¿ç”¨å®‰å…¨å­˜å‚¨ï¼ˆiOS Keychainã€Android Keystoreï¼‰</p>
</li>
<li><p><strong>æœåŠ¡ç«¯åº”ç”¨</strong>ï¼šç¯å¢ƒå˜é‡æˆ–åŠ å¯†é…ç½®æ–‡ä»¶</p>
</li>
</ol>
<p><strong>ä¸å®‰å…¨çš„åšæ³•</strong>ï¼š</p>
<ul>
<li>âŒ å­˜å‚¨åœ¨ localStorage</li>
<li>âŒ å­˜å‚¨åœ¨æ™®é€š Cookieï¼ˆé HttpOnlyï¼‰</li>
<li>âŒ ç¡¬ç¼–ç åœ¨ä»£ç ä¸­</li>
<li>âŒ æ˜æ–‡ä¿å­˜åœ¨æ•°æ®åº“</li>
</ul>
<h3>Token åˆ·æ–°</h3>
<p>ä½¿ç”¨ Refresh Token è·å–æ–°çš„ Access Tokenï¼š</p>
<pre><code class="language-bash">curl -X POST https://auth.nexusbook.com/token \
  -H &#39;Content-Type: application/x-www-form-urlencoded&#39; \
  -d &#39;grant_type=refresh_token&#39; \
  -d &#39;refresh_token=YOUR_REFRESH_TOKEN&#39; \
  -d &#39;client_id=your_client_id&#39; \
  -d &#39;client_secret=your_client_secret&#39;
</code></pre>
<p><strong>è‡ªåŠ¨åˆ·æ–°ç¤ºä¾‹</strong>ï¼š</p>
<pre><code class="language-javascript">class TokenManager {
  constructor(clientId, clientSecret) {
    this.clientId = clientId;
    this.clientSecret = clientSecret;
    this.accessToken = null;
    this.refreshToken = null;
    this.expiresAt = null;
  }
  
  async getAccessToken() {
    // å¦‚æœ Token è¿˜æœ‰æ•ˆï¼Œç›´æ¥è¿”å›
    if (this.accessToken &amp;&amp; Date.now() &lt; this.expiresAt - 60000) {
      return this.accessToken;
    }
    
    // Token è¿‡æœŸï¼Œä½¿ç”¨ refresh_token åˆ·æ–°
    if (this.refreshToken) {
      await this.refreshAccessToken();
      return this.accessToken;
    }
    
    // æ²¡æœ‰ Tokenï¼Œè·å–æ–°çš„
    await this.fetchNewToken();
    return this.accessToken;
  }
  
  async refreshAccessToken() {
    const response = await axios.post(&#39;https://auth.nexusbook.com/token&#39;, {
      grant_type: &#39;refresh_token&#39;,
      refresh_token: this.refreshToken,
      client_id: this.clientId,
      client_secret: this.clientSecret
    });
    
    this.updateTokens(response.data);
  }
  
  updateTokens(data) {
    this.accessToken = data.access_token;
    this.refreshToken = data.refresh_token || this.refreshToken;
    this.expiresAt = Date.now() + (data.expires_in * 1000);
  }
}
</code></pre>
<h2>Scope æƒé™è¯¦è§£</h2>
<h3>æƒé™çº§åˆ«</h3>
<table>
<thead>
<tr>
<th>Scope</th>
<th>æƒé™</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><code>doc:read</code></td>
<td>æ–‡æ¡£è¯»å–</td>
<td>è¯»å–æ–‡æ¡£å±æ€§ã€å…ƒæ•°æ®ã€è§†å›¾ã€è®¾ç½®</td>
</tr>
<tr>
<td><code>doc:write</code></td>
<td>æ–‡æ¡£å†™å…¥</td>
<td>åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ–‡æ¡£å’Œå…ƒæ•°æ®</td>
</tr>
<tr>
<td><code>data:read</code></td>
<td>æ•°æ®è¯»å–</td>
<td>æŸ¥è¯¢æ•°æ®è¡Œ</td>
</tr>
<tr>
<td><code>data:write</code></td>
<td>æ•°æ®å†™å…¥</td>
<td>åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤æ•°æ®è¡Œ</td>
</tr>
<tr>
<td><code>views:manage</code></td>
<td>è§†å›¾ç®¡ç†</td>
<td>åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤è§†å›¾</td>
</tr>
<tr>
<td><code>comments:write</code></td>
<td>è¯„è®ºç®¡ç†</td>
<td>åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤è¯„è®º</td>
</tr>
<tr>
<td><code>approvals:manage</code></td>
<td>å®¡æ‰¹ç®¡ç†</td>
<td>å‘èµ·å’Œå¤„ç†å®¡æ‰¹æµç¨‹</td>
</tr>
<tr>
<td><code>requests:manage</code></td>
<td>è¯·æ±‚ç®¡ç†</td>
<td>åˆ›å»ºã€åˆå¹¶ã€å…³é—­å˜æ›´è¯·æ±‚</td>
</tr>
<tr>
<td><code>webhooks:manage</code></td>
<td>Webhook ç®¡ç†</td>
<td>åˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ Webhook</td>
</tr>
</tbody></table>
<h3>æƒé™ç»„åˆ</h3>
<p><strong>åªè¯»è®¿é—®</strong>ï¼š</p>
<pre><code>scope=doc:read data:read
</code></pre>
<p><strong>æ•°æ®ç®¡ç†</strong>ï¼š</p>
<pre><code>scope=doc:read data:read data:write
</code></pre>
<p><strong>å®Œå…¨è®¿é—®</strong>ï¼š</p>
<pre><code>scope=doc:read doc:write data:read data:write views:manage comments:write approvals:manage requests:manage
</code></pre>
<h2>API Keys ç®¡ç†</h2>
<p>API å¯†é’¥ç”¨äºæœåŠ¡é›†æˆä¸è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œæ”¯æŒæœ€å°æƒé™ä¸å¯æ’¤é”€ã€‚</p>
<h3>åˆ›å»º API Key</h3>
<pre><code class="language-bash">curl -X POST &#39;https://auth.nexusbook.com/api-keys&#39; \
  -H &#39;Authorization: Bearer YOUR_ACCESS_TOKEN&#39; \
  -H &#39;Content-Type: application/json&#39; \
  -d &#39;{
    &quot;name&quot;: &quot;CI Pipeline&quot;,
    &quot;scopes&quot;: [&quot;doc:read&quot;, &quot;data:read&quot;],
    &quot;expiresAt&quot;: &quot;2026-01-01T00:00:00Z&quot;
  }&#39;
</code></pre>
<h3>åŠé”€ API Key</h3>
<pre><code class="language-bash">curl -X POST &#39;https://auth.nexusbook.com/api-keys/{keyId}/revoke&#39; \
  -H &#39;Authorization: Bearer YOUR_ACCESS_TOKEN&#39;
</code></pre>
<h3>æœ€ä½³å®è·µ</h3>
<ul>
<li>ä½¿ç”¨æœ€å°æƒé™çš„ scopes</li>
<li>é…ç½®è¿‡æœŸæ—¶é—´ä¸ IP ç™½åå•</li>
<li>å¼€å¯ä½¿ç”¨æ—¥å¿—ä¸é€Ÿç‡é™åˆ¶</li>
</ul>
<h2>ä¸¤æ­¥éªŒè¯ï¼ˆ2FA/MFAï¼‰</h2>
<p>æ”¯æŒ TOTPï¼ˆAuthenticatorï¼‰ã€çŸ­ä¿¡ã€é‚®ä»¶ä¸å¤‡ç”¨ç ã€‚</p>
<ul>
<li>å¼€å¯ï¼š<code>POST /auth/2fa/enable</code>ï¼ˆè¿”å›äºŒç»´ç ä¸å¯†é’¥ï¼‰</li>
<li>éªŒè¯ï¼š<code>POST /auth/2fa/verify</code></li>
<li>ç¦ç”¨ï¼š<code>POST /auth/2fa/disable</code></li>
</ul>
<h2>ä¼šè¯ç®¡ç†</h2>
<ul>
<li>åˆ—å‡ºä¼šè¯ï¼š<code>GET /auth/sessions</code></li>
<li>å…³é—­ä¼šè¯ï¼š<code>DELETE /auth/sessions/{sessionId}</code></li>
<li>å¼ºåˆ¶é€€å‡ºæ‰€æœ‰ï¼š<code>POST /auth/sessions/logout-all</code></li>
</ul>
<h3>1. ä½¿ç”¨ HTTPS</h3>
<p><strong>å§‹ç»ˆä½¿ç”¨ HTTPS</strong> ä¼ è¾“æ•æ„Ÿä¿¡æ¯ï¼š</p>
<pre><code class="language-javascript">// âœ… æ­£ç¡®
const apiUrl = &#39;https://open.nexusbook.com/api/v1/...&#39;;

// âŒ é”™è¯¯
const apiUrl = &#39;http://open.nexusbook.com/api/v1/...&#39;;
</code></pre>
<h3>2. Scope æœ€å°æƒé™åŸåˆ™</h3>
<p>åªè¯·æ±‚åº”ç”¨éœ€è¦çš„æœ€å°æƒé™ï¼š</p>
<pre><code class="language-javascript">// âœ… æ­£ç¡® - åªè¯»åº”ç”¨åªè¯·æ±‚è¯»æƒé™
scope: &#39;doc:read data:read&#39;

// âŒ é”™è¯¯ - è¯·æ±‚äº†ä¸å¿…è¦çš„å†™æƒé™
scope: &#39;doc:read doc:write data:read data:write&#39;
</code></pre>
<h3>3. ä¿æŠ¤ Client Secret</h3>
<ul>
<li>âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡</li>
<li>âœ… ä½¿ç”¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆAWS Secrets Managerã€Azure Key Vaultï¼‰</li>
<li>âŒ ä¸è¦æäº¤åˆ°ä»£ç ä»“åº“</li>
<li>âŒ ä¸è¦åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ä½¿ç”¨</li>
</ul>
<h2>å®‰å…¨æœ€ä½³å®è·µ</h2>
<p>function verifyToken(token) {
  return new Promise((resolve, reject) =&gt; {
    jwt.verify(token, getKey, {
      audience: &#39;your_client_id&#39;,
      issuer: &#39;<a href="https://auth.nexusbook.com">https://auth.nexusbook.com</a>&#39;,
      algorithms: [&#39;RS256&#39;]
    }, (err, decoded) =&gt; {
      if (err) reject(err);
      else resolve(decoded);
    });
  });
}</p>
<pre><code>
### 5. å®æ–½ Rate Limiting

ä¿æŠ¤æ‚¨çš„åº”ç”¨å…å—æ»¥ç”¨ï¼š
```javascript
const rateLimit = require(&#39;express-rate-limit&#39;);

const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 åˆ†é’Ÿ
  max: 100 // é™åˆ¶ 100 ä¸ªè¯·æ±‚
});

app.use(&#39;/api/&#39;, limiter);
</code></pre>
<h2>é”™è¯¯å¤„ç†</h2>
<h3>å¸¸è§è®¤è¯é”™è¯¯</h3>
<table>
<thead>
<tr>
<th>é”™è¯¯ç </th>
<th>è¯´æ˜</th>
<th>è§£å†³æ–¹æ¡ˆ</th>
</tr>
</thead>
<tbody><tr>
<td><code>INVALID_CLIENT</code></td>
<td>å®¢æˆ·ç«¯å‡­è¯é”™è¯¯</td>
<td>æ£€æŸ¥ client_id å’Œ client_secret</td>
</tr>
<tr>
<td><code>INVALID_TOKEN</code></td>
<td>Token æ— æ•ˆæˆ–è¿‡æœŸ</td>
<td>åˆ·æ–°æˆ–é‡æ–°è·å– Token</td>
</tr>
<tr>
<td><code>UNAUTHORIZED</code></td>
<td>æœªæˆæƒ</td>
<td>ç¡®ä¿è¯·æ±‚å¤´åŒ…å«æœ‰æ•ˆ Token</td>
</tr>
<tr>
<td><code>FORBIDDEN</code></td>
<td>æƒé™ä¸è¶³</td>
<td>è¯·æ±‚åŒ…å«æ‰€éœ€æƒé™çš„ Scope</td>
</tr>
<tr>
<td><code>INVALID_SCOPE</code></td>
<td>Scope æ— æ•ˆ</td>
<td>æ£€æŸ¥ Scope æ‹¼å†™å’Œå¯ç”¨æ€§</td>
</tr>
</tbody></table>
<h3>é”™è¯¯å¤„ç†ç¤ºä¾‹</h3>
<pre><code class="language-javascript">async function callApi(endpoint, options = {}) {
  try {
    const token = await tokenManager.getAccessToken();
    
    const response = await axios.get(endpoint, {
      headers: {
        &#39;Authorization&#39;: `Bearer ${token}`,
        ...options.headers
      }
    });
    
    return response.data;
  } catch (error) {
    if (error.response) {
      const { code, message } = error.response.data;
      
      // Token è¿‡æœŸï¼Œåˆ·æ–°åé‡è¯•
      if (code === &#39;INVALID_TOKEN&#39;) {
        await tokenManager.refreshAccessToken();
        return callApi(endpoint, options); // é‡è¯•
      }
      
      // æƒé™ä¸è¶³
      if (code === &#39;FORBIDDEN&#39;) {
        throw new Error(&#39;æƒé™ä¸è¶³ï¼Œè¯·è”ç³»ç®¡ç†å‘˜&#39;);
      }
      
      // å…¶ä»–é”™è¯¯
      throw new Error(message.zh || message.en || &#39;æœªçŸ¥é”™è¯¯&#39;);
    }
    
    throw error;
  }
}
</code></pre>
<h2>ä¸‹ä¸€æ­¥</h2>
<ul>
<li>ğŸ“Š é˜…è¯» <a href="document-model.html">æ–‡æ¡£æ¨¡å‹è¯¦è§£</a></li>
<li>ğŸ”§ é˜…è¯» <a href="data-operations.html">æ•°æ®æ“ä½œæŒ‡å—</a></li>
<li>ğŸ“š æŸ¥çœ‹ <a href="../api/index.html">API å‚è€ƒæ–‡æ¡£</a></li>
</ul>

                </article>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 NexusBook. åŸºäº TypeSpec å®šä¹‰å¹¶ç”Ÿæˆ OpenAPI 3.0 è§„èŒƒã€‚</p>
            </div>
        </footer>
    </div>
</body>
</html>