<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€ä½³å®è·µ - NexusBook API æ–‡æ¡£</title>
    <link rel="stylesheet" href="/styles/main.css?v=${Date.now()}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
    <script>
      if (window.hljs) { hljs.highlightAll(); }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body class="has-sidebar">
    <nav class="sidebar">
<div class="sidebar-header">
<a href="/index.html" class="sidebar-logo">NexusBook API</a>
</div>
<div class="sidebar-content">
<div class="sidebar-group expanded">
<div class="sidebar-group-title">å¼€å§‹ä½¿ç”¨</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/index.html">æ¦‚è§ˆ</a>
</li>
<li class="sidebar-item ">
<a href="/guides/getting-started.html">å¿«é€Ÿå¼€å§‹</a>
</li>
<li class="sidebar-item ">
<a href="/guides/authentication.html">è®¤è¯æˆæƒ</a>
</li>
</ul>
</div>
<div class="sidebar-group expanded">
<div class="sidebar-group-title">æ ¸å¿ƒæ¦‚å¿µ</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/guides/document-model.html">æ–‡æ¡£æ¨¡å‹</a>
</li>
<li class="sidebar-item ">
<a href="/guides/data-operations.html">æ•°æ®æ“ä½œ</a>
</li>
<li class="sidebar-item ">
<a href="/guides/webhooks.html">Webhook äº‹ä»¶</a>
</li>
<li class="sidebar-item ">
<a href="/guides/realtime-collaboration.html">å®æ—¶ååŒ</a>
</li>
</ul>
</div>
<div class="sidebar-group expanded">
<div class="sidebar-group-title">API å‚è€ƒ</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/api/index.html">API ç«¯ç‚¹</a>
</li>
<li class="sidebar-item ">
<a href="/references/field-types.html">å­—æ®µç±»å‹</a>
</li>
<li class="sidebar-item ">
<a href="/references/error-codes.html">é”™è¯¯ç </a>
</li>
</ul>
</div>
<div class="sidebar-group ">
<div class="sidebar-group-title">å¼€å‘æŒ‡å—</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/guides/development.html">å¼€å‘ç¯å¢ƒ</a>
</li>
<li class="sidebar-item ">
<a href="/guides/architecture.html">æ¶æ„è®¾è®¡</a>
</li>
<li class="sidebar-item ">
<a href="/guides/best-practices.html">æœ€ä½³å®è·µ</a>
</li>
<li class="sidebar-item ">
<a href="/guides/examples.html">å®Œæ•´ç¤ºä¾‹</a>
</li>
</ul>
</div>
<div class="sidebar-group ">
<div class="sidebar-group-title">å…¶ä»–èµ„æº</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/references/i18n.html">å›½é™…åŒ–</a>
</li>
<li class="sidebar-item ">
<a href="/references/changelog.html">æ›´æ–°æ—¥å¿—</a>
</li>
<li class="sidebar-item ">
<a href="/CONTRIBUTING.html">è´¡çŒ®æŒ‡å—</a>
</li>
<li class="sidebar-item ">
<a href="/TROUBLESHOOTING.html">é—®é¢˜æ’æŸ¥</a>
</li>
</ul>
</div>
</div>
</nav>

    
    <div class="main-wrapper">
        <header class="header">
            <div class="container">
                <h1 class="logo"><a href="/index.html">NexusBook API</a></h1>
                <nav class="nav">
                    <a href="/index.html">é¦–é¡µ</a>
                    <a href="/api/" >API å‚è€ƒ</a>
                    <a href="/guides/getting-started.html" class="active">å¼€å‘æŒ‡å—</a>
                    <a href="/advanced/README.html" >é«˜çº§æ‰‹å†Œ</a>
                    <a href="/references/error-codes.html" >å‚è€ƒæ–‡æ¡£</a>
                    <a href="https://github.com/NexusBook/nexusbook-api" target="_blank">GitHub</a>
                </nav>
            </div>
        </header>

        <main class="main content-page">
            <div class="container">
                <article class="content">
                    <h1>æœ€ä½³å®è·µ</h1>
<p>æœ¬æŒ‡å—æ€»ç»“äº†ä½¿ç”¨ NexusBook API çš„æœ€ä½³å®è·µï¼Œå¸®åŠ©æ‚¨æ„å»ºé«˜æ•ˆã€å¯é çš„åº”ç”¨ã€‚</p>
<h2>å±æ€§è®¾è®¡</h2>
<h3>å‘½åè§„èŒƒ</h3>
<p>âœ… <strong>æ¨è</strong>ï¼š</p>
<pre><code class="language-json">{
  &quot;orderTime&quot;: &quot;2024-12-01T10:00:00Z&quot;,
  &quot;storeName&quot;: &quot;Beijing Branch&quot;,
  &quot;totalAmount&quot;: 5000.00
}
</code></pre>
<p>âŒ <strong>ä¸æ¨è</strong>ï¼š</p>
<pre><code class="language-json">{
  &quot;time&quot;: &quot;2024-12-01T10:00:00Z&quot;,  // ä¸å¤Ÿæè¿°æ€§
  &quot;s_name&quot;: &quot;Beijing Branch&quot;,      // ä½¿ç”¨äº†ä¸‹åˆ’çº¿
  &quot;amt&quot;: 5000.00                    // è¿‡åº¦ç¼©å†™
}
</code></pre>
<h3>ç»“æ„è®¾è®¡</h3>
<p>âœ… <strong>æ¨è</strong>ï¼šæ‰å¹³åŒ–ç»“æ„</p>
<pre><code class="language-json">{
  &quot;shipping_city&quot;: &quot;Beijing&quot;,
  &quot;shipping_address&quot;: &quot;123 Main St&quot;,
  &quot;billing_city&quot;: &quot;Shanghai&quot;,
  &quot;billing_address&quot;: &quot;456 Park Ave&quot;
}
</code></pre>
<p>âŒ <strong>ä¸æ¨è</strong>ï¼šè¿‡åº¦åµŒå¥—</p>
<pre><code class="language-json">{
  &quot;shipping&quot;: {
    &quot;address&quot;: {
      &quot;city&quot;: &quot;Beijing&quot;,
      &quot;street&quot;: &quot;123 Main St&quot;
    }
  }
}
</code></pre>
<h2>å…ƒæ•°æ®è®¾è®¡</h2>
<h3>å­—æ®µå®šä¹‰è§„èŒƒ</h3>
<p>âœ… <strong>æ¨è</strong>ï¼š</p>
<pre><code class="language-json">{
  &quot;id&quot;: &quot;productName&quot;,
  &quot;name&quot;: &quot;äº§å“åç§°&quot;,
  &quot;type&quot;: &quot;text&quot;,
  &quot;required&quot;: true,
  &quot;description&quot;: &quot;äº§å“çš„å®Œæ•´åç§°&quot;,
  &quot;validation&quot;: {
    &quot;minLength&quot;: 1,
    &quot;maxLength&quot;: 200
  }
}
</code></pre>
<h3>é¿å…é¢‘ç¹ä¿®æ”¹å…ƒæ•°æ®</h3>
<p>å…ƒæ•°æ®å˜æ›´ä¼šå½±å“å·²æœ‰æ•°æ®ï¼Œåº”è¯¥ï¼š</p>
<ul>
<li>å……åˆ†è§„åˆ’å­—æ®µç»“æ„</li>
<li>ä½¿ç”¨ç‰ˆæœ¬è¿ç§»ç­–ç•¥</li>
<li>æä¾›æ•°æ®è¿ç§»è„šæœ¬</li>
</ul>
<h2>æ•°æ®æ“ä½œ</h2>
<h3>æ‰¹é‡æ“ä½œä¼˜å…ˆ</h3>
<p>âœ… <strong>æ¨è</strong>ï¼š</p>
<pre><code class="language-javascript">// æ‰¹é‡åˆ›å»º 100 è¡Œ
await api.post(&#39;/data/bulk?requestId=req-1&#39;, {
  rows: Array.from({length: 100}, (_, i) =&gt; ({
    id: `row-${i}`,
    values: [...]
  }))
});
</code></pre>
<p>âŒ <strong>ä¸æ¨è</strong>ï¼š</p>
<pre><code class="language-javascript">// å¾ªç¯åˆ›å»º 100 æ¬¡
for (let i = 0; i &lt; 100; i++) {
  await api.post(&#39;/data?apply=true&#39;, {
    id: `row-${i}`,
    values: [...]
  });
}
</code></pre>
<h3>å¹¶å‘æ§åˆ¶</h3>
<p>å§‹ç»ˆä½¿ç”¨ç‰ˆæœ¬å·ï¼š</p>
<pre><code class="language-javascript">async function updateRow(rowId, newValues) {
  // 1. è·å–æœ€æ–°æ•°æ®
  const row = await api.get(`/data/${rowId}`);
  
  // 2. æ›´æ–°æ—¶æä¾›ç‰ˆæœ¬å·
  await api.put(`/data/${rowId}?requestId=req-1`, {
    values: newValues,
    version: row.version
  });
}
</code></pre>
<h3>é”™è¯¯å¤„ç†</h3>
<pre><code class="language-javascript">async function safeUpdate(rowId, newValues) {
  const maxRetries = 3;
  
  for (let i = 0; i &lt; maxRetries; i++) {
    try {
      const row = await api.get(`/data/${rowId}`);
      await api.put(`/data/${rowId}?requestId=req-1`, {
        values: newValues,
        version: row.version
      });
      return; // æˆåŠŸ
    } catch (error) {
      if (error.code === &#39;VERSION_CONFLICT&#39; &amp;&amp; i &lt; maxRetries - 1) {
        // ç‰ˆæœ¬å†²çªï¼Œé‡è¯•
        continue;
      }
      throw error; // å…¶ä»–é”™è¯¯æˆ–è¾¾åˆ°é‡è¯•ä¸Šé™
    }
  }
}
</code></pre>
<h2>è¯„è®ºåä½œ</h2>
<h3>ç²¾ç¡®å®šä½</h3>
<p>âœ… <strong>æ¨è</strong>ï¼šæ˜ç¡®æŒ‡å®šè¯„è®ºä½ç½®</p>
<pre><code class="language-javascript">// é’ˆå¯¹ç‰¹å®šå•å…ƒæ ¼
await api.post(&#39;/comments&#39;, {
  target: {
    scope: &#39;cell&#39;,
    rowId: &#39;row-001&#39;,
    fieldId: &#39;price&#39;
  },
  content: &#39;è¿™ä¸ªä»·æ ¼éœ€è¦ç¡®è®¤&#39;
});
</code></pre>
<h3>ä½¿ç”¨ @æåŠ</h3>
<pre><code class="language-javascript">await api.post(&#39;/comments&#39;, {
  target: { scope: &#39;document&#39; },
  content: &#39;@å¼ ä¸‰ @æå›› è¯·reviewè¿™ä¸ªè®¢å•&#39;,
  mentions: [&#39;user-123&#39;, &#39;user-456&#39;]
});
</code></pre>
<h3>åŠæ—¶æ ‡è®°å·²è§£å†³</h3>
<pre><code class="language-javascript">// é—®é¢˜è§£å†³åæ ‡è®°
await api.post(`/comments/${commentId}/resolve`);
</code></pre>
<h2>ç‰ˆæœ¬æ§åˆ¶</h2>
<h3>ä¿®è®¢è¯´æ˜ç¼–å†™</h3>
<p>âœ… <strong>æ¨è</strong>ï¼š</p>
<pre><code class="language-javascript">await api.post(&#39;/requests&#39;, {
  title: &#39;æ›´æ–°äº§å“ä»·æ ¼&#39;,
  description: &#39;æ ¹æ®ä¾›åº”å•†è°ƒä»·é€šçŸ¥ï¼Œæ›´æ–°ä»¥ä¸‹äº§å“ä»·æ ¼ï¼š\n- iPhone 15: 799.99 â†’ 749.99\n- iPad Pro: 1099.99 â†’ 999.99&#39;,
  changes: [...]
});
</code></pre>
<p>âŒ <strong>ä¸æ¨è</strong>ï¼š</p>
<pre><code class="language-javascript">await api.post(&#39;/requests&#39;, {
  title: &#39;æ›´æ–°&#39;,
  description: &#39;ä¿®æ”¹äº†ä¸€äº›æ•°æ®&#39;,
  changes: [...]
});
</code></pre>
<h3>å†å²å®¡è®¡</h3>
<p>å®šæœŸæ£€æŸ¥ä¿®è®¢å†å²ï¼š</p>
<pre><code class="language-javascript">// æŸ¥çœ‹ç‰¹å®šè¡Œçš„å˜æ›´å†å²
const history = await api.get(&#39;/revisions/history&#39;, {
  params: {
    targetKind: &#39;row&#39;,
    rowId: &#39;row-001&#39;
  }
});
</code></pre>
<h2>æ€§èƒ½ä¼˜åŒ–</h2>
<h3>åˆ†é¡µç­–ç•¥</h3>
<pre><code class="language-javascript">// âœ… åˆç†çš„åˆ†é¡µå¤§å°
const pageSize = 50;

// æ¸¸æ ‡åˆ†é¡µï¼ˆç”¨äºæ·±åˆ†é¡µï¼‰
async function* fetchAllData() {
  let cursor = null;
  
  do {
    const response = await api.get(&#39;/data&#39;, {
      params: { pageSize, cursor }
    });
    
    yield response.items;
    cursor = response.cursor;
  } while (cursor);
}
</code></pre>
<h3>æŒ‰éœ€åŠ è½½</h3>
<pre><code class="language-javascript">// âœ… åªè·å–éœ€è¦çš„éƒ¨åˆ†
const doc = await api.get(&#39;/doc/product/123&#39;, {
  params: {
    include: &#39;metadata,data&#39;,  // ä¸åŒ…æ‹¬ comments å’Œ revisions
    pageSize: 20
  }
});

// âŒ è·å–æ‰€æœ‰æ•°æ®
const doc = await api.get(&#39;/doc/product/123&#39;, {
  params: {
    include: &#39;metadata,views,data,comments,revisions,settings&#39;
  }
});
</code></pre>
<h3>ç¼“å­˜ç­–ç•¥</h3>
<pre><code class="language-javascript">class ApiClient {
  constructor() {
    this.cache = new Map();
    this.cacheTTL = 60000; // 1 åˆ†é’Ÿ
  }
  
  async getMetadata(docType, docId) {
    const key = `metadata:${docType}:${docId}`;
    const cached = this.cache.get(key);
    
    if (cached &amp;&amp; Date.now() - cached.time &lt; this.cacheTTL) {
      return cached.data;
    }
    
    const data = await api.get(`/doc/${docType}/${docId}/metadata`);
    this.cache.set(key, { data, time: Date.now() });
    
    return data;
  }
}
</code></pre>
<h2>å®‰å…¨å»ºè®®</h2>
<h3>æƒé™æ§åˆ¶</h3>
<pre><code class="language-javascript">// âœ… æœ€å°æƒé™åŸåˆ™
const token = await getToken({
  scope: &#39;doc:read data:read&#39;  // åªè¯»åº”ç”¨åªè¯·æ±‚è¯»æƒé™
});

// âŒ è¯·æ±‚ä¸å¿…è¦çš„æƒé™
const token = await getToken({
  scope: &#39;doc:read doc:write data:read data:write approvals:manage&#39;
});
</code></pre>
<h3>æ•°æ®éªŒè¯</h3>
<pre><code class="language-javascript">function validateRowData(values) {
  const errors = [];
  
  values.forEach(fieldValue =&gt; {
    // éªŒè¯å¿…å¡«å­—æ®µ
    if (field.required &amp;&amp; !fieldValue.value) {
      errors.push(`${field.name} æ˜¯å¿…å¡«å­—æ®µ`);
    }
    
    // éªŒè¯æ•°æ®ç±»å‹
    if (field.type === &#39;number&#39;) {
      if (typeof fieldValue.value.number !== &#39;number&#39;) {
        errors.push(`${field.name} å¿…é¡»æ˜¯æ•°å­—`);
      }
    }
    
    // éªŒè¯èŒƒå›´
    if (field.validation?.min !== undefined) {
      if (fieldValue.value.number &lt; field.validation.min) {
        errors.push(`${field.name} ä¸èƒ½å°äº ${field.validation.min}`);
      }
    }
  });
  
  return errors;
}
</code></pre>
<h3>æ—¥å¿—è®°å½•</h3>
<pre><code class="language-javascript">class AuditLogger {
  async logApiCall(method, endpoint, user, response) {
    await db.insert(&#39;audit_logs&#39;, {
      timestamp: new Date(),
      user: user.id,
      method,
      endpoint,
      success: response.success,
      errorCode: response.code,
      ipAddress: request.ip
    });
  }
}
</code></pre>
<h2>æµ‹è¯•å»ºè®®</h2>
<h3>å•å…ƒæµ‹è¯•</h3>
<pre><code class="language-javascript">describe(&#39;æ•°æ®è¡Œ CRUD&#39;, () =&gt; {
  test(&#39;åˆ›å»ºæ•°æ®è¡Œ&#39;, async () =&gt; {
    const row = {
      id: &#39;test-row-001&#39;,
      values: [
        { fieldId: &#39;name&#39;, value: { text: &#39;æµ‹è¯•äº§å“&#39; } }
      ]
    };
    
    const response = await api.post(&#39;/data?apply=true&#39;, row);
    
    expect(response.success).toBe(true);
    expect(response.payload.id).toBe(&#39;test-row-001&#39;);
  });
  
  test(&#39;å¹¶å‘å†²çªå¤„ç†&#39;, async () =&gt; {
    const row = await api.get(&#39;/data/row-001&#39;);
    
    // æ¨¡æ‹Ÿå¦ä¸€ä¸ªç”¨æˆ·æ›´æ–°
    await api.put(&#39;/data/row-001?requestId=req-1&#39;, {
      values: [...],
      version: row.version
    });
    
    // å½“å‰æ›´æ–°åº”è¯¥å¤±è´¥
    await expect(
      api.put(&#39;/data/row-001?apply=true&#39;, {
        values: [...],
        version: row.version
      })
    ).rejects.toThrow(&#39;VERSION_CONFLICT&#39;);
  });
});
</code></pre>
<h3>é›†æˆæµ‹è¯•</h3>
<pre><code class="language-javascript">describe(&#39;è®¢è´§å•å·¥ä½œæµ&#39;, () =&gt; {
  test(&#39;å®Œæ•´æµç¨‹&#39;, async () =&gt; {
    // 1. åˆ›å»ºè®¢è´§å•
    const doc = await api.post(&#39;/doc/purchaseOrder&#39;, {...});
    
    // 2. æ·»åŠ äº§å“è¡Œ
    await api.post(`/doc/purchaseOrder/${doc.id}/data/bulk?apply=true`, {
      rows: [...]
    });
    
    // 3. æ·»åŠ è¯„è®º
    await api.post(`/doc/purchaseOrder/${doc.id}/comments`, {
      content: &#39;è¯·å°½å¿«å¤„ç†&#39;
    });
    
    // 4. å‘èµ·å®¡æ‰¹
    const approval = await api.post(`/doc/purchaseOrder/${doc.id}/approval/start`);
    
    // 5. å®¡æ‰¹é€šè¿‡
    await api.post(`/doc/purchaseOrder/${doc.id}/approval/${approval.id}/decision`, {
      result: &#39;approved&#39;
    });
    
    // éªŒè¯æœ€ç»ˆçŠ¶æ€
    const finalDoc = await api.get(`/doc/purchaseOrder/${doc.id}`);
    expect(finalDoc.status).toBe(&#39;approved&#39;);
  });
});
</code></pre>
<h2>ç›‘æ§å’Œå‘Šè­¦</h2>
<h3>æ€§èƒ½ç›‘æ§</h3>
<pre><code class="language-javascript">class PerformanceMonitor {
  async trackApiCall(apiCall) {
    const start = Date.now();
    
    try {
      const result = await apiCall();
      const duration = Date.now() - start;
      
      // è®°å½•å“åº”æ—¶é—´
      metrics.histogram(&#39;api.response_time&#39;, duration, {
        endpoint: apiCall.endpoint,
        method: apiCall.method
      });
      
      // æ…¢æŸ¥è¯¢å‘Šè­¦
      if (duration &gt; 3000) {
        logger.warn(&#39;Slow API call&#39;, {
          endpoint: apiCall.endpoint,
          duration
        });
      }
      
      return result;
    } catch (error) {
      // é”™è¯¯ç‡ç›‘æ§
      metrics.increment(&#39;api.errors&#39;, {
        endpoint: apiCall.endpoint,
        errorCode: error.code
      });
      
      throw error;
    }
  }
}
</code></pre>
<h2>æ€»ç»“</h2>
<p>éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥å¸®åŠ©æ‚¨ï¼š</p>
<ul>
<li>âœ… æé«˜åº”ç”¨æ€§èƒ½å’Œå“åº”é€Ÿåº¦</li>
<li>âœ… å¢å¼ºæ•°æ®ä¸€è‡´æ€§å’Œå¯é æ€§</li>
<li>âœ… ç®€åŒ–é”™è¯¯å¤„ç†å’Œè°ƒè¯•</li>
<li>âœ… æå‡ä»£ç å¯ç»´æŠ¤æ€§</li>
<li>âœ… ä¿éšœç³»ç»Ÿå®‰å…¨æ€§</li>
</ul>
<h2>ä¸‹ä¸€æ­¥</h2>
<ul>
<li>ğŸ“š æŸ¥çœ‹ <a href="examples.html">å®Œæ•´ç¤ºä¾‹</a></li>
<li>ğŸ“– é˜…è¯» <a href="../api/index.html">API å‚è€ƒæ–‡æ¡£</a></li>
<li>ğŸ”§ é˜…è¯» <a href="data-operations.html">æ•°æ®æ“ä½œæŒ‡å—</a></li>
</ul>

                </article>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 NexusBook. åŸºäº TypeSpec å®šä¹‰å¹¶ç”Ÿæˆ OpenAPI 3.0 è§„èŒƒã€‚</p>
            </div>
        </footer>
    </div>
</body>
</html>