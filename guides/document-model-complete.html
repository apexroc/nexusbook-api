<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æ¡£æ¨¡å‹å®Œæ•´ç‰ˆ - NexusBook API æ–‡æ¡£</title>
    <link rel="stylesheet" href="/nexusbook-api/styles/main.css?v=${Date.now()}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/common.min.js"></script>
    <script>
      if (window.hljs) { hljs.highlightAll(); }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script>
      mermaid.initialize({ startOnLoad: true, theme: 'default' });
    </script>
</head>
<body class="has-sidebar">
    <nav class="sidebar">
<div class="sidebar-header">
<a href="/nexusbook-api/index.html" class="sidebar-logo">NexusBook API</a>
</div>
<div class="sidebar-content">
<div class="sidebar-group expanded">
<div class="sidebar-group-title">å¼€å§‹ä½¿ç”¨</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/index.html">æ¦‚è§ˆ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/getting-started.html">å¿«é€Ÿå¼€å§‹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/authentication.html">è®¤è¯æˆæƒ</a>
</li>
</ul>
</div>
<div class="sidebar-group expanded">
<div class="sidebar-group-title">æ ¸å¿ƒæ¦‚å¿µ</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/document-model.html">æ–‡æ¡£æ¨¡å‹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/data-operations.html">æ•°æ®æ“ä½œ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/webhooks.html">Webhook äº‹ä»¶</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/realtime-collaboration.html">å®æ—¶ååŒ</a>
</li>
</ul>
</div>
<div class="sidebar-group expanded">
<div class="sidebar-group-title">API å‚è€ƒ</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/api/index.html">API ç«¯ç‚¹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/references/field-types.html">å­—æ®µç±»å‹</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/references/error-codes.html">é”™è¯¯ç </a>
</li>
</ul>
</div>
<div class="sidebar-group ">
<div class="sidebar-group-title">å¼€å‘æŒ‡å—</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/development.html">å¼€å‘ç¯å¢ƒ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/architecture.html">æ¶æ„è®¾è®¡</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/best-practices.html">æœ€ä½³å®è·µ</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/guides/examples.html">å®Œæ•´ç¤ºä¾‹</a>
</li>
</ul>
</div>
<div class="sidebar-group ">
<div class="sidebar-group-title">å…¶ä»–èµ„æº</div>
<ul class="sidebar-items">
<li class="sidebar-item ">
<a href="/nexusbook-api/references/i18n.html">å›½é™…åŒ–</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/references/changelog.html">æ›´æ–°æ—¥å¿—</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/CONTRIBUTING.html">è´¡çŒ®æŒ‡å—</a>
</li>
<li class="sidebar-item ">
<a href="/nexusbook-api/TROUBLESHOOTING.html">é—®é¢˜æ’æŸ¥</a>
</li>
</ul>
</div>
</div>
</nav>

    
    <div class="main-wrapper">
        <header class="header">
            <div class="container">
                <h1 class="logo"><a href="/nexusbook-api/index.html">NexusBook API</a></h1>
                <nav class="nav">
                    <a href="/nexusbook-api/index.html">é¦–é¡µ</a>
                    <a href="/nexusbook-api/api/" >API å‚è€ƒ</a>
                    <a href="/nexusbook-api/guides/getting-started.html" class="active">å¼€å‘æŒ‡å—</a>
                    <a href="/nexusbook-api/advanced/README.html" >é«˜çº§æ‰‹å†Œ</a>
                    <a href="/nexusbook-api/references/error-codes.html" >å‚è€ƒæ–‡æ¡£</a>
                    <a href="https://github.com/NexusBook/nexusbook-api" target="_blank">GitHub</a>
                </nav>
            </div>
        </header>

        <main class="main content-page">
            <div class="container">
                <article class="content">
                    <h1>NexusBook æ–‡æ¡£æ¨¡å‹å®Œæ•´æŒ‡å—</h1>
<h2>ç›®å½•</h2>
<ul>
<li><a href="#1-%E5%BC%95%E8%A8%80%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%96%87%E6%A1%A3%E6%A8%A1%E5%9E%8B">1. å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æ–‡æ¡£æ¨¡å‹</a></li>
<li><a href="#2-%E8%AE%BE%E8%AE%A1%E5%93%B2%E5%AD%A6">2. è®¾è®¡å“²å­¦</a></li>
<li><a href="#3-%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84">3. æ ¸å¿ƒæ¶æ„</a></li>
<li><a href="#4-%E4%B8%83%E5%B1%82%E6%A8%A1%E5%9E%8B%E8%AF%A6%E8%A7%A3">4. ä¸ƒå±‚æ¨¡å‹è¯¦è§£</a></li>
<li><a href="#5-%E5%8F%98%E6%9B%B4%E5%B7%A5%E4%BD%9C%E6%B5%81">5. å˜æ›´å·¥ä½œæµ</a></li>
<li><a href="#6-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">6. å®ç°åŸç†</a></li>
<li><a href="#7-%E5%AE%8C%E6%95%B4%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B">7. å®Œæ•´ä¸šåŠ¡æµç¨‹</a></li>
<li><a href="#8-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">8. æœ€ä½³å®è·µ</a></li>
</ul>
<hr>
<h2>1. å¼•è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æ–‡æ¡£æ¨¡å‹</h2>
<h3>1.1 ä¸šåŠ¡èƒŒæ™¯</h3>
<p>åœ¨ç°ä»£ä¼ä¸šä¸­ï¼Œ<strong>ç»“æ„åŒ–æ•°æ®æ–‡æ¡£</strong>æ— å¤„ä¸åœ¨ï¼š</p>
<ul>
<li>ğŸ“¦ <strong>è®¢è´§å•</strong> - é‡‡è´­å›¢é˜Ÿéœ€è¦ååŒç®¡ç†ä¾›åº”å•†è®¢å•</li>
<li>ğŸ“„ <strong>å‘ç¥¨</strong> - è´¢åŠ¡éœ€è¦è¿½è¸ªæ¯ä¸€ç¬”å¼€ç¥¨è®°å½•</li>
<li>ğŸ“Š <strong>åº“å­˜è¡¨</strong> - ä»“åº“è¦å®æ—¶æ›´æ–°å•†å“åº“å­˜çŠ¶æ€</li>
<li>ğŸ“‹ <strong>é¡¹ç›®è®¡åˆ’</strong> - é¡¹ç›®ç»„éœ€è¦å¤šäººåä½œä»»åŠ¡åˆ†é…</li>
</ul>
<p>è¿™äº›æ–‡æ¡£éƒ½æœ‰å…±åŒçš„ç‰¹ç‚¹ï¼š</p>
<ol>
<li><strong>ç»“æ„åŒ–</strong> - æœ‰æ˜ç¡®çš„å­—æ®µå®šä¹‰ï¼ˆäº§å“åç§°ã€æ•°é‡ã€é‡‘é¢ç­‰ï¼‰</li>
<li><strong>åä½œæ€§</strong> - å¤šäººåŒæ—¶ç¼–è¾‘ã€è¯„è®ºã€è®¨è®º</li>
<li><strong>å¯è¿½æº¯</strong> - éœ€è¦çŸ¥é“è°åœ¨ä»€ä¹ˆæ—¶å€™æ”¹äº†ä»€ä¹ˆ</li>
<li><strong>éœ€å®¡æ‰¹</strong> - é‡è¦å˜æ›´éœ€è¦ç»è¿‡å®¡æ‰¹æµç¨‹</li>
<li><strong>å¤šè§†è§’</strong> - åŒä¸€ä»½æ•°æ®éœ€è¦ä¸åŒçš„å±•ç¤ºæ–¹å¼</li>
</ol>
<h3>1.2 ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜</h3>
<p>ä¼ ç»Ÿçš„è§£å†³æ–¹æ¡ˆå­˜åœ¨è¯¸å¤šé—®é¢˜ï¼š</p>
<p><strong>æ–¹æ¡ˆ1ï¼šä½¿ç”¨Excel/Google Sheets</strong></p>
<ul>
<li>âŒ ç‰ˆæœ¬æ§åˆ¶å›°éš¾ï¼Œå®¹æ˜“ä¸¢å¤±å†å²è®°å½•</li>
<li>âŒ å¤šäººåä½œå®¹æ˜“å†²çª</li>
<li>âŒ ç¼ºä¹å®¡æ‰¹æµç¨‹</li>
<li>âŒ æƒé™æ§åˆ¶ç²—ç³™</li>
</ul>
<p><strong>æ–¹æ¡ˆ2ï¼šä¸ºæ¯ç§æ–‡æ¡£ç±»å‹å¼€å‘ç‹¬ç«‹ç³»ç»Ÿ</strong></p>
<ul>
<li>âŒ å¼€å‘æˆæœ¬é«˜ï¼Œå‘¨æœŸé•¿</li>
<li>âŒ ä»£ç é‡å¤ï¼Œç»´æŠ¤å›°éš¾</li>
<li>âŒ å„ç³»ç»Ÿå­¤ç«‹ï¼Œæ•°æ®éš¾ä»¥äº’é€š</li>
<li>âŒ æ¯æ¬¡æ–°å¢æ–‡æ¡£ç±»å‹éƒ½éœ€è¦é‡æ–°å¼€å‘</li>
</ul>
<p><strong>æ–¹æ¡ˆ3ï¼šä½¿ç”¨ä¼ ç»Ÿæ•°æ®åº“</strong></p>
<ul>
<li>âŒ Schema å›ºå®šï¼Œæ‰©å±•æ€§å·®</li>
<li>âŒ ç¼ºä¹åä½œå’Œå®¡æ‰¹èƒ½åŠ›</li>
<li>âŒ ç‰ˆæœ¬æ§åˆ¶éœ€è¦é¢å¤–å®ç°</li>
<li>âŒ å¤šè§†å›¾å±•ç¤ºéœ€è¦å¤§é‡å¼€å‘</li>
</ul>
<h3>1.3 NexusBook æ–‡æ¡£æ¨¡å‹çš„è§£å†³æ–¹æ¡ˆ</h3>
<p>NexusBook æä¾›äº†ä¸€ä¸ª<strong>ç»Ÿä¸€çš„æ–‡æ¡£æŠ½è±¡æ¨¡å‹</strong>ï¼Œå°±åƒ&quot;æ­ç§¯æœ¨&quot;ä¸€æ ·ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä»»ä½•ä¸šåŠ¡æ–‡æ¡£                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Properties   â”‚  â”‚   Metadata   â”‚  â”‚    Views     â”‚       â”‚
â”‚  â”‚ æ–‡æ¡£å±æ€§      â”‚  â”‚   å­—æ®µå®šä¹‰    â”‚  â”‚   è§†å›¾é…ç½®    â”‚       â”‚
â”‚  â”‚ (è®¢å•æ—¶é—´)    â”‚  â”‚  (äº§å“åç§°)   â”‚  â”‚  (è¡¨æ ¼/çœ‹æ¿)  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                 Data (æ•°æ®è¡Œ)                           â”‚ â”‚
â”‚  â”‚  å­˜å‚¨å®é™…çš„ä¸šåŠ¡æ•°æ®ï¼Œéµå¾ª Metadata å®šä¹‰çš„ç»“æ„            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Comments    â”‚  â”‚  Requests    â”‚  â”‚  Revisions   â”‚       â”‚
â”‚  â”‚  åä½œè¯„è®º     â”‚  â”‚  å˜æ›´è¯·æ±‚     â”‚  â”‚  ç‰ˆæœ¬å†å²     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>æ ¸å¿ƒä¼˜åŠ¿</strong>ï¼š</p>
<ul>
<li>âœ… <strong>ä¸€æ¬¡å¼€å‘ï¼Œæ— é™å¤ç”¨</strong> - åŒä¸€å¥—æ¨¡å‹æ”¯æŒæ‰€æœ‰ç±»å‹çš„æ–‡æ¡£</li>
<li>âœ… <strong>å¼€ç®±å³ç”¨çš„åä½œèƒ½åŠ›</strong> - è¯„è®ºã€@æåŠã€è®¨è®ºçº¿ç¨‹</li>
<li>âœ… <strong>å®Œæ•´çš„ç‰ˆæœ¬æ§åˆ¶</strong> - ç±»ä¼¼ Git çš„å˜æ›´è¿½è¸ª</li>
<li>âœ… <strong>çµæ´»çš„å®¡æ‰¹æµç¨‹</strong> - æ”¯æŒä¸²ç­¾ã€å¹¶ç­¾ã€æ¡ä»¶å®¡æ‰¹</li>
<li>âœ… <strong>å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›</strong> - è¿‡æ»¤ã€æ’åºã€åˆ†ç»„ã€èšåˆ</li>
<li>âœ… <strong>å¤šè§†å›¾å±•ç¤º</strong> - è¡¨æ ¼ã€çœ‹æ¿ã€æ—¥å†ã€å›¾è¡¨ç­‰8ç§è§†å›¾</li>
</ul>
<hr>
<h2>2. è®¾è®¡å“²å­¦</h2>
<h3>2.1 æ ¸å¿ƒè®¾è®¡åŸåˆ™</h3>
<h4>åŸåˆ™1ï¼šæ¸…æ™°åˆ†å±‚</h4>
<pre><code>Properties (æ–‡æ¡£å±æ€§)  - æ–‡æ¡£çº§å…ƒä¿¡æ¯ï¼Œå¦‚è®¢å•æ—¶é—´ã€æ€»é‡‘é¢
Metadata (å­—æ®µå®šä¹‰)    - å®šä¹‰æ•°æ®ç»“æ„ï¼Œå¦‚äº§å“åç§°æ˜¯æ–‡æœ¬ç±»å‹
Data (æ•°æ®è¡Œ)         - å®é™…ä¸šåŠ¡æ•°æ®ï¼Œå¦‚å…·ä½“çš„äº§å“æ¸…å•
Views (è§†å›¾)          - æ•°æ®å±•ç¤ºæ–¹å¼ï¼Œå¦‚è¡¨æ ¼è§†å›¾ã€çœ‹æ¿è§†å›¾
Comments (è¯„è®º)       - åä½œè®¨è®ºï¼Œå¯ç²¾ç¡®åˆ°å•å…ƒæ ¼
Requests (å˜æ›´è¯·æ±‚)   - å˜æ›´çš„è‰ç¨¿ï¼Œç±»ä¼¼ Git PR
Revisions (ä¿®è®¢å†å²)  - å·²åˆå¹¶çš„å˜æ›´å†å²ï¼Œä¸å¯ä¿®æ”¹
Settings (è®¾ç½®)       - æƒé™ã€é€šçŸ¥ç­‰é…ç½®
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·åˆ†å±‚ï¼Ÿ</strong></p>
<ul>
<li>Properties å’Œ Data åˆ†ç¦»ï¼Œé¿å…æ··æ·†&quot;è®¢å•æ€»é¢&quot;å’Œ&quot;æ¯ä¸ªäº§å“çš„å•ä»·&quot;</li>
<li>Metadata ç‹¬ç«‹ï¼Œå¯ä»¥åŠ¨æ€è°ƒæ•´å­—æ®µå®šä¹‰è€Œä¸å½±å“å·²æœ‰æ•°æ®</li>
<li>Views ä¸æŒæœ‰æ•°æ®ï¼Œåªæ˜¯æ•°æ®çš„ä¸åŒ&quot;çª—å£&quot;</li>
<li>å·¥ä½œæµå±‚ï¼ˆRequests/Revisionsï¼‰ç‹¬ç«‹ï¼Œä¿è¯æ•°æ®å®‰å…¨å’Œå¯è¿½æº¯</li>
</ul>
<h4>åŸåˆ™2ï¼šå…ƒæ•°æ®é©±åŠ¨</h4>
<p><strong>æ‰€æœ‰å­—æ®µéƒ½ç”± Metadata å®šä¹‰</strong>ï¼š</p>
<pre><code class="language-typescript">// 1. å…ˆå®šä¹‰å­—æ®µç»“æ„
{
  &quot;fields&quot;: [
    { &quot;id&quot;: &quot;productName&quot;, &quot;type&quot;: &quot;text&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;quantity&quot;, &quot;type&quot;: &quot;number&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;price&quot;, &quot;type&quot;: &quot;currency&quot; }
  ]
}

// 2. æ•°æ®è¡Œå¿…é¡»éµå¾ªè¿™ä¸ªç»“æ„
{
  &quot;values&quot;: [
    { &quot;fieldId&quot;: &quot;productName&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;iPhone 15&quot; } },
    { &quot;fieldId&quot;: &quot;quantity&quot;, &quot;value&quot;: { &quot;number&quot;: 10 } },
    { &quot;fieldId&quot;: &quot;price&quot;, &quot;value&quot;: { &quot;number&quot;: 799.99 } }
  ]
}
</code></pre>
<p><strong>å¥½å¤„</strong>ï¼š</p>
<ul>
<li>ğŸ”’ <strong>ç±»å‹å®‰å…¨</strong> - æœåŠ¡ç«¯è‡ªåŠ¨éªŒè¯æ•°æ®ç±»å‹</li>
<li>ğŸ¯ <strong>ä¸€è‡´æ€§ä¿è¯</strong> - ä¸ä¼šå‡ºç°å­—æ®µIDä¸å­˜åœ¨çš„æƒ…å†µ</li>
<li>ğŸ”„ <strong>åŠ¨æ€æ‰©å±•</strong> - æ–°å¢å­—æ®µä¸éœ€è¦ä¿®æ”¹æ•°æ®åº“è¡¨ç»“æ„</li>
<li>ğŸ“Š <strong>è‡ªåŠ¨UIç”Ÿæˆ</strong> - å‰ç«¯å¯ä»¥æ ¹æ® Metadata è‡ªåŠ¨æ¸²æŸ“è¡¨å•</li>
</ul>
<h4>åŸåˆ™3ï¼šä¸å¯å˜å†å²</h4>
<pre><code>ç”¨æˆ·ç¼–è¾‘ â†’ Request (å¯ä¿®æ”¹) â†’ å®¡æ‰¹é€šè¿‡ â†’ Revision (ä¸å¯ä¿®æ”¹)
                              â†“
                         æ°¸ä¹…è®°å½•åœ¨å†å²ä¸­
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆä¸å¯å˜ï¼Ÿ</strong></p>
<ul>
<li>å®¡è®¡è¦æ±‚ï¼šè´¢åŠ¡ã€æ³•å¾‹å®¡è®¡éœ€è¦å®Œæ•´çš„å˜æ›´è¯æ®é“¾</li>
<li>ä¿¡ä»»åŸºç¡€ï¼šç”¨æˆ·çŸ¥é“å†å²ä¸ä¼šè¢«ç¯¡æ”¹</li>
<li>å›æ»šèƒ½åŠ›ï¼šå¯ä»¥åŸºäºå†å²åˆ›å»ºæ–°çš„å˜æ›´ï¼Œè€Œä¸æ˜¯ä¿®æ”¹å†å²</li>
</ul>
<h4>åŸåˆ™4ï¼šå®¡æ‰¹å…ˆè¡Œ</h4>
<p><strong>æ‰€æœ‰å†™æ“ä½œéƒ½éœ€è¦ requestId</strong>ï¼š</p>
<pre><code class="language-bash"># âŒ ä¸æ”¯æŒç›´æ¥å†™å…¥
POST /doc/order/123/rows
{ &quot;values&quot;: [...] }

# âœ… å¿…é¡»æŒ‡å®š requestId
POST /doc/order/123/rows?requestId=req-1
{ &quot;values&quot;: [...] }
</code></pre>
<p><strong>å·¥ä½œæµ</strong>ï¼š</p>
<ol>
<li>ç”¨æˆ·åˆ›å»º Requestï¼ˆè‰ç¨¿ï¼‰</li>
<li>å¤šäººåœ¨åŒä¸€ä¸ª Request ä¸­ååŒç¼–è¾‘</li>
<li>å®¡æ‰¹è€…å®¡æ ¸ Request</li>
<li>å®¡æ‰¹é€šè¿‡åï¼ŒRequest åˆå¹¶ç”Ÿæˆ Revision</li>
<li>Revision è®°å½•æ‰€æœ‰å˜æ›´å’Œè´¡çŒ®è€…</li>
</ol>
<h4>åŸåˆ™5ï¼šå…³ç³»æ˜¯ä¸€ç­‰å…¬æ°‘</h4>
<p><strong>è·¨æ–‡æ¡£å…³è”ï¼ˆRelationsï¼‰å’Œé™„ä»¶ï¼ˆAttachmentsï¼‰æ˜¯æ ¸å¿ƒèƒ½åŠ›</strong>ï¼š</p>
<pre><code class="language-typescript">// å‘ç¥¨å¼•ç”¨è®¢è´§å•
{
  &quot;type&quot;: &quot;references&quot;,
  &quot;source&quot;: { &quot;docType&quot;: &quot;invoice&quot;, &quot;docId&quot;: &quot;inv-123&quot;, &quot;rowId&quot;: &quot;row-1&quot; },
  &quot;target&quot;: { &quot;docType&quot;: &quot;purchaseOrder&quot;, &quot;docId&quot;: &quot;po-456&quot;, &quot;rowId&quot;: &quot;row-99&quot; }
}
</code></pre>
<p><strong>å…³ç³»ä¸åµŒå…¥ä»»ä½•ä¸€æ–¹</strong>ï¼š</p>
<ul>
<li>ç‹¬ç«‹å­˜å‚¨ä¸º&quot;è¾¹&quot;ï¼ˆEdgeï¼‰</li>
<li>æ”¯æŒåŒå‘æŸ¥è¯¢ï¼ˆå‡ºè¾¹/å…¥è¾¹ï¼‰</li>
<li>åˆ é™¤ä¿æŠ¤ï¼ˆé¿å…æ‚¬ç©ºå¼•ç”¨ï¼‰</li>
<li>æƒé™æ§åˆ¶ï¼ˆè·¨æ–‡æ¡£è¾¹éœ€è¦ä¸¤ç«¯æƒé™ï¼‰</li>
</ul>
<h3>2.2 ä¸å…¶ä»–ç³»ç»Ÿçš„å¯¹æ¯”</h3>
<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>Excel</th>
<th>Airtable</th>
<th>Notion</th>
<th><strong>NexusBook</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ç»“æ„åŒ–æ•°æ®</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âš ï¸ åŠç»“æ„åŒ–</td>
<td>âœ…</td>
</tr>
<tr>
<td>å¤šäººåä½œ</td>
<td>âš ï¸ å†²çªå¤š</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>ç‰ˆæœ¬æ§åˆ¶</td>
<td>âŒ</td>
<td>âš ï¸ ç®€å•</td>
<td>âš ï¸ ç®€å•</td>
<td>âœ… å®Œæ•´</td>
</tr>
<tr>
<td>å®¡æ‰¹æµç¨‹</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>è·¨æ–‡æ¡£å…³è”</td>
<td>âŒ</td>
<td>âœ…</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>
<tr>
<td>APIä¼˜å…ˆè®¾è®¡</td>
<td>âŒ</td>
<td>âœ…</td>
<td>âš ï¸ æœ‰é™</td>
<td>âœ…</td>
</tr>
<tr>
<td>è‡ªæ‰˜ç®¡</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âŒ</td>
<td>âœ…</td>
</tr>
<tr>
<td>å˜æ›´å¯è¿½æº¯</td>
<td>âŒ</td>
<td>âš ï¸ æœ‰é™</td>
<td>âš ï¸ æœ‰é™</td>
<td>âœ… Gitçº§åˆ«</td>
</tr>
</tbody></table>
<hr>
<h2>3. æ ¸å¿ƒæ¶æ„</h2>
<h3>3.1 æ•´ä½“æ¶æ„å›¾</h3>
<div class="mermaid">graph TB
    subgraph "æ–‡æ¡£æŠ½è±¡å±‚ Document Abstraction"
        Doc["ğŸ“„ Document<br/>{docType}/{docId}"]
    end
    
    subgraph "æ ¸å¿ƒæ•°æ®å±‚ Core Data Layer"
        Props["ğŸ·ï¸ Properties<br/>æ–‡æ¡£çº§å±æ€§"]
        Meta["ğŸ“‹ Metadata<br/>å­—æ®µå®šä¹‰"]
        Data["ğŸ“Š Data<br/>æ•°æ®è¡Œ"]
        Views["ğŸ‘ï¸ Views<br/>è§†å›¾é…ç½®"]
        Settings["âš™ï¸ Settings<br/>æ–‡æ¡£è®¾ç½®"]
    end
    
    subgraph "åä½œå±‚ Collaboration Layer"
        Comments["ğŸ’¬ Comments<br/>ç²¾ç¡®ä½ç½®è¯„è®º"]
        Realtime["âš¡ Realtime<br/>å®æ—¶åä½œ(Yjs)"]
    end
    
    subgraph "å·¥ä½œæµå±‚ Workflow Layer"
        Requests["ğŸ“ Requests<br/>å˜æ›´è¯·æ±‚"]
        Approvals["âœ… Approvals<br/>å®¡æ‰¹æµç¨‹"]
        Revisions["ğŸ“œ Revisions<br/>ä¿®è®¢å†å²"]
    end
    
    subgraph "æ‰©å±•å±‚ Extension Layer"
        Relations["ğŸ”— Relations<br/>è·¨æ–‡æ¡£å…³è”"]
        Attachments["ğŸ“ Attachments<br/>é™„ä»¶ç®¡ç†"]
        Sync["ğŸ”„ Sync<br/>æ•°æ®åŒæ­¥"]
    end
    
    subgraph "æŸ¥è¯¢å¼•æ“ Query Engine"
        Filter["ğŸ” Filter<br/>è¿‡æ»¤"]
        Sort["ğŸ“¶ Sort<br/>æ’åº"]
        Group["ğŸ“Š Group<br/>åˆ†ç»„"]
        Aggregate["ğŸ¯ Aggregate<br/>èšåˆ"]
    end
    
    Doc --> Props
    Doc --> Meta
    Doc --> Data
    Doc --> Views
    Doc --> Settings
    Doc --> Comments
    Doc --> Realtime
    
    Data --> Requests
    Props --> Requests
    Requests --> Approvals
    Requests --> Revisions
    
    Data --> Filter
    Data --> Sort
    Data --> Group
    Doc --> Aggregate
    
    Doc --> Relations
    Doc --> Attachments
    Doc --> Sync
    
    Meta -.å®šä¹‰.-> Data
    Meta -.å®šä¹‰.-> Props
    Views -.æŠ•å½±.-> Data</div>
<h3>3.2 æ•°æ®æµå‘</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ç”¨æˆ·æ“ä½œ                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. åˆ›å»º Request (è‰ç¨¿)                                      â”‚
â”‚     - requestId: req-1                                       â”‚
â”‚     - status: open                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. å¤šæ¬¡ç¼–è¾‘ (æ‰€æœ‰æ“ä½œæºå¸¦ requestId)                         â”‚
â”‚     - POST /rows?requestId=req-1                             â”‚
â”‚     - PUT /rows/123?requestId=req-1                          â”‚
â”‚     - PATCH /properties?requestId=req-1                      â”‚
â”‚                                                               â”‚
â”‚  Request ä¸­ç´¯ç§¯ Changes:                                      â”‚
â”‚     - Change 1: åˆ›å»ºè¡Œ row-1                                  â”‚
â”‚     - Change 2: æ›´æ–°è¡Œ row-1                                  â”‚
â”‚     - Change 3: æ›´æ–°å±æ€§ totalAmount                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æäº¤å®¡æ‰¹ (å¯é€‰)                                           â”‚
â”‚     - æŒ‡å®šå®¡æ‰¹è€…                                              â”‚
â”‚     - å®¡æ‰¹è€…å¯æŸ¥çœ‹ diff                                        â”‚
â”‚     - å®¡æ‰¹è€…åšå‡ºå†³ç­– (é€šè¿‡/æ‹’ç»/è¯·æ±‚ä¿®æ”¹)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚ å®¡æ‰¹é€šè¿‡
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. åˆå¹¶ Request                                             â”‚
â”‚     POST /requests/req-1/merge                               â”‚
â”‚                                                               â”‚
â”‚  å‘ç”Ÿçš„äº‹æƒ…:                                                  â”‚
â”‚  a. æ‰€æœ‰ Changes è½¬æ¢ä¸º ChangeOperations                      â”‚
â”‚  b. åˆ›å»º Revision (rev-001)                                  â”‚
â”‚  c. Revision åŒ…å«:                                           â”‚
â”‚     - æ‰€æœ‰ ChangeOperations                                  â”‚
â”‚     - æ‰€æœ‰è´¡çŒ®è€… (contributors)                               â”‚
â”‚     - åˆå¹¶è€… (mergedBy)                                       â”‚
â”‚     - ç»Ÿè®¡ä¿¡æ¯ (rowsCreated, rowsUpdated...)                 â”‚
â”‚  d. æ›´æ–° Request.generatedRevisionId = rev-001               â”‚
â”‚  e. æ›´æ–° Request.status = merged                             â”‚
â”‚  f. å®é™…æ•°æ®åº“å†™å…¥ç”Ÿæ•ˆ                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. Revision æ°¸ä¹…ä¿å­˜                                        â”‚
â”‚     - ä¸å¯ä¿®æ”¹                                                â”‚
â”‚     - å¯æŸ¥è¯¢                                                  â”‚
â”‚     - å¯å¯¹æ¯” (diff)                                           â”‚
â”‚     - å¯åŸºäºå®ƒåˆ›å»ºæ–°çš„å›æ»šå˜æ›´                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<h3>3.3 å¯¹è±¡å…³ç³»å›¾</h3>
<div class="mermaid">erDiagram
    Document ||--o{ Properties : "has"
    Document ||--|| Metadata : "has"
    Document ||--o{ Row : "contains"
    Document ||--o{ View : "has"
    Document ||--|| Settings : "has"
    Document ||--o{ Comment : "has"
    Document ||--o{ Request : "has"
    Document ||--o{ Revision : "has"
    
    Metadata ||--o{ Field : "defines"
    Field ||--o{ SelectOption : "has"
    
    Row ||--o{ ValueEntry : "contains"
    ValueEntry }o--|| Field : "references"
    
    View ||--o{ Filter : "has"
    View ||--o{ SortField : "has"
    
    Comment }o--|| Comment : "replies to"
    Comment ||--o{ Reaction : "has"
    
    Request ||--o{ Change : "contains"
    Request ||--o| Approval : "requires"
    Request ||--o| Revision : "generates"
    
    Revision ||--o{ ChangeOperation : "records"
    
    Document ||--o{ RelationEdge : "source"
    Document ||--o{ RelationEdge : "target"
    
    Document ||--o{ Attachment : "has"</div>
<hr>
<h2>4. ä¸ƒå±‚æ¨¡å‹è¯¦è§£</h2>
<h3>4.1 Propertiesï¼ˆæ–‡æ¡£å±æ€§ï¼‰- å…ƒä¿¡æ¯å±‚</h3>
<h4>4.1.1 èŒè´£å®šä½</h4>
<p><strong>Properties å­˜å‚¨æ–‡æ¡£çº§åˆ«çš„å…ƒä¿¡æ¯</strong>ï¼Œè€Œä¸æ˜¯æ•°æ®è¡Œçš„å†…å®¹ã€‚</p>
<p>ç±»æ¯”ï¼š</p>
<ul>
<li>ğŸ“„ <strong>æ–‡æ¡£</strong> = ä¸€ä»½å®Œæ•´çš„è®¢è´§å•</li>
<li>ğŸ·ï¸ <strong>Properties</strong> = è®¢å•ç¼–å·ã€è®¢å•æ—¥æœŸã€é—¨åº—ã€æ€»é‡‘é¢</li>
<li>ğŸ“Š <strong>Data (è¡Œ)</strong> = æ¯ä¸ªäº§å“çš„æ˜ç»†ï¼ˆäº§å“åã€æ•°é‡ã€å•ä»·ï¼‰</li>
</ul>
<h4>4.1.2 æ•°æ®æ¨¡å‹</h4>
<pre><code class="language-typescript">model DocumentProperties {
  id: string;                    // å±æ€§è®°å½•ID
  docId: string;                 // æ‰€å±æ–‡æ¡£ID
  docType: string;               // æ–‡æ¡£ç±»å‹
  organizationId?: string;       // ç»„ç»‡ID
  workspaceId?: string;          // å·¥ä½œåŒºID
  
  properties: ValueEntry[];      // å±æ€§å€¼é›†åˆ
  
  version?: int64;               // ä¹è§‚é”ç‰ˆæœ¬å·
  createdAt?: string;
  updatedAt?: string;
  updatedBy?: UserRef;
}

// ValueEntry æ˜¯ç±»å‹åŒ–çš„å€¼
model ValueEntry {
  fieldId: string;               // å¯¹åº” Metadata.properties ä¸­çš„å­—æ®µID
  value: Value;                  // ç±»å‹åŒ–çš„å€¼
}

model Value {
  text?: string;
  number?: number;
  boolean?: boolean;
  date?: string;
  select?: string;
  multiSelect?: string[];
  user?: UserRef;
  // ... 25+ ç§ç±»å‹
}
</code></pre>
<h4>4.1.3 ä¸ºä»€ä¹ˆéœ€è¦ Metadata.propertiesï¼Ÿ</h4>
<p><strong>Metadata åŒ…å«ä¸¤éƒ¨åˆ†å­—æ®µå®šä¹‰</strong>ï¼š</p>
<ol>
<li><strong>Metadata.fields</strong> - å®šä¹‰æ•°æ®è¡Œï¼ˆDataï¼‰çš„å­—æ®µç»“æ„</li>
<li><strong>Metadata.properties</strong> - å®šä¹‰æ–‡æ¡£å±æ€§ï¼ˆPropertiesï¼‰çš„å­—æ®µç»“æ„</li>
</ol>
<pre><code class="language-typescript">{
  &quot;fields&quot;: [
    // æ•°æ®è¡Œçš„å­—æ®µ
    { &quot;id&quot;: &quot;productName&quot;, &quot;type&quot;: &quot;text&quot;, &quot;name&quot;: &quot;äº§å“åç§°&quot; },
    { &quot;id&quot;: &quot;quantity&quot;, &quot;type&quot;: &quot;number&quot;, &quot;name&quot;: &quot;æ•°é‡&quot; }
  ],
  &quot;properties&quot;: [
    // æ–‡æ¡£å±æ€§çš„å­—æ®µ
    { &quot;id&quot;: &quot;orderDate&quot;, &quot;type&quot;: &quot;date&quot;, &quot;name&quot;: &quot;è®¢å•æ—¥æœŸ&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;store&quot;, &quot;type&quot;: &quot;text&quot;, &quot;name&quot;: &quot;é—¨åº—&quot; },
    { &quot;id&quot;: &quot;totalAmount&quot;, &quot;type&quot;: &quot;currency&quot;, &quot;name&quot;: &quot;æ€»é‡‘é¢&quot; }
  ]
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡ï¼Ÿ</strong></p>
<ol>
<li><p><strong>ç±»å‹å®‰å…¨</strong>: Properties çš„å€¼ä¹Ÿéœ€è¦ç±»å‹éªŒè¯</p>
<pre><code class="language-typescript">// âœ… æ­£ç¡®ï¼štotalAmount æ˜¯ currency ç±»å‹
{ &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 5000.00 } }

// âŒ é”™è¯¯ï¼šç±»å‹ä¸åŒ¹é…
{ &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;five thousand&quot; } }
</code></pre>
</li>
<li><p><strong>åŠ¨æ€è¡¨å•ç”Ÿæˆ</strong>: å‰ç«¯å¯ä»¥æ ¹æ® Metadata.properties è‡ªåŠ¨ç”Ÿæˆå±æ€§ç¼–è¾‘è¡¨å•</p>
</li>
<li><p><strong>éªŒè¯è§„åˆ™</strong>: å¯ä»¥å®šä¹‰å±æ€§çš„å¿…å¡«ã€å”¯ä¸€ã€æ ¼å¼ç­‰è§„åˆ™</p>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;invoiceNumber&quot;,
  &quot;type&quot;: &quot;text&quot;,
  &quot;required&quot;: true,
  &quot;unique&quot;: true,
  &quot;validations&quot;: [{
    &quot;ruleType&quot;: &quot;pattern&quot;,
    &quot;config&quot;: { &quot;pattern&quot;: &quot;^INV-\\d{4}-\\d{3}$&quot; }
  }]
}
</code></pre>
</li>
<li><p><strong>è®¡ç®—å­—æ®µ</strong>: Properties ä¹Ÿå¯ä»¥åŒ…å«å…¬å¼å­—æ®µ</p>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;totalAmount&quot;,
  &quot;type&quot;: &quot;formula&quot;,
  &quot;formula&quot;: &quot;SUM(data.*.total)&quot;  // æ±‡æ€»æ‰€æœ‰æ•°æ®è¡Œçš„å°è®¡
}
</code></pre>
</li>
</ol>
<h4>4.1.4 API æ“ä½œ</h4>
<pre><code class="language-bash"># 1. åˆ›å»º/åˆå§‹åŒ–å±æ€§
POST /doc/purchaseOrder/order-123/properties
{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;orderDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2024-12-01&quot; } },
    { &quot;fieldId&quot;: &quot;store&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Beijing Branch&quot; } },
    { &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 0 } }
  ]
}

# 2. å…¨é‡æ›¿æ¢å±æ€§
PUT /doc/purchaseOrder/order-123/properties?requestId=req-1
{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;orderDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2024-12-02&quot; } },
    { &quot;fieldId&quot;: &quot;store&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Shanghai Branch&quot; } },
    { &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 5000.00 } }
  ]
}

# 3. éƒ¨åˆ†æ›´æ–°å±æ€§ (merge=true)
PATCH /doc/purchaseOrder/order-123/properties?requestId=req-1&amp;merge=true
{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 6000.00 } },
    { &quot;fieldId&quot;: &quot;status&quot;, &quot;value&quot;: { &quot;select&quot;: &quot;approved&quot; } }
  ]
}

# 4. æŸ¥çœ‹å±æ€§å˜æ›´å†å²
GET /doc/purchaseOrder/order-123/properties/history
</code></pre>
<h4>4.1.5 ä½¿ç”¨åœºæ™¯</h4>
<p><strong>åœºæ™¯1ï¼šè®¢è´§å•</strong></p>
<pre><code class="language-json">{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;orderDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2024-12-01T10:00:00Z&quot; } },
    { &quot;fieldId&quot;: &quot;store&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Beijing Branch&quot; } },
    { &quot;fieldId&quot;: &quot;supplier&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Apple Inc.&quot; } },
    { &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 50000.00 } },
    { &quot;fieldId&quot;: &quot;status&quot;, &quot;value&quot;: { &quot;select&quot;: &quot;pending&quot; } },
    { &quot;fieldId&quot;: &quot;priority&quot;, &quot;value&quot;: { &quot;select&quot;: &quot;high&quot; } },
    { &quot;fieldId&quot;: &quot;notes&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Urgent delivery required&quot; } }
  ]
}
</code></pre>
<p><strong>åœºæ™¯2ï¼šå‘ç¥¨</strong></p>
<pre><code class="language-json">{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;invoiceNumber&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;INV-2024-001&quot; } },
    { &quot;fieldId&quot;: &quot;issueDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2024-12-01&quot; } },
    { &quot;fieldId&quot;: &quot;dueDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2025-01-01&quot; } },
    { &quot;fieldId&quot;: &quot;taxRate&quot;, &quot;value&quot;: { &quot;number&quot;: 0.13 } },
    { &quot;fieldId&quot;: &quot;taxAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 6500.00 } },
    { &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 56500.00 } },
    { &quot;fieldId&quot;: &quot;paymentStatus&quot;, &quot;value&quot;: { &quot;select&quot;: &quot;pending&quot; } }
  ]
}
</code></pre>
<hr>
<h3>4.2 Metadataï¼ˆå…ƒæ•°æ®ï¼‰- å­—æ®µå®šä¹‰å±‚</h3>
<h4>4.2.1 èŒè´£å®šä½</h4>
<p><strong>Metadata æ˜¯æ•´ä¸ªæ–‡æ¡£çš„&quot;Schema&quot;</strong>ï¼Œå®šä¹‰ï¼š</p>
<ul>
<li>æ•°æ®è¡Œæœ‰å“ªäº›å­—æ®µï¼ˆfieldsï¼‰</li>
<li>æ–‡æ¡£å±æ€§æœ‰å“ªäº›å­—æ®µï¼ˆpropertiesï¼‰</li>
<li>æ¯ä¸ªå­—æ®µçš„ç±»å‹ã€éªŒè¯è§„åˆ™ã€è®¡ç®—é€»è¾‘</li>
</ul>
<h4>4.2.2 å­—æ®µç±»å‹ä½“ç³»</h4>
<p><strong>NexusBook æ”¯æŒ 25+ ç§å­—æ®µç±»å‹</strong>ï¼š</p>
<pre><code class="language-typescript">enum FieldType {
  // åŸºç¡€æ–‡æœ¬ç±»å‹
  text,              // å•è¡Œæ–‡æœ¬
  long_text,         // å¤šè¡Œæ–‡æœ¬
  
  // æ•°å€¼ç±»å‹
  number,            // æ•°å­—
  currency,          // è´§å¸
  percent,           // ç™¾åˆ†æ¯”
  
  // æ—¥æœŸæ—¶é—´ç±»å‹
  date,              // æ—¥æœŸ
  datetime,          // æ—¥æœŸæ—¶é—´
  
  // å¸ƒå°”ç±»å‹
  boolean,           // æ˜¯/å¦
  
  // é€‰æ‹©ç±»å‹
  single_select,     // å•é€‰
  multi_select,      // å¤šé€‰
  
  // é™„ä»¶å’Œç”¨æˆ·
  attachment,        // é™„ä»¶
  user,              // ç”¨æˆ·
  collaborator,      // åä½œè€…
  
  // å…³è”ç±»å‹
  relation,          // å…³è”å…¶ä»–æ–‡æ¡£/è¡Œ
  lookup,            // æŸ¥æ‰¾ï¼ˆä»å…³è”è®°å½•è·å–å€¼ï¼‰
  rollup,            // æ±‡æ€»ï¼ˆèšåˆå…³è”è®°å½•ï¼‰
  
  // è®¡ç®—ç±»å‹
  formula,           // å…¬å¼å­—æ®µ
  
  // ç³»ç»Ÿå­—æ®µ
  auto_number,       // è‡ªåŠ¨ç¼–å·
  created_time,      // åˆ›å»ºæ—¶é—´
  updated_time,      // æ›´æ–°æ—¶é—´
  created_by,        // åˆ›å»ºäºº
  updated_by,        // æ›´æ–°äºº
}
</code></pre>
<h4>4.2.3 è®¡ç®—å­—æ®µè¯¦è§£</h4>
<p><strong>1. Formula å­—æ®µ - å…¬å¼è®¡ç®—</strong></p>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;total&quot;,
  &quot;name&quot;: &quot;å°è®¡&quot;,
  &quot;type&quot;: &quot;formula&quot;,
  &quot;formula&quot;: &quot;quantity * price&quot;
}
</code></pre>
<p>æ”¯æŒçš„å‡½æ•°ï¼š</p>
<ul>
<li>æ•°å­¦ï¼šSUM, AVG, MIN, MAX, ROUND, CEIL, FLOOR</li>
<li>æ–‡æœ¬ï¼šCONCAT, UPPER, LOWER, TRIM, SUBSTRING</li>
<li>æ—¥æœŸï¼šNOW, YEAR, MONTH, DAY, DATEDIFF</li>
<li>é€»è¾‘ï¼šIF, AND, OR, NOT</li>
</ul>
<p><strong>2. Lookup å­—æ®µ - è·¨æ–‡æ¡£æŸ¥æ‰¾</strong></p>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;supplierName&quot;,
  &quot;name&quot;: &quot;ä¾›åº”å•†åç§°&quot;,
  &quot;type&quot;: &quot;lookup&quot;,
  &quot;lookup&quot;: {
    &quot;relationFieldId&quot;: &quot;supplier&quot;,      // å…³è”å­—æ®µ
    &quot;targetFieldId&quot;: &quot;name&quot;              // ç›®æ ‡å­—æ®µ
  }
}

// å·¥ä½œåŸç†ï¼š
// 1. å½“å‰è¡Œçš„ supplier å­—æ®µå…³è”åˆ° supplier æ–‡æ¡£çš„æŸä¸€è¡Œ
// 2. ä»é‚£ä¸€è¡Œå–å‡º name å­—æ®µçš„å€¼
// 3. æ˜¾ç¤ºåœ¨å½“å‰è¡Œçš„ supplierName å­—æ®µä¸­
</code></pre>
<p><strong>3. Rollup å­—æ®µ - èšåˆè®¡ç®—</strong></p>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;totalOrderAmount&quot;,
  &quot;name&quot;: &quot;è®¢å•æ€»é¢&quot;,
  &quot;type&quot;: &quot;rollup&quot;,
  &quot;rollup&quot;: {
    &quot;relationFieldId&quot;: &quot;orderItems&quot;,    // å…³è”å­—æ®µï¼ˆä¸€å¯¹å¤šï¼‰
    &quot;targetFieldId&quot;: &quot;total&quot;,           // ç›®æ ‡å­—æ®µ
    &quot;agg&quot;: &quot;sum&quot;                        // èšåˆå‡½æ•°
  }
}

// æ”¯æŒçš„èšåˆå‡½æ•°ï¼š
// - sum: æ±‚å’Œ
// - avg: å¹³å‡å€¼
// - min: æœ€å°å€¼
// - max: æœ€å¤§å€¼
// - count: è®¡æ•°
</code></pre>
<h4>4.2.4 éªŒè¯è§„åˆ™</h4>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;email&quot;,
  &quot;name&quot;: &quot;é‚®ç®±&quot;,
  &quot;type&quot;: &quot;text&quot;,
  &quot;required&quot;: true,
  &quot;unique&quot;: true,
  &quot;validations&quot;: [
    {
      &quot;ruleType&quot;: &quot;pattern&quot;,
      &quot;config&quot;: {
        &quot;pattern&quot;: &quot;^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$&quot;
      },
      &quot;message&quot;: {
        &quot;zh&quot;: &quot;è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€&quot;,
        &quot;en&quot;: &quot;Please enter a valid email address&quot;
      }
    }
  ]
}
</code></pre>
<p><strong>å†…ç½®éªŒè¯è§„åˆ™ç±»å‹</strong>ï¼š</p>
<ul>
<li><code>pattern</code> - æ­£åˆ™è¡¨è¾¾å¼</li>
<li><code>min</code> / <code>max</code> - æ•°å€¼èŒƒå›´</li>
<li><code>minLength</code> / <code>maxLength</code> - æ–‡æœ¬é•¿åº¦</li>
<li><code>enum</code> - æšä¸¾å€¼</li>
<li><code>custom</code> - è‡ªå®šä¹‰éªŒè¯é€»è¾‘</li>
</ul>
<h4>4.2.5 é€‰é¡¹ç®¡ç†</h4>
<pre><code class="language-typescript">{
  &quot;id&quot;: &quot;status&quot;,
  &quot;name&quot;: &quot;çŠ¶æ€&quot;,
  &quot;type&quot;: &quot;single_select&quot;,
  &quot;selectOptions&quot;: [
    {
      &quot;id&quot;: &quot;opt-1&quot;,
      &quot;name&quot;: { &quot;zh&quot;: &quot;å¾…å¤„ç†&quot;, &quot;en&quot;: &quot;Pending&quot; },
      &quot;color&quot;: &quot;yellow&quot;
    },
    {
      &quot;id&quot;: &quot;opt-2&quot;,
      &quot;name&quot;: { &quot;zh&quot;: &quot;è¿›è¡Œä¸­&quot;, &quot;en&quot;: &quot;In Progress&quot; },
      &quot;color&quot;: &quot;blue&quot;
    },
    {
      &quot;id&quot;: &quot;opt-3&quot;,
      &quot;name&quot;: { &quot;zh&quot;: &quot;å·²å®Œæˆ&quot;, &quot;en&quot;: &quot;Completed&quot; },
      &quot;color&quot;: &quot;green&quot;
    },
    {
      &quot;id&quot;: &quot;opt-4&quot;,
      &quot;name&quot;: { &quot;zh&quot;: &quot;å·²å–æ¶ˆ&quot;, &quot;en&quot;: &quot;Cancelled&quot; },
      &quot;color&quot;: &quot;red&quot;
    }
  ]
}
</code></pre>
<hr>
<h3>4.3 Dataï¼ˆæ•°æ®è¡Œï¼‰- å†…å®¹å±‚</h3>
<h4>4.3.1 æ•°æ®æ¨¡å‹</h4>
<pre><code class="language-typescript">model Row {
  id: string;                    // è¡ŒID
  values: ValueEntry[];          // å­—æ®µå€¼é›†åˆ
  
  version?: int64;               // ä¹è§‚é”ç‰ˆæœ¬å·
  createdAt?: string;
  createdBy?: UserRef;
  updatedAt?: string;
  updatedBy?: UserRef;
}
</code></pre>
<h4>4.3.2 CRUD æ“ä½œ</h4>
<pre><code class="language-bash"># 1. åˆ›å»ºè¡Œï¼ˆå¿…é¡»æºå¸¦ requestIdï¼‰
POST /doc/purchaseOrder/order-123/rows?requestId=req-1
{
  &quot;values&quot;: [
    { &quot;fieldId&quot;: &quot;productName&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;iPhone 15&quot; } },
    { &quot;fieldId&quot;: &quot;quantity&quot;, &quot;value&quot;: { &quot;number&quot;: 10 } },
    { &quot;fieldId&quot;: &quot;price&quot;, &quot;value&quot;: { &quot;number&quot;: 799.99 } }
  ]
}

# 2. æ›´æ–°è¡Œ
PUT /doc/purchaseOrder/order-123/rows/row-1?requestId=req-1
{
  &quot;values&quot;: [
    { &quot;fieldId&quot;: &quot;productName&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;iPhone 15 Pro&quot; } },
    { &quot;fieldId&quot;: &quot;quantity&quot;, &quot;value&quot;: { &quot;number&quot;: 15 } },
    { &quot;fieldId&quot;: &quot;price&quot;, &quot;value&quot;: { &quot;number&quot;: 999.99 } }
  ],
  &quot;version&quot;: 2
}

# 3. åˆ é™¤è¡Œ
DELETE /doc/purchaseOrder/order-123/rows/row-1?requestId=req-1

# 4. æŸ¥è¯¢è¡Œï¼ˆæ”¯æŒåˆ†é¡µã€è¿‡æ»¤ã€æ’åºï¼‰
GET /doc/purchaseOrder/order-123/rows?page=1&amp;pageSize=20
POST /doc/purchaseOrder/order-123/rows/query
{
  &quot;filters&quot;: {
    &quot;logic&quot;: &quot;and&quot;,
    &quot;conditions&quot;: [
      { &quot;field&quot;: &quot;quantity&quot;, &quot;operator&quot;: &quot;gte&quot;, &quot;value&quot;: 10 }
    ]
  },
  &quot;sorts&quot;: [
    { &quot;field&quot;: &quot;createdAt&quot;, &quot;direction&quot;: &quot;desc&quot; }
  ],
  &quot;page&quot;: 1,
  &quot;pageSize&quot;: 20
}
</code></pre>
<h4>4.3.3 æ‰¹é‡æ›´æ–°ï¼ˆBulkUpdateï¼‰</h4>
<p><strong>ç»Ÿä¸€çš„æ‰¹é‡æ›´æ–°æ ¼å¼</strong>ï¼š</p>
<pre><code class="language-typescript">// æ‰¹é‡æ›´æ–°æ”¯æŒçµæ´»çš„ target å®šä½
POST /doc/purchaseOrder/order-123/rows/batch-update?requestId=req-1
[
  // 1. æ›´æ–°å•ä¸ªå•å…ƒæ ¼
  {
    &quot;target&quot;: { &quot;row&quot;: &quot;row-1&quot;, &quot;field&quot;: &quot;price&quot; },
    &quot;value&quot;: 99.99
  },
  
  // 2. æ›´æ–°æ•´è¡Œï¼ˆå¤šä¸ªå­—æ®µï¼‰
  {
    &quot;target&quot;: { &quot;row&quot;: &quot;row-2&quot; },
    &quot;value&quot;: {
      &quot;productName&quot;: &quot;iPad Pro&quot;,
      &quot;quantity&quot;: 5,
      &quot;price&quot;: 1099.99
    }
  },
  
  // 3. æ‰¹é‡æ›´æ–°å¤šè¡Œçš„åŒä¸€å­—æ®µ
  {
    &quot;target&quot;: { &quot;rows&quot;: [&quot;row-3&quot;, &quot;row-4&quot;, &quot;row-5&quot;], &quot;field&quot;: &quot;status&quot; },
    &quot;value&quot;: &quot;active&quot;
  },
  
  // 4. æ›´æ–°æ–‡æ¡£å±æ€§
  {
    &quot;target&quot;: { &quot;property&quot;: &quot;totalAmount&quot; },
    &quot;value&quot;: 50000.00
  },
  
  // 5. æ‰¹é‡æ›´æ–°å¤šä¸ªå±æ€§
  {
    &quot;target&quot;: { &quot;properties&quot;: true },
    &quot;value&quot;: {
      &quot;totalAmount&quot;: 50000.00,
      &quot;itemCount&quot;: 100
    }
  }
]
</code></pre>
<p><strong>æœåŠ¡ç«¯è‡ªåŠ¨å¤„ç†</strong>ï¼š</p>
<ol>
<li>æ ¹æ® <code>target</code> å®šä½è¦æ›´æ–°çš„ä½ç½®</li>
<li>æ ¹æ® Metadata è§£æ <code>value</code> çš„ç±»å‹</li>
<li>æ‰§è¡Œç±»å‹éªŒè¯</li>
<li>è®°å½•åˆ° Request çš„ Changes ä¸­</li>
</ol>
<hr>
<h3>4.4 Viewsï¼ˆè§†å›¾ï¼‰- å±•ç¤ºå±‚</h3>
<h4>4.4.1 è§†å›¾ç±»å‹</h4>
<pre><code class="language-typescript">enum ViewType {
  table,      // è¡¨æ ¼è§†å›¾ - æœ€å¸¸ç”¨ï¼Œç±»ä¼¼ Excel
  gallery,    // ç”»å»Šè§†å›¾ - å¡ç‰‡å±•ç¤ºï¼Œé€‚åˆå›¾ç‰‡ç±»å†…å®¹
  kanban,     // çœ‹æ¿è§†å›¾ - æŒ‰çŠ¶æ€åˆ†ç»„ï¼Œé€‚åˆä»»åŠ¡ç®¡ç†
  calendar,   // æ—¥å†è§†å›¾ - æŒ‰æ—¥æœŸå±•ç¤ºï¼Œé€‚åˆäº‹ä»¶ç®¡ç†
  chart,      // å›¾è¡¨è§†å›¾ - æ•°æ®å¯è§†åŒ–
  form,       // è¡¨å•è§†å›¾ - å•æ¡è®°å½•ç¼–è¾‘
  map,        // åœ°å›¾è§†å›¾ - åœ°ç†ä½ç½®å±•ç¤º
  timeline,   // æ—¶é—´çº¿è§†å›¾ - æŒ‰æ—¶é—´è½´å±•ç¤º
}
</code></pre>
<h4>4.4.2 è§†å›¾é…ç½®</h4>
<pre><code class="language-typescript">model View {
  id: string;
  name: string;
  type: ViewType;
  
  config: {
    // æ˜¾ç¤ºå“ªäº›å­—æ®µ
    columns?: string[];
    
    // è¿‡æ»¤æ¡ä»¶
    filters?: Filter;
    
    // æ’åºè§„åˆ™
    sorts?: SortField[];
    
    // åˆ†ç»„å­—æ®µ
    groupBy?: string;
    
    // è§†å›¾ç‰¹å®šé…ç½®
    kanbanConfig?: {
      groupByField: string;       // æŒ‰å“ªä¸ªå­—æ®µåˆ†ç»„ï¼ˆå¦‚ statusï¼‰
      cardFields: string[];       // å¡ç‰‡æ˜¾ç¤ºå“ªäº›å­—æ®µ
    };
    
    calendarConfig?: {
      dateField: string;          // æ—¥æœŸå­—æ®µ
      titleField: string;         // æ ‡é¢˜å­—æ®µ
    };
    
    chartConfig?: {
      xField: string;             // Xè½´å­—æ®µ
      yField: string;             // Yè½´å­—æ®µ
      chartType: &quot;bar&quot; | &quot;line&quot; | &quot;pie&quot;;
    };
  };
}
</code></pre>
<h4>4.4.3 è¿‡æ»¤å™¨ç¤ºä¾‹</h4>
<pre><code class="language-typescript">// å¤æ‚è¿‡æ»¤æ¡ä»¶
{
  &quot;logic&quot;: &quot;and&quot;,
  &quot;conditions&quot;: [
    {
      &quot;field&quot;: &quot;status&quot;,
      &quot;operator&quot;: &quot;eq&quot;,
      &quot;value&quot;: &quot;pending&quot;
    },
    {
      &quot;logic&quot;: &quot;or&quot;,
      &quot;conditions&quot;: [
        {
          &quot;field&quot;: &quot;priority&quot;,
          &quot;operator&quot;: &quot;eq&quot;,
          &quot;value&quot;: &quot;high&quot;
        },
        {
          &quot;field&quot;: &quot;amount&quot;,
          &quot;operator&quot;: &quot;gte&quot;,
          &quot;value&quot;: 10000
        }
      ]
    }
  ]
}
</code></pre>
<p><strong>æ”¯æŒçš„æ“ä½œç¬¦</strong>ï¼š</p>
<ul>
<li><code>eq</code> / <code>ne</code> - ç­‰äº/ä¸ç­‰äº</li>
<li><code>gt</code> / <code>gte</code> / <code>lt</code> / <code>lte</code> - å¤§äº/å¤§äºç­‰äº/å°äº/å°äºç­‰äº</li>
<li><code>in</code> / <code>notIn</code> - åŒ…å«äº/ä¸åŒ…å«äº</li>
<li><code>contains</code> / <code>startsWith</code> / <code>endsWith</code> - æ–‡æœ¬åŒ…å«/å¼€å¤´/ç»“å°¾</li>
<li><code>isEmpty</code> / <code>isNotEmpty</code> - ä¸ºç©º/ä¸ä¸ºç©º</li>
</ul>
<hr>
<h3>4.5 Commentsï¼ˆè¯„è®ºï¼‰- åä½œå±‚</h3>
<h4>4.5.1 ç²¾ç¡®ä½ç½®è¯„è®º</h4>
<p><strong>æ”¯æŒå››çº§å®šä½</strong>ï¼š</p>
<pre><code class="language-typescript">// 1. æ–‡æ¡£çº§è¯„è®º
{
  &quot;content&quot;: &quot;è¿™ä¸ªè®¢å•éœ€è¦å°½å¿«å¤„ç†&quot;,
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;document&quot;
  }
}

// 2. å­—æ®µçº§è¯„è®º
{
  &quot;content&quot;: &quot;äº§å“åç§°å­—æ®µçš„æ ¼å¼éœ€è¦ç»Ÿä¸€&quot;,
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;field&quot;,
    &quot;fieldId&quot;: &quot;productName&quot;
  }
}

// 3. è¡Œçº§è¯„è®º
{
  &quot;content&quot;: &quot;è¿™ä¸€è¡Œçš„æ•°é‡æœ‰é—®é¢˜&quot;,
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;row&quot;,
    &quot;rowId&quot;: &quot;row-123&quot;
  }
}

// 4. å•å…ƒæ ¼çº§è¯„è®º
{
  &quot;content&quot;: &quot;è¿™ä¸ªå•ä»·éœ€è¦ç¡®è®¤&quot;,
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;cell&quot;,
    &quot;rowId&quot;: &quot;row-123&quot;,
    &quot;fieldId&quot;: &quot;price&quot;
  }
}
</code></pre>
<h4>4.5.2 è¯„è®ºçº¿ç¨‹</h4>
<pre><code class="language-typescript">// 1. åˆ›å»ºé¡¶å±‚è¯„è®º
POST /doc/order/123/comments
{
  &quot;content&quot;: &quot;è¯·æ£€æŸ¥ç¬¬3è¡Œçš„æ•°é‡&quot;,
  &quot;target&quot;: { &quot;scope&quot;: &quot;row&quot;, &quot;rowId&quot;: &quot;row-3&quot; }
}
// è¿”å›: { &quot;id&quot;: &quot;comment-1&quot; }

// 2. å›å¤è¯„è®ºï¼ˆå½¢æˆçº¿ç¨‹ï¼‰
POST /doc/order/123/comments
{
  &quot;content&quot;: &quot;å·²ç»æ£€æŸ¥è¿‡äº†ï¼Œæ•°é‡æ­£ç¡®&quot;,
  &quot;parentId&quot;: &quot;comment-1&quot;
}

// 3. ç»§ç»­å›å¤
POST /doc/order/123/comments
{
  &quot;content&quot;: &quot;å¥½çš„ï¼Œé‚£æˆ‘é€šè¿‡å®¡æ‰¹&quot;,
  &quot;parentId&quot;: &quot;comment-1&quot;
}
</code></pre>
<h4>4.5.3 @æåŠå’Œé€šçŸ¥</h4>
<pre><code class="language-typescript">{
  &quot;content&quot;: &quot;@user-456 è¯·å¸®å¿™ç¡®è®¤è¿™ä¸ªè®¢å•çš„å•ä»·&quot;,
  &quot;mentions&quot;: [&quot;user-456&quot;],
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;cell&quot;,
    &quot;rowId&quot;: &quot;row-1&quot;,
    &quot;fieldId&quot;: &quot;price&quot;
  }
}
</code></pre>
<h4>4.5.4 è¡¨æƒ…ååº”</h4>
<pre><code class="language-typescript">// æ·»åŠ è¡¨æƒ…ååº”
POST /doc/order/123/comments/comment-1/reactions
{
  &quot;emoji&quot;: &quot;ğŸ‘&quot;
}

// è¯„è®ºå¯¹è±¡åŒ…å«ååº”ç»Ÿè®¡
{
  &quot;id&quot;: &quot;comment-1&quot;,
  &quot;content&quot;: &quot;è¿™ä¸ªæ–¹æ¡ˆä¸é”™&quot;,
  &quot;reactions&quot;: [
    {
      &quot;emoji&quot;: &quot;ğŸ‘&quot;,
      &quot;users&quot;: [&quot;user-1&quot;, &quot;user-2&quot;, &quot;user-3&quot;],
      &quot;count&quot;: 3
    },
    {
      &quot;emoji&quot;: &quot;â¤ï¸&quot;,
      &quot;users&quot;: [&quot;user-4&quot;],
      &quot;count&quot;: 1
    }
  ]
}
</code></pre>
<h4>4.5.5 è§£å†³çŠ¶æ€</h4>
<pre><code class="language-typescript">// æ ‡è®°è¯„è®ºå·²è§£å†³
POST /doc/order/123/comments/comment-1/resolve

// æŸ¥è¯¢æœªè§£å†³çš„è¯„è®º
GET /doc/order/123/comments?resolved=false
</code></pre>
<hr>
<h3>4.6 Requests &amp; Revisions - å·¥ä½œæµå±‚</h3>
<h4>4.6.1 Requestï¼ˆå˜æ›´è¯·æ±‚ï¼‰æ¨¡å‹</h4>
<pre><code class="language-typescript">model Request {
  id: string;
  docType: string;
  docId: string;
  
  title?: string;
  description?: string;
  
  status: &quot;open&quot; | &quot;merged&quot; | &quot;closed&quot;;
  
  author: UserRef;
  reviewers?: UserRef[];
  contributors?: UserRef[];         // æ‰€æœ‰ç¼–è¾‘è¿‡è¿™ä¸ª Request çš„äºº
  
  changes: Change[];                // å¾…åˆå¹¶çš„å˜æ›´
  
  generatedRevisionId?: string;     // åˆå¹¶åç”Ÿæˆçš„ Revision ID
  
  createdAt: string;
  updatedAt: string;
  mergedAt?: string;
  mergedBy?: UserRef;
}

model Change {
  id: string;
  type: string;                     // row-create, row-update, property-update...
  operation: &quot;create&quot; | &quot;update&quot; | &quot;delete&quot;;
  targetId?: string;                // ç›®æ ‡è¡Œ/å±æ€§ID
  data: unknown;                    // å˜æ›´æ•°æ®
  changedAt: string;
  changedBy: UserRef;
}
</code></pre>
<h4>4.6.2 Revisionï¼ˆä¿®è®¢å†å²ï¼‰æ¨¡å‹</h4>
<pre><code class="language-typescript">model Revision {
  id: string;
  version: int64;
  
  requestId?: string;               // æº Request ID
  title?: string;
  description?: string;
  
  contributors: UserRef[];          // æ‰€æœ‰è´¡çŒ®è€…
  mergedBy: UserRef;
  
  changes: ChangeOperation[];       // å…·ä½“çš„å˜æ›´æ“ä½œ
  
  stats: {                          // ç»Ÿè®¡ä¿¡æ¯
    rowsCreated: int32;
    rowsUpdated: int32;
    rowsDeleted: int32;
    fieldsCreated: int32;
    fieldsUpdated: int32;
    fieldsDeleted: int32;
  };
  
  previousRevisionId?: string;      // å‰ä¸€ä¸ª Revision ID
  createdAt: string;
  updatedAt: string;
}

model ChangeOperation {
  id: string;
  type: string;
  
  target: {
    kind: string;                   // row, property, field...
    rowId?: string;
    fieldId?: string;
  };
  
  oldValue?: unknown;               // ä¿®æ”¹å‰çš„å€¼
  newValue?: unknown;               // ä¿®æ”¹åçš„å€¼
  
  operator: string;                 // æ“ä½œäºº
  timestamp: string;
  note?: string;
}
</code></pre>
<h4>4.6.3 å®Œæ•´å·¥ä½œæµ</h4>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: åˆ›å»º Request                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
POST /doc/purchaseOrder/order-123/requests
{
  &quot;title&quot;: &quot;æ›´æ–°12æœˆé‡‡è´­è®¢å•&quot;,
  &quot;description&quot;: &quot;è°ƒæ•´æ•°é‡å’Œä»·æ ¼&quot;
}
è¿”å›: { &quot;id&quot;: &quot;req-1&quot; }

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: å¤šäººååŒç¼–è¾‘ (æ‰€æœ‰æ“ä½œæºå¸¦ requestId=req-1)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// ç”¨æˆ·A: åˆ›å»ºæ–°è¡Œ
POST /doc/purchaseOrder/order-123/rows?requestId=req-1
{ &quot;values&quot;: [...] }
â†’ Request.changes æ–°å¢ Change { type: &quot;row-create&quot; }
â†’ Request.contributors æ–°å¢ ç”¨æˆ·A

// ç”¨æˆ·B: æ›´æ–°è¡Œ
PUT /doc/purchaseOrder/order-123/rows/row-1?requestId=req-1
{ &quot;values&quot;: [...] }
â†’ Request.changes æ–°å¢ Change { type: &quot;row-update&quot; }
â†’ Request.contributors æ–°å¢ ç”¨æˆ·B

// ç”¨æˆ·C: æ›´æ–°å±æ€§
PATCH /doc/purchaseOrder/order-123/properties?requestId=req-1
{ &quot;properties&quot;: [...] }
â†’ Request.changes æ–°å¢ Change { type: &quot;property-update&quot; }
â†’ Request.contributors æ–°å¢ ç”¨æˆ·C

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: æŸ¥çœ‹ Request çŠ¶æ€                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
GET /doc/purchaseOrder/order-123/requests/req-1
{
  &quot;id&quot;: &quot;req-1&quot;,
  &quot;title&quot;: &quot;æ›´æ–°12æœˆé‡‡è´­è®¢å•&quot;,
  &quot;status&quot;: &quot;open&quot;,
  &quot;author&quot;: { &quot;id&quot;: &quot;user-A&quot; },
  &quot;contributors&quot;: [&quot;user-A&quot;, &quot;user-B&quot;, &quot;user-C&quot;],
  &quot;changes&quot;: [
    { &quot;type&quot;: &quot;row-create&quot;, &quot;changedBy&quot;: &quot;user-A&quot; },
    { &quot;type&quot;: &quot;row-update&quot;, &quot;changedBy&quot;: &quot;user-B&quot; },
    { &quot;type&quot;: &quot;property-update&quot;, &quot;changedBy&quot;: &quot;user-C&quot; }
  ]
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: æŸ¥çœ‹ Diff                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
GET /doc/purchaseOrder/order-123/requests/req-1/diff
{
  &quot;added&quot;: [
    { &quot;rowId&quot;: &quot;row-10&quot;, &quot;values&quot;: [...] }
  ],
  &quot;updated&quot;: [
    {
      &quot;rowId&quot;: &quot;row-1&quot;,
      &quot;fieldId&quot;: &quot;quantity&quot;,
      &quot;oldValue&quot;: 10,
      &quot;newValue&quot;: 15
    }
  ],
  &quot;properties&quot;: {
    &quot;totalAmount&quot;: {
      &quot;oldValue&quot;: 50000,
      &quot;newValue&quot;: 55000
    }
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: æäº¤å®¡æ‰¹ (å¯é€‰)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
POST /doc/purchaseOrder/order-123/requests/req-1/submit-approval
{
  &quot;approvers&quot;: [&quot;user-manager&quot;]
}

// å®¡æ‰¹è€…æŸ¥çœ‹å¹¶æ‰¹å‡†
POST /doc/purchaseOrder/order-123/approvals/approval-1/approve
{
  &quot;decision&quot;: &quot;approved&quot;,
  &quot;comment&quot;: &quot;é‡‡è´­å•ä»·åˆç†ï¼Œæ‰¹å‡†&quot;
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: åˆå¹¶ Request                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
POST /doc/purchaseOrder/order-123/requests/req-1/merge

// ç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œ:
1. å°†æ‰€æœ‰ Changes è½¬æ¢ä¸º ChangeOperations
2. åˆ›å»º Revision
   {
     &quot;id&quot;: &quot;rev-001&quot;,
     &quot;version&quot;: 1,
     &quot;requestId&quot;: &quot;req-1&quot;,
     &quot;contributors&quot;: [&quot;user-A&quot;, &quot;user-B&quot;, &quot;user-C&quot;],
     &quot;mergedBy&quot;: &quot;user-manager&quot;,
     &quot;changes&quot;: [
       {
         &quot;type&quot;: &quot;row-create&quot;,
         &quot;target&quot;: { &quot;kind&quot;: &quot;row&quot;, &quot;rowId&quot;: &quot;row-10&quot; },
         &quot;newValue&quot;: {...},
         &quot;operator&quot;: &quot;user-A&quot;
       },
       {
         &quot;type&quot;: &quot;row-update&quot;,
         &quot;target&quot;: { &quot;kind&quot;: &quot;row&quot;, &quot;rowId&quot;: &quot;row-1&quot;, &quot;fieldId&quot;: &quot;quantity&quot; },
         &quot;oldValue&quot;: 10,
         &quot;newValue&quot;: 15,
         &quot;operator&quot;: &quot;user-B&quot;
       },
       {
         &quot;type&quot;: &quot;property-update&quot;,
         &quot;target&quot;: { &quot;kind&quot;: &quot;property&quot;, &quot;fieldId&quot;: &quot;totalAmount&quot; },
         &quot;oldValue&quot;: 50000,
         &quot;newValue&quot;: 55000,
         &quot;operator&quot;: &quot;user-C&quot;
       }
     ],
     &quot;stats&quot;: {
       &quot;rowsCreated&quot;: 1,
       &quot;rowsUpdated&quot;: 1,
       &quot;rowsDeleted&quot;: 0
     }
   }
3. æ›´æ–° Request
   {
     &quot;status&quot;: &quot;merged&quot;,
     &quot;generatedRevisionId&quot;: &quot;rev-001&quot;,
     &quot;mergedAt&quot;: &quot;2024-12-01T14:00:00Z&quot;,
     &quot;mergedBy&quot;: &quot;user-manager&quot;
   }
4. å®é™…å†™å…¥æ•°æ®åº“

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 7: æŸ¥çœ‹å†å²å’Œå¯¹æ¯”                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

// æŸ¥çœ‹æ‰€æœ‰ä¿®è®¢
GET /doc/purchaseOrder/order-123/revisions
[
  {
    &quot;id&quot;: &quot;rev-001&quot;,
    &quot;version&quot;: 1,
    &quot;title&quot;: &quot;æ›´æ–°12æœˆé‡‡è´­è®¢å•&quot;,
    &quot;contributors&quot;: [&quot;user-A&quot;, &quot;user-B&quot;, &quot;user-C&quot;],
    &quot;stats&quot;: { &quot;rowsCreated&quot;: 1, &quot;rowsUpdated&quot;: 1 }
  }
]

// æŸ¥çœ‹ä¿®è®¢è¯¦æƒ…
GET /doc/purchaseOrder/order-123/revisions/rev-001
{
  &quot;changes&quot;: [...],  // æ‰€æœ‰ ChangeOperations
  &quot;stats&quot;: {...}
}

// å¯¹æ¯”ä¸¤ä¸ªä¿®è®¢
GET /doc/purchaseOrder/order-123/revisions/rev-002/diff?base=rev-001

// æŸ¥è¯¢æŸè¡Œçš„å®Œæ•´å˜æ›´å†å²
GET /doc/purchaseOrder/order-123/revisions/history?targetKind=row&amp;rowId=row-1
</code></pre>
<hr>
<h3>4.7 Settingsï¼ˆè®¾ç½®ï¼‰- é…ç½®å±‚</h3>
<pre><code class="language-typescript">model DocumentSettings {
  permissions: {
    view: string[];                 // è°å¯ä»¥æŸ¥çœ‹
    edit: string[];                 // è°å¯ä»¥ç¼–è¾‘
    delete: string[];               // è°å¯ä»¥åˆ é™¤
    share: string[];                // è°å¯ä»¥åˆ†äº«
  };
  
  notifications: {
    onCommentAdd: boolean;          // æ–°è¯„è®ºæ—¶é€šçŸ¥
    onDataChange: boolean;          // æ•°æ®å˜æ›´æ—¶é€šçŸ¥
    onMerge: boolean;               // Request åˆå¹¶æ—¶é€šçŸ¥
  };
  
  workflow: {
    requiresApproval: boolean;      // æ˜¯å¦éœ€è¦å®¡æ‰¹
    approvers: string[];            // å®¡æ‰¹è€…åˆ—è¡¨
    autoMerge: boolean;             // å®¡æ‰¹é€šè¿‡åè‡ªåŠ¨åˆå¹¶
  };
}

model DocumentTypeSettings {
  // æ–‡æ¡£ç±»å‹çº§åˆ«çš„è®¾ç½®
  defaultMetadata: Metadata;        // é»˜è®¤å­—æ®µå®šä¹‰
  defaultViews: View[];             // é»˜è®¤è§†å›¾
  permissions: {...};               // é»˜è®¤æƒé™
}
</code></pre>
<hr>
<h2>5. å˜æ›´å·¥ä½œæµ</h2>
<h3>5.1 ä¸ºä»€ä¹ˆéœ€è¦ Request/Revision æœºåˆ¶ï¼Ÿ</h3>
<p><strong>é—®é¢˜åœºæ™¯</strong>ï¼š</p>
<ul>
<li>å¤šäººåŒæ—¶ç¼–è¾‘ä¸€ä¸ªè®¢å•ï¼Œå¦‚ä½•é¿å…å†²çªï¼Ÿ</li>
<li>å¦‚ä½•çŸ¥é“è°åœ¨ä»€ä¹ˆæ—¶å€™æ”¹äº†ä»€ä¹ˆï¼Ÿ</li>
<li>é‡è¦å˜æ›´éœ€è¦ç»ç†å®¡æ‰¹ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</li>
<li>å‘ç°é”™è¯¯éœ€è¦å›æ»šï¼Œå¦‚ä½•å®‰å…¨å›é€€ï¼Ÿ</li>
</ul>
<p><strong>ä¼ ç»Ÿæ–¹æ¡ˆçš„é—®é¢˜</strong>ï¼š</p>
<pre><code>ç›´æ¥ä¿®æ”¹æ•°æ®åº“
  â†“
æ•°æ®ç«‹å³ç”Ÿæ•ˆ
  â†“
âŒ æ— æ³•ååŒï¼šå¤šäººåŒæ—¶æ”¹ä¼šå†²çª
âŒ æ— æ³•è¿½æº¯ï¼šä¸çŸ¥é“è°æ”¹çš„
âŒ æ— æ³•å®¡æ‰¹ï¼šæ”¹å®Œå°±ç”Ÿæ•ˆäº†
âŒ éš¾ä»¥å›æ»šï¼šä¸çŸ¥é“æ”¹äº†ä»€ä¹ˆ
</code></pre>
<p><strong>NexusBook æ–¹æ¡ˆ</strong>ï¼š</p>
<pre><code>ç”¨æˆ·ä¿®æ”¹ â†’ Request (è‰ç¨¿)
  â†“
å¤šäººååŒç¼–è¾‘åŒä¸€ä¸ª Request
  â†“
å®¡æ‰¹æµç¨‹ (å¯é€‰)
  â†“
åˆå¹¶ Request â†’ Revision (æ°¸ä¹…è®°å½•)
  â†“
æ•°æ®åº“å†™å…¥ç”Ÿæ•ˆ
</code></pre>
<h3>5.2 ç±»æ¯”ï¼šGit å·¥ä½œæµ</h3>
<table>
<thead>
<tr>
<th>Git</th>
<th>NexusBook</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>Working Directory</td>
<td>ç”¨æˆ·æœ¬åœ°ç¼–è¾‘</td>
<td>ä¸´æ—¶ä¿®æ”¹</td>
</tr>
<tr>
<td>Branch</td>
<td>Request</td>
<td>å˜æ›´é›†åˆ</td>
</tr>
<tr>
<td>Commit</td>
<td>Change</td>
<td>å•ä¸ªå˜æ›´</td>
</tr>
<tr>
<td>Pull Request</td>
<td>Request + Approval</td>
<td>å®¡æ‰¹æµç¨‹</td>
</tr>
<tr>
<td>Merge</td>
<td>Merge Request</td>
<td>åˆå¹¶åˆ°ä¸»åˆ†æ”¯</td>
</tr>
<tr>
<td>Commit History</td>
<td>Revision</td>
<td>ä¸å¯å˜å†å²</td>
</tr>
<tr>
<td>Revert</td>
<td>Revert Revision</td>
<td>åŸºäºå†å²åˆ›å»ºæ–°çš„å›æ»šå˜æ›´</td>
</tr>
</tbody></table>
<h3>5.3 å¹¶å‘æ§åˆ¶</h3>
<p><strong>ä¹è§‚é”æœºåˆ¶</strong>ï¼š</p>
<pre><code class="language-typescript">// 1. è¯»å–è¡Œï¼ˆè·å–ç‰ˆæœ¬å·ï¼‰
GET /doc/order/123/rows/row-1
{
  &quot;id&quot;: &quot;row-1&quot;,
  &quot;values&quot;: [...],
  &quot;version&quot;: 5
}

// 2. æ›´æ–°æ—¶æºå¸¦ç‰ˆæœ¬å·
PUT /doc/order/123/rows/row-1?requestId=req-1
{
  &quot;values&quot;: [...],
  &quot;version&quot;: 5        // å¿…é¡»åŒ¹é…å½“å‰ç‰ˆæœ¬
}

// 3. å¦‚æœç‰ˆæœ¬ä¸åŒ¹é…ï¼Œè¿”å›å†²çªé”™è¯¯
{
  &quot;success&quot;: false,
  &quot;code&quot;: &quot;VERSION_CONFLICT&quot;,
  &quot;message&quot;: {
    &quot;zh&quot;: &quot;æ•°æ®å·²è¢«å…¶ä»–ç”¨æˆ·ä¿®æ”¹ï¼Œè¯·åˆ·æ–°åé‡è¯•&quot;,
    &quot;en&quot;: &quot;Data has been modified by another user&quot;
  },
  &quot;payload&quot;: {
    &quot;currentVersion&quot;: 6,
    &quot;yourVersion&quot;: 5
  }
}
</code></pre>
<h3>5.4 Approvalï¼ˆå®¡æ‰¹ï¼‰å·¥ä½œæµ</h3>
<pre><code class="language-typescript">// 1. æäº¤å®¡æ‰¹
POST /doc/order/123/requests/req-1/submit-approval
{
  &quot;approvers&quot;: [&quot;manager-1&quot;, &quot;manager-2&quot;],
  &quot;strategy&quot;: &quot;sequential&quot;          // sequential: ä¸²ç­¾, parallel: å¹¶ç­¾
}

// 2. å®¡æ‰¹è€…æŸ¥çœ‹ Request
GET /doc/order/123/requests/req-1
GET /doc/order/123/requests/req-1/diff

// 3. å®¡æ‰¹è€…åšå‡ºå†³ç­–
POST /doc/order/123/approvals/approval-1/approve
{
  &quot;decision&quot;: &quot;approved&quot;,           // approved, rejected, request_changes
  &quot;comment&quot;: &quot;é‡‡è´­ä»·æ ¼åˆç†ï¼Œæ‰¹å‡†&quot;
}

// 4. æ‰€æœ‰å®¡æ‰¹é€šè¿‡åï¼Œå¯ä»¥åˆå¹¶
POST /doc/order/123/requests/req-1/merge
</code></pre>
<p><strong>å®¡æ‰¹ç­–ç•¥</strong>ï¼š</p>
<ul>
<li><strong>ä¸²ç­¾</strong> (sequential): æŒ‰é¡ºåºé€ä¸ªå®¡æ‰¹ï¼Œå‰ä¸€ä¸ªé€šè¿‡æ‰èƒ½åˆ°ä¸‹ä¸€ä¸ª</li>
<li><strong>å¹¶ç­¾</strong> (parallel): æ‰€æœ‰å®¡æ‰¹è€…åŒæ—¶å®¡æ‰¹ï¼Œå…¨éƒ¨é€šè¿‡æ‰ç®—é€šè¿‡</li>
<li><strong>æ¡ä»¶ç­¾</strong>: æ ¹æ®æ¡ä»¶é€‰æ‹©å®¡æ‰¹è€…ï¼ˆå¦‚é‡‘é¢&gt;10ä¸‡éœ€è¦æ€»ç›‘å®¡æ‰¹ï¼‰</li>
</ul>
<hr>
<h2>6. å®ç°åŸç†</h2>
<h3>6.1 TypeSpec å®šä¹‰åˆ° OpenAPI</h3>
<p>NexusBook ä½¿ç”¨ <strong>TypeSpec</strong> å®šä¹‰ APIï¼Œè‡ªåŠ¨ç”Ÿæˆ OpenAPI è§„èŒƒï¼š</p>
<pre><code class="language-typescript">// api/document/core/data.tsp
@route(&quot;/doc/{docType}/{docId}/rows&quot;)
@tag(&quot;Document - Core&quot;)
interface DataApi {
  @post
  @summary(&quot;åˆ›å»ºæ•°æ®è¡Œ&quot;)
  createRow(
    @path docType: string,
    @path docId: string,
    @query requestId: string,
    @body row: CreateRowRequest,
  ): ApiResponse&lt;Row&gt;;
}
</code></pre>
<p><strong>ç¼–è¯‘æµç¨‹</strong>ï¼š</p>
<pre><code>TypeSpec (.tsp)
  â†“ tsp compile
OpenAPI 3.0 (openapi.yaml)
  â†“ openapi-generator
æœåŠ¡ç«¯ä»£ç  (Go/Java/...)
å®¢æˆ·ç«¯SDK (TypeScript/Python/...)
APIæ–‡æ¡£ (Redocly)
</code></pre>
<h3>6.2 å­˜å‚¨æ¨¡å‹</h3>
<p><strong>é€»è¾‘æ¨¡å‹ vs ç‰©ç†æ¨¡å‹</strong>ï¼š</p>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é€»è¾‘æ¨¡å‹ (ç”¨æˆ·è§†è§’)                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Document                                                      â”‚
â”‚ â”œâ”€ Properties                                                â”‚
â”‚ â”œâ”€ Metadata                                                  â”‚
â”‚ â”œâ”€ Data (Rows)                                               â”‚
â”‚ â”œâ”€ Views                                                     â”‚
â”‚ â”œâ”€ Comments                                                  â”‚
â”‚ â”œâ”€ Requests                                                  â”‚
â”‚ â””â”€ Revisions                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç‰©ç†æ¨¡å‹ (æ•°æ®åº“)                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ documents (æ–‡æ¡£åŸºæœ¬ä¿¡æ¯)                                      â”‚
â”‚ document_properties (å±æ€§å€¼ï¼ŒJSON åˆ—)                         â”‚
â”‚ document_metadata (å…ƒæ•°æ®å®šä¹‰ï¼ŒJSON åˆ—)                       â”‚
â”‚ document_rows (æ•°æ®è¡Œï¼ŒJSON åˆ—å­˜å‚¨ values)                    â”‚
â”‚ document_views (è§†å›¾é…ç½®ï¼ŒJSON åˆ—)                            â”‚
â”‚ document_comments (è¯„è®º)                                      â”‚
â”‚ document_requests (å˜æ›´è¯·æ±‚ï¼ŒJSON åˆ—å­˜å‚¨ changes)             â”‚
â”‚ document_revisions (ä¿®è®¢å†å²ï¼ŒJSON åˆ—å­˜å‚¨ changes)            â”‚
â”‚ document_settings (è®¾ç½®)                                      â”‚
â”‚ relation_edges (å…³ç³»è¾¹)                                       â”‚
â”‚ attachments (é™„ä»¶å…ƒæ•°æ®)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆç”¨ JSON åˆ—ï¼Ÿ</strong></p>
<ul>
<li>çµæ´»çš„ Schemaï¼šæ¯ä¸ªæ–‡æ¡£ç±»å‹å¯ä»¥æœ‰ä¸åŒçš„å­—æ®µ</li>
<li>å‡å°‘è¡¨æ•°é‡ï¼šä¸éœ€è¦ä¸ºæ¯ç§æ–‡æ¡£ç±»å‹åˆ›å»ºè¡¨</li>
<li>æŸ¥è¯¢ä¼˜åŒ–ï¼šç°ä»£æ•°æ®åº“ï¼ˆPostgreSQL, MySQL 8.0+ï¼‰å¯¹ JSON æŸ¥è¯¢æœ‰è‰¯å¥½æ”¯æŒ</li>
<li>ç´¢å¼•æ”¯æŒï¼šå¯ä»¥å¯¹ JSON ä¸­çš„ç‰¹å®šå­—æ®µå»ºç«‹ç´¢å¼•</li>
</ul>
<h3>6.3 æŸ¥è¯¢å¼•æ“å®ç°</h3>
<p><strong>Filter ç¿»è¯‘ä¸º SQL</strong>ï¼š</p>
<pre><code class="language-typescript">// API è¯·æ±‚
{
  &quot;filters&quot;: {
    &quot;logic&quot;: &quot;and&quot;,
    &quot;conditions&quot;: [
      { &quot;field&quot;: &quot;status&quot;, &quot;operator&quot;: &quot;eq&quot;, &quot;value&quot;: &quot;pending&quot; },
      { &quot;field&quot;: &quot;amount&quot;, &quot;operator&quot;: &quot;gte&quot;, &quot;value&quot;: 10000 }
    ]
  }
}

// ç¿»è¯‘ä¸º SQL (PostgreSQL)
SELECT *
FROM document_rows
WHERE doc_id = &#39;order-123&#39;
  AND values-&gt;&gt;&#39;status&#39; = &#39;pending&#39;
  AND CAST(values-&gt;&gt;&#39;amount&#39; AS DECIMAL) &gt;= 10000
</code></pre>
<p><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š</p>
<ul>
<li><strong>JSONç´¢å¼•</strong>: <code>CREATE INDEX idx_status ON document_rows ((values-&gt;&gt;&#39;status&#39;))</code></li>
<li><strong>å‡½æ•°ç´¢å¼•</strong>: <code>CREATE INDEX idx_amount ON document_rows (CAST(values-&gt;&gt;&#39;amount&#39; AS DECIMAL))</code></li>
<li><strong>åˆ†åŒºè¡¨</strong>: æŒ‰ docType æˆ–æ—¶é—´åˆ†åŒº</li>
<li><strong>ç¼“å­˜</strong>: Metadata å’Œ Settings é•¿æœŸç¼“å­˜</li>
</ul>
<hr>
<h2>7. å®Œæ•´ä¸šåŠ¡æµç¨‹</h2>
<h3>7.1 åœºæ™¯ï¼šåˆ›å»ºå¹¶ç®¡ç†ä¸€ä¸ªé‡‡è´­è®¢å•</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Day 1: é‡‡è´­å‘˜Aåˆ›å»ºè®¢å•                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. åˆ›å»ºæ–‡æ¡£
POST /doc/purchaseOrder
{
  &quot;id&quot;: &quot;order-2024-12-001&quot;,
  &quot;organizationId&quot;: &quot;org-1&quot;,
  &quot;workspaceId&quot;: &quot;ws-1&quot;
}

2. åˆå§‹åŒ– Properties
POST /doc/purchaseOrder/order-2024-12-001/properties
{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;orderDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2024-12-01&quot; } },
    { &quot;fieldId&quot;: &quot;store&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Beijing Branch&quot; } },
    { &quot;fieldId&quot;: &quot;status&quot;, &quot;value&quot;: { &quot;select&quot;: &quot;draft&quot; } }
  ]
}

3. åˆ›å»º Metadata (å®šä¹‰å­—æ®µ)
POST /doc/purchaseOrder/order-2024-12-001/metadata
{
  &quot;fields&quot;: [
    { &quot;id&quot;: &quot;productName&quot;, &quot;name&quot;: &quot;äº§å“åç§°&quot;, &quot;type&quot;: &quot;text&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;quantity&quot;, &quot;name&quot;: &quot;æ•°é‡&quot;, &quot;type&quot;: &quot;number&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;price&quot;, &quot;name&quot;: &quot;å•ä»·&quot;, &quot;type&quot;: &quot;currency&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;total&quot;, &quot;name&quot;: &quot;å°è®¡&quot;, &quot;type&quot;: &quot;formula&quot;, &quot;formula&quot;: &quot;quantity * price&quot; }
  ],
  &quot;properties&quot;: [
    { &quot;id&quot;: &quot;orderDate&quot;, &quot;name&quot;: &quot;è®¢å•æ—¥æœŸ&quot;, &quot;type&quot;: &quot;date&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;store&quot;, &quot;name&quot;: &quot;é—¨åº—&quot;, &quot;type&quot;: &quot;text&quot;, &quot;required&quot;: true },
    { &quot;id&quot;: &quot;totalAmount&quot;, &quot;name&quot;: &quot;æ€»é‡‘é¢&quot;, &quot;type&quot;: &quot;currency&quot; },
    { &quot;id&quot;: &quot;status&quot;, &quot;name&quot;: &quot;çŠ¶æ€&quot;, &quot;type&quot;: &quot;single_select&quot; }
  ]
}

4. åˆ›å»ºé»˜è®¤è§†å›¾
POST /doc/purchaseOrder/order-2024-12-001/views
{
  &quot;name&quot;: &quot;å…¨éƒ¨äº§å“&quot;,
  &quot;type&quot;: &quot;table&quot;,
  &quot;config&quot;: {
    &quot;columns&quot;: [&quot;productName&quot;, &quot;quantity&quot;, &quot;price&quot;, &quot;total&quot;],
    &quot;sorts&quot;: [{ &quot;field&quot;: &quot;createdAt&quot;, &quot;direction&quot;: &quot;desc&quot; }]
  }
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Day 1 ä¸‹åˆ: é‡‡è´­å‘˜Aæ·»åŠ äº§å“                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. åˆ›å»º Request
POST /doc/purchaseOrder/order-2024-12-001/requests
{
  &quot;title&quot;: &quot;æ·»åŠ åˆå§‹äº§å“æ¸…å•&quot;
}
è¿”å›: { &quot;id&quot;: &quot;req-1&quot; }

6. æ·»åŠ äº§å“è¡Œ (æºå¸¦ requestId)
POST /doc/purchaseOrder/order-2024-12-001/rows?requestId=req-1
{
  &quot;values&quot;: [
    { &quot;fieldId&quot;: &quot;productName&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;iPhone 15&quot; } },
    { &quot;fieldId&quot;: &quot;quantity&quot;, &quot;value&quot;: { &quot;number&quot;: 10 } },
    { &quot;fieldId&quot;: &quot;price&quot;, &quot;value&quot;: { &quot;number&quot;: 799.99 } }
  ]
}

POST /doc/purchaseOrder/order-2024-12-001/rows?requestId=req-1
{
  &quot;values&quot;: [
    { &quot;fieldId&quot;: &quot;productName&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;iPad Pro&quot; } },
    { &quot;fieldId&quot;: &quot;quantity&quot;, &quot;value&quot;: { &quot;number&quot;: 5 } },
    { &quot;fieldId&quot;: &quot;price&quot;, &quot;value&quot;: { &quot;number&quot;: 1099.99 } }
  ]
}

7. åˆå¹¶ Request (æ— éœ€å®¡æ‰¹)
POST /doc/purchaseOrder/order-2024-12-001/requests/req-1/merge
â†’ ç”Ÿæˆ Revision rev-001
â†’ æ•°æ®æ­£å¼å†™å…¥

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Day 2: é‡‡è´­å‘˜Bå‘ç°ä»·æ ¼æœ‰è¯¯ï¼Œæå‡ºè¯„è®º                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

8. æ·»åŠ è¯„è®º
POST /doc/purchaseOrder/order-2024-12-001/comments
{
  &quot;content&quot;: &quot;@user-A iPad Pro çš„å•ä»·åº”è¯¥æ˜¯ 999.99ï¼Œä¸æ˜¯ 1099.99&quot;,
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;cell&quot;,
    &quot;rowId&quot;: &quot;row-2&quot;,
    &quot;fieldId&quot;: &quot;price&quot;
  },
  &quot;mentions&quot;: [&quot;user-A&quot;]
}

9. é‡‡è´­å‘˜Aå›å¤
POST /doc/purchaseOrder/order-2024-12-001/comments
{
  &quot;content&quot;: &quot;å¥½çš„ï¼Œæˆ‘æ¥ä¿®æ”¹&quot;,
  &quot;parentId&quot;: &quot;comment-1&quot;
}

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Day 2: é‡‡è´­å‘˜Aä¿®æ­£ä»·æ ¼ï¼Œæäº¤å®¡æ‰¹                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

10. åˆ›å»ºæ–°çš„ Request
POST /doc/purchaseOrder/order-2024-12-001/requests
{
  &quot;title&quot;: &quot;ä¿®æ­£ iPad Pro ä»·æ ¼&quot;
}
è¿”å›: { &quot;id&quot;: &quot;req-2&quot; }

11. æ›´æ–°ä»·æ ¼
PUT /doc/purchaseOrder/order-2024-12-001/rows/row-2?requestId=req-2
{
  &quot;values&quot;: [
    { &quot;fieldId&quot;: &quot;productName&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;iPad Pro&quot; } },
    { &quot;fieldId&quot;: &quot;quantity&quot;, &quot;value&quot;: { &quot;number&quot;: 5 } },
    { &quot;fieldId&quot;: &quot;price&quot;, &quot;value&quot;: { &quot;number&quot;: 999.99 } }  // ä¿®æ­£
  ],
  &quot;version&quot;: 1
}

12. æäº¤å®¡æ‰¹
POST /doc/purchaseOrder/order-2024-12-001/requests/req-2/submit-approval
{
  &quot;approvers&quot;: [&quot;manager-1&quot;]
}

13. ç»ç†å®¡æ‰¹é€šè¿‡
POST /doc/purchaseOrder/order-2024-12-001/approvals/approval-1/approve
{
  &quot;decision&quot;: &quot;approved&quot;,
  &quot;comment&quot;: &quot;ä»·æ ¼ä¿®æ­£æ­£ç¡®&quot;
}

14. åˆå¹¶ Request
POST /doc/purchaseOrder/order-2024-12-001/requests/req-2/merge
â†’ ç”Ÿæˆ Revision rev-002
â†’ ä»·æ ¼æ›´æ–°ç”Ÿæ•ˆ

15. æ ‡è®°è¯„è®ºå·²è§£å†³
POST /doc/purchaseOrder/order-2024-12-001/comments/comment-1/resolve

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Day 3: æŸ¥çœ‹å˜æ›´å†å²å’Œå®¡è®¡                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

16. æŸ¥çœ‹æ‰€æœ‰ä¿®è®¢
GET /doc/purchaseOrder/order-2024-12-001/revisions
[
  {
    &quot;id&quot;: &quot;rev-001&quot;,
    &quot;version&quot;: 1,
    &quot;title&quot;: &quot;æ·»åŠ åˆå§‹äº§å“æ¸…å•&quot;,
    &quot;contributors&quot;: [&quot;user-A&quot;],
    &quot;stats&quot;: { &quot;rowsCreated&quot;: 2 }
  },
  {
    &quot;id&quot;: &quot;rev-002&quot;,
    &quot;version&quot;: 2,
    &quot;title&quot;: &quot;ä¿®æ­£ iPad Pro ä»·æ ¼&quot;,
    &quot;contributors&quot;: [&quot;user-A&quot;],
    &quot;mergedBy&quot;: &quot;manager-1&quot;,
    &quot;stats&quot;: { &quot;rowsUpdated&quot;: 1 }
  }
]

17. å¯¹æ¯”ä¸¤ä¸ªç‰ˆæœ¬
GET /doc/purchaseOrder/order-2024-12-001/revisions/rev-002/diff?base=rev-001
{
  &quot;updated&quot;: [
    {
      &quot;rowId&quot;: &quot;row-2&quot;,
      &quot;fieldId&quot;: &quot;price&quot;,
      &quot;oldValue&quot;: 1099.99,
      &quot;newValue&quot;: 999.99
    },
    {
      &quot;rowId&quot;: &quot;row-2&quot;,
      &quot;fieldId&quot;: &quot;total&quot;,  // å…¬å¼å­—æ®µè‡ªåŠ¨æ›´æ–°
      &quot;oldValue&quot;: 5499.95,
      &quot;newValue&quot;: 4999.95
    }
  ]
}

18. æŸ¥çœ‹æŸè¡Œçš„å®Œæ•´å˜æ›´å†å²
GET /doc/purchaseOrder/order-2024-12-001/revisions/history?targetKind=row&amp;rowId=row-2
[
  {
    &quot;revisionId&quot;: &quot;rev-001&quot;,
    &quot;operation&quot;: &quot;create&quot;,
    &quot;operator&quot;: &quot;user-A&quot;,
    &quot;timestamp&quot;: &quot;2024-12-01T10:00:00Z&quot;
  },
  {
    &quot;revisionId&quot;: &quot;rev-002&quot;,
    &quot;operation&quot;: &quot;update&quot;,
    &quot;operator&quot;: &quot;user-A&quot;,
    &quot;timestamp&quot;: &quot;2024-12-02T14:30:00Z&quot;,
    &quot;changes&quot;: [
      { &quot;fieldId&quot;: &quot;price&quot;, &quot;oldValue&quot;: 1099.99, &quot;newValue&quot;: 999.99 }
    ]
  }
]
</code></pre>
<h3>7.2 åœºæ™¯ï¼šè·¨æ–‡æ¡£å…³è”</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯ï¼šå‘ç¥¨å¼•ç”¨é‡‡è´­è®¢å•                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. åˆ›å»ºå‘ç¥¨æ–‡æ¡£
POST /doc/invoice
{
  &quot;id&quot;: &quot;inv-2024-12-001&quot;
}

2. åˆ›å»ºå…³è”å…³ç³» (åœ¨ Request ä¸­)
POST /relations?requestId=req-inv-1
{
  &quot;type&quot;: &quot;references&quot;,
  &quot;direction&quot;: &quot;uni&quot;,
  &quot;source&quot;: {
    &quot;docType&quot;: &quot;invoice&quot;,
    &quot;docId&quot;: &quot;inv-2024-12-001&quot;,
    &quot;rowId&quot;: &quot;inv-row-1&quot;
  },
  &quot;target&quot;: {
    &quot;docType&quot;: &quot;purchaseOrder&quot;,
    &quot;docId&quot;: &quot;order-2024-12-001&quot;,
    &quot;rowId&quot;: &quot;row-1&quot;
  },
  &quot;metadata&quot;: {
    &quot;note&quot;: &quot;å‘ç¥¨ç¬¬1è¡Œå¼•ç”¨é‡‡è´­è®¢å•ç¬¬1è¡Œ&quot;
  }
}

3. æŸ¥è¯¢å‡ºè¾¹ (ä»å‘ç¥¨å‡ºå‘)
GET /doc/invoice/inv-2024-12-001/relations
[
  {
    &quot;id&quot;: &quot;rel-001&quot;,
    &quot;type&quot;: &quot;references&quot;,
    &quot;target&quot;: {
      &quot;docType&quot;: &quot;purchaseOrder&quot;,
      &quot;docId&quot;: &quot;order-2024-12-001&quot;,
      &quot;rowId&quot;: &quot;row-1&quot;
    }
  }
]

4. æŸ¥è¯¢å…¥è¾¹ (æŒ‡å‘é‡‡è´­è®¢å•)
GET /doc/purchaseOrder/order-2024-12-001/relations/inbound
[
  {
    &quot;id&quot;: &quot;rel-001&quot;,
    &quot;type&quot;: &quot;references&quot;,
    &quot;source&quot;: {
      &quot;docType&quot;: &quot;invoice&quot;,
      &quot;docId&quot;: &quot;inv-2024-12-001&quot;,
      &quot;rowId&quot;: &quot;inv-row-1&quot;
    }
  }
]

5. åˆ é™¤ä¿æŠ¤ (å°è¯•åˆ é™¤è¢«å¼•ç”¨çš„è¡Œ)
DELETE /doc/purchaseOrder/order-2024-12-001/rows/row-1?requestId=req-3
â†’ è¿”å›é”™è¯¯
{
  &quot;success&quot;: false,
  &quot;code&quot;: &quot;RELATION_CONFLICT&quot;,
  &quot;message&quot;: {
    &quot;zh&quot;: &quot;è¯¥è¡Œè¢«å…¶ä»–æ–‡æ¡£å¼•ç”¨ï¼Œæ— æ³•åˆ é™¤&quot;,
    &quot;en&quot;: &quot;This row is referenced by other documents and cannot be deleted&quot;
  },
  &quot;payload&quot;: {
    &quot;inboundRelations&quot;: [
      {
        &quot;id&quot;: &quot;rel-001&quot;,
        &quot;source&quot;: { &quot;docType&quot;: &quot;invoice&quot;, &quot;docId&quot;: &quot;inv-2024-12-001&quot; }
      }
    ]
  }
}
</code></pre>
<h3>7.3 åœºæ™¯ï¼šæ•°æ®åŒæ­¥</h3>
<pre><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åœºæ™¯ï¼šå°†äº§å“æ•°æ®åŒæ­¥åˆ°å¤–éƒ¨ç³»ç»Ÿ                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. é…ç½®åŒæ­¥
POST /doc/product/prod-catalog/sync/configs
{
  &quot;name&quot;: &quot;åŒæ­¥åˆ° ERP ç³»ç»Ÿ&quot;,
  &quot;targetType&quot;: &quot;webhook&quot;,
  &quot;targetConfig&quot;: {
    &quot;url&quot;: &quot;https://erp.example.com/api/products&quot;,
    &quot;method&quot;: &quot;POST&quot;,
    &quot;headers&quot;: {
      &quot;Authorization&quot;: &quot;Bearer xxx&quot;
    }
  },
  &quot;schedule&quot;: &quot;0 0 * * *&quot;,  // æ¯å¤©å‡Œæ™¨åŒæ­¥
  &quot;enabled&quot;: true
}

2. æ‰‹åŠ¨è§¦å‘åŒæ­¥
POST /doc/product/prod-catalog/sync/configs/sync-1/execute
{
  &quot;filters&quot;: {
    &quot;logic&quot;: &quot;and&quot;,
    &quot;conditions&quot;: [
      { &quot;field&quot;: &quot;status&quot;, &quot;operator&quot;: &quot;eq&quot;, &quot;value&quot;: &quot;active&quot; }
    ]
  }
}

3. æŸ¥çœ‹åŒæ­¥æ—¥å¿—
GET /doc/product/prod-catalog/sync/configs/sync-1/logs
[
  {
    &quot;id&quot;: &quot;log-1&quot;,
    &quot;status&quot;: &quot;success&quot;,
    &quot;recordsSynced&quot;: 150,
    &quot;startedAt&quot;: &quot;2024-12-01T00:00:00Z&quot;,
    &quot;completedAt&quot;: &quot;2024-12-01T00:05:30Z&quot;
  }
]
</code></pre>
<hr>
<h2>8. æœ€ä½³å®è·µ</h2>
<h3>8.1 Properties è®¾è®¡</h3>
<p><strong>âœ… æ¨è</strong>ï¼š</p>
<pre><code class="language-typescript">{
  &quot;properties&quot;: [
    { &quot;fieldId&quot;: &quot;orderDate&quot;, &quot;value&quot;: { &quot;date&quot;: &quot;2024-12-01&quot; } },
    { &quot;fieldId&quot;: &quot;store&quot;, &quot;value&quot;: { &quot;text&quot;: &quot;Beijing Branch&quot; } },
    { &quot;fieldId&quot;: &quot;totalAmount&quot;, &quot;value&quot;: { &quot;number&quot;: 50000.00 } }
  ]
}
</code></pre>
<p><strong>âŒ é¿å…</strong>ï¼š</p>
<pre><code class="language-typescript">// âŒ ä¸è¦åœ¨ Properties ä¸­å­˜å‚¨åˆ—è¡¨æ•°æ®
{
  &quot;properties&quot;: [
    {
      &quot;fieldId&quot;: &quot;products&quot;,
      &quot;value&quot;: {
        &quot;text&quot;: &quot;iPhone 15, iPad Pro, MacBook Air&quot;  // åº”è¯¥ç”¨ Data è¡Œ
      }
    }
  ]
}

// âŒ ä¸è¦è¿‡åº¦åµŒå¥—
{
  &quot;properties&quot;: [
    {
      &quot;fieldId&quot;: &quot;address&quot;,
      &quot;value&quot;: {
        &quot;text&quot;: JSON.stringify({
          &quot;country&quot;: &quot;China&quot;,
          &quot;province&quot;: &quot;Beijing&quot;,
          &quot;city&quot;: &quot;Beijing&quot;,
          &quot;district&quot;: &quot;Chaoyang&quot;
        })
      }
    }
  ]
}
// âœ… åº”è¯¥æ‹†åˆ†ä¸ºå¤šä¸ªå±æ€§å­—æ®µ
</code></pre>
<h3>8.2 Metadata è®¾è®¡</h3>
<p><strong>âœ… æ¨è</strong>ï¼š</p>
<pre><code class="language-typescript">// ä½¿ç”¨æ¸…æ™°çš„å­—æ®µ ID
{
  &quot;id&quot;: &quot;customerEmail&quot;,       // âœ… è‡ªæè¿°
  &quot;name&quot;: &quot;å®¢æˆ·é‚®ç®±&quot;,
  &quot;type&quot;: &quot;text&quot;
}

// æä¾›éªŒè¯è§„åˆ™
{
  &quot;id&quot;: &quot;phone&quot;,
  &quot;name&quot;: &quot;æ‰‹æœºå·&quot;,
  &quot;type&quot;: &quot;text&quot;,
  &quot;required&quot;: true,
  &quot;validations&quot;: [
    {
      &quot;ruleType&quot;: &quot;pattern&quot;,
      &quot;config&quot;: { &quot;pattern&quot;: &quot;^1[3-9]\\d{9}$&quot; },
      &quot;message&quot;: {
        &quot;zh&quot;: &quot;è¯·è¾“å…¥æœ‰æ•ˆçš„æ‰‹æœºå·&quot;,
        &quot;en&quot;: &quot;Please enter a valid phone number&quot;
      }
    }
  ]
}
</code></pre>
<p><strong>âŒ é¿å…</strong>ï¼š</p>
<pre><code class="language-typescript">// âŒ å­—æ®µ ID ä¸æ˜ç¡®
{
  &quot;id&quot;: &quot;field1&quot;,              // éš¾ä»¥ç†è§£
  &quot;name&quot;: &quot;é‚®ç®±&quot;,
  &quot;type&quot;: &quot;text&quot;
}

// âŒ ç¼ºå°‘å¿…è¦çš„éªŒè¯
{
  &quot;id&quot;: &quot;amount&quot;,
  &quot;name&quot;: &quot;é‡‘é¢&quot;,
  &quot;type&quot;: &quot;number&quot;             // ç¼ºå°‘ min/max éªŒè¯
}
</code></pre>
<h3>8.3 æ‰¹é‡æ“ä½œä¼˜åŒ–</h3>
<p><strong>âœ… æ¨è</strong>ï¼š</p>
<pre><code class="language-typescript">// ä½¿ç”¨æ‰¹é‡æ›´æ–°
POST /doc/order/123/rows/batch-update?requestId=req-1
[
  { &quot;target&quot;: { &quot;row&quot;: &quot;row-1&quot;, &quot;field&quot;: &quot;status&quot; }, &quot;value&quot;: &quot;active&quot; },
  { &quot;target&quot;: { &quot;row&quot;: &quot;row-2&quot;, &quot;field&quot;: &quot;status&quot; }, &quot;value&quot;: &quot;active&quot; },
  { &quot;target&quot;: { &quot;row&quot;: &quot;row-3&quot;, &quot;field&quot;: &quot;status&quot; }, &quot;value&quot;: &quot;active&quot; }
]
</code></pre>
<p><strong>âŒ é¿å…</strong>ï¼š</p>
<pre><code class="language-typescript">// âŒ é€ä¸ªæ›´æ–°
for (const rowId of rowIds) {
  await PUT(`/doc/order/123/rows/${rowId}?requestId=req-1`, {...})
}
// æ€§èƒ½å·®ï¼Œäº§ç”Ÿå¤§é‡ç½‘ç»œè¯·æ±‚
</code></pre>
<h3>8.4 Request ç®¡ç†</h3>
<p><strong>âœ… æ¨è</strong>ï¼š</p>
<pre><code class="language-typescript">// ç›¸å…³çš„å˜æ›´æ”¾åœ¨åŒä¸€ä¸ª Request ä¸­
const requestId = &quot;req-1&quot;;

// 1. æ›´æ–°å¤šè¡Œ
await bulkUpdate(requestId, [...]);

// 2. æ›´æ–°å±æ€§
await updateProperties(requestId, {...});

// 3. ä¸€æ¬¡æ€§åˆå¹¶
await mergeRequest(requestId);
</code></pre>
<p><strong>âŒ é¿å…</strong>ï¼š</p>
<pre><code class="language-typescript">// âŒ ä¸ºæ¯ä¸ªæ“ä½œåˆ›å»ºå•ç‹¬çš„ Request
const req1 = await createRequest();  // æ›´æ–°è¡Œ1
const req2 = await createRequest();  // æ›´æ–°è¡Œ2
const req3 = await createRequest();  // æ›´æ–°å±æ€§

// äº§ç”Ÿè¿‡å¤šçš„ Revisionï¼Œéš¾ä»¥è¿½æº¯
</code></pre>
<h3>8.5 è¯„è®ºä½¿ç”¨</h3>
<p><strong>âœ… æ¨è</strong>ï¼š</p>
<pre><code class="language-typescript">// ç²¾ç¡®å®šä½åˆ°é—®é¢˜ä½ç½®
{
  &quot;content&quot;: &quot;è¿™ä¸ªå•ä»·éœ€è¦ç¡®è®¤&quot;,
  &quot;target&quot;: {
    &quot;scope&quot;: &quot;cell&quot;,
    &quot;rowId&quot;: &quot;row-1&quot;,
    &quot;fieldId&quot;: &quot;price&quot;
  }
}

// ä½¿ç”¨ @æåŠ
{
  &quot;content&quot;: &quot;@manager è¯·å®¡æ ¸è¿™ä¸ªè®¢å•&quot;,
  &quot;mentions&quot;: [&quot;manager-1&quot;],
  &quot;target&quot;: { &quot;scope&quot;: &quot;document&quot; }
}

// åŠæ—¶æ ‡è®°å·²è§£å†³
POST /doc/order/123/comments/comment-1/resolve
</code></pre>
<p><strong>âŒ é¿å…</strong>ï¼š</p>
<pre><code class="language-typescript">// âŒ åœ¨è¯„è®ºä¸­å­˜å‚¨ç»“æ„åŒ–æ•°æ®
{
  &quot;content&quot;: &quot;æ›´æ–°åçš„æ•°æ®ï¼š{productName: &#39;iPhone&#39;, price: 999}&quot;
}
// åº”è¯¥ç›´æ¥ä¿®æ”¹æ•°æ®ï¼Œè¯„è®ºåªç”¨äºè®¨è®º

// âŒ è¿‡åº¦è¯„è®º
// æ¯ä¸ªå°ä¿®æ”¹éƒ½è¯„è®ºï¼Œå¯¼è‡´å™ªéŸ³è¿‡å¤š
// åº”è¯¥åˆå¹¶ç›¸å…³è®¨è®ºï¼Œé—®é¢˜è§£å†³åæ¸…ç†
</code></pre>
<h3>8.6 æ€§èƒ½ä¼˜åŒ–</h3>
<p><strong>1. åˆ†é¡µæŸ¥è¯¢</strong>ï¼š</p>
<pre><code class="language-typescript">// âœ… ä½¿ç”¨åˆ†é¡µ
GET /doc/order/123/rows?page=1&amp;pageSize=100

// âŒ ä¸€æ¬¡æ€§è·å–æ‰€æœ‰æ•°æ®
GET /doc/order/123/rows?pageSize=10000
</code></pre>
<p><strong>2. é€‰æ‹©æ€§æŸ¥è¯¢</strong>ï¼š</p>
<pre><code class="language-typescript">// âœ… åªè·å–éœ€è¦çš„éƒ¨åˆ†
GET /doc/order/123?include=properties,metadata

// âŒ è·å–æ•´ä¸ªæ–‡æ¡£
GET /doc/order/123?include=properties,metadata,data,comments,revisions
</code></pre>
<p><strong>3. ç¼“å­˜ç­–ç•¥</strong>ï¼š</p>
<pre><code class="language-typescript">// Metadata å’Œ Settings å˜åŒ–å°‘ï¼Œå¯ä»¥é•¿æœŸç¼“å­˜
const metadata = await cache.get(`metadata:${docType}:${docId}`, async () =&gt; {
  return await fetchMetadata(docType, docId);
}, { ttl: 3600 });

// Data å˜åŒ–é¢‘ç¹ï¼ŒçŸ­æœŸç¼“å­˜æˆ–ä¸ç¼“å­˜
const rows = await fetchRows(docType, docId);

// Revisions ä¸å¯å˜ï¼Œå¯ä»¥æ°¸ä¹…ç¼“å­˜
const revision = await cache.get(`revision:${revId}`, async () =&gt; {
  return await fetchRevision(revId);
}, { ttl: Infinity });
</code></pre>
<h3>8.7 å®‰å…¨å®è·µ</h3>
<p><strong>1. æƒé™æ£€æŸ¥</strong>ï¼š</p>
<pre><code class="language-typescript">// åœ¨æ¯ä¸ªæ“ä½œå‰æ£€æŸ¥æƒé™
if (!hasPermission(user, doc, &#39;write&#39;)) {
  throw new ForbiddenError();
}
</code></pre>
<p><strong>2. è¾“å…¥éªŒè¯</strong>ï¼š</p>
<pre><code class="language-typescript">// æœåŠ¡ç«¯ä¸¥æ ¼éªŒè¯
- å­—æ®µç±»å‹æ˜¯å¦åŒ¹é… Metadata
- å¿…å¡«å­—æ®µæ˜¯å¦å­˜åœ¨
- éªŒè¯è§„åˆ™æ˜¯å¦é€šè¿‡
- å…³è”å…³ç³»æ˜¯å¦æœ‰æ•ˆ
</code></pre>
<p><strong>3. å®¡è®¡æ—¥å¿—</strong>ï¼š</p>
<pre><code class="language-typescript">// æ‰€æœ‰æ•æ„Ÿæ“ä½œè®°å½•å®¡è®¡æ—¥å¿—
await auditLog({
  action: &#39;document.delete&#39;,
  userId: currentUser.id,
  docType,
  docId,
  metadata: { reason: &#39;cleanup&#39; }
});
</code></pre>
<h3>8.8 é”™è¯¯å¤„ç†</h3>
<p><strong>âœ… æ¨è</strong>ï¼š</p>
<pre><code class="language-typescript">try {
  await updateRow(docType, docId, rowId, data, requestId);
} catch (error) {
  if (error.code === &#39;VERSION_CONFLICT&#39;) {
    // ç‰ˆæœ¬å†²çªï¼Œæç¤ºç”¨æˆ·åˆ·æ–°
    await refreshData();
    showMessage(&#39;æ•°æ®å·²è¢«å…¶ä»–ç”¨æˆ·ä¿®æ”¹ï¼Œè¯·é‡æ–°ç¼–è¾‘&#39;);
  } else if (error.code === &#39;FIELD_TYPE_MISMATCH&#39;) {
    // ç±»å‹ä¸åŒ¹é…ï¼Œæ˜¾ç¤ºå…·ä½“é”™è¯¯
    showValidationError(error.payload.field, error.message);
  } else {
    // å…¶ä»–é”™è¯¯
    showError(&#39;æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•&#39;);
  }
}
</code></pre>
<hr>
<h2>9. æ€»ç»“</h2>
<h3>9.1 æ ¸å¿ƒä»·å€¼</h3>
<p>NexusBook æ–‡æ¡£æ¨¡å‹é€šè¿‡<strong>ä¸ƒå±‚æ¶æ„</strong>æä¾›äº†ï¼š</p>
<ol>
<li><strong>Properties</strong> - æ–‡æ¡£çº§å…ƒä¿¡æ¯ï¼Œæ¸…æ™°åˆ†ç¦»æ–‡æ¡£å±æ€§å’Œæ•°æ®å†…å®¹</li>
<li><strong>Metadata</strong> - å…ƒæ•°æ®é©±åŠ¨ï¼Œ25+ ç§å­—æ®µç±»å‹ï¼Œæ”¯æŒè®¡ç®—å­—æ®µå’ŒéªŒè¯è§„åˆ™</li>
<li><strong>Data</strong> - ç»“æ„åŒ–æ•°æ®è¡Œï¼Œæ”¯æŒçµæ´»æŸ¥è¯¢å’Œæ‰¹é‡æ“ä½œ</li>
<li><strong>Views</strong> - 8 ç§è§†å›¾ç±»å‹ï¼ŒåŒä¸€æ•°æ®å¤šç§å±•ç¤ºæ–¹å¼</li>
<li><strong>Comments</strong> - å››çº§ç²¾ç¡®å®šä½ï¼Œå®Œæ•´çš„åä½œè®¨è®ºèƒ½åŠ›</li>
<li><strong>Requests</strong> - ç±» Git çš„å˜æ›´å·¥ä½œæµï¼Œæ”¯æŒå¤šäººååŒå’Œå®¡æ‰¹</li>
<li><strong>Revisions</strong> - ä¸å¯å˜å†å²ï¼Œå®Œæ•´çš„å˜æ›´è¿½è¸ªå’Œå®¡è®¡èƒ½åŠ›</li>
</ol>
<h3>9.2 è®¾è®¡ä¼˜åŠ¿</h3>
<p>âœ… <strong>ä¸€æ¬¡å¼€å‘ï¼Œæ— é™å¤ç”¨</strong> - åŒä¸€å¥—æ¨¡å‹æ”¯æŒè®¢å•ã€å‘ç¥¨ã€åº“å­˜ç­‰æ‰€æœ‰æ–‡æ¡£ç±»å‹</p>
<p>âœ… <strong>å¼€ç®±å³ç”¨çš„åä½œ</strong> - è¯„è®ºã€@æåŠã€è®¨è®ºçº¿ç¨‹ã€è¡¨æƒ…ååº”</p>
<p>âœ… <strong>Git çº§åˆ«çš„ç‰ˆæœ¬æ§åˆ¶</strong> - Request â†’ Revision æœºåˆ¶ç¡®ä¿æ•°æ®å®‰å…¨å’Œå¯è¿½æº¯</p>
<p>âœ… <strong>çµæ´»çš„å®¡æ‰¹æµç¨‹</strong> - ä¸²ç­¾ã€å¹¶ç­¾ã€æ¡ä»¶å®¡æ‰¹ï¼Œæ»¡è¶³å„ç§å®¡æ‰¹éœ€æ±‚</p>
<p>âœ… <strong>å¼ºå¤§çš„æŸ¥è¯¢èƒ½åŠ›</strong> - è¿‡æ»¤ã€æ’åºã€åˆ†ç»„ã€èšåˆï¼Œæ”¯æŒå¤æ‚ä¸šåŠ¡æŸ¥è¯¢</p>
<p>âœ… <strong>å…³ç³»æ˜¯ä¸€ç­‰å…¬æ°‘</strong> - è·¨æ–‡æ¡£å…³è”ã€é™„ä»¶ç®¡ç†ã€æ•°æ®åŒæ­¥</p>

                </article>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>&copy; 2024 NexusBook. åŸºäº TypeSpec å®šä¹‰å¹¶ç”Ÿæˆ OpenAPI 3.0 è§„èŒƒã€‚</p>
            </div>
        </footer>
    </div>
</body>
</html>