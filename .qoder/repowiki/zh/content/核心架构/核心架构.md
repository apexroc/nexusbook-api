# æ ¸å¿ƒæ¶æ„

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [api/main.tsp](file://api/main.tsp)
- [api/shared/index.tsp](file://api/shared/index.tsp)
- [api/shared/common.tsp](file://api/shared/common.tsp)
- [api/shared/constants.tsp](file://api/shared/constants.tsp)
- [api/auth/index.tsp](file://api/auth/index.tsp)
- [api/document/index.tsp](file://api/document/index.tsp)
- [api/document/core/index.tsp](file://api/document/core/index.tsp)
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp)
- [api/document/core/data.tsp](file://api/document/core/data.tsp)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp)
- [api/document/content/comments.tsp](file://api/document/content/comments.tsp)
- [api/document/workflow/approvals.tsp](file://api/document/workflow/approvals.tsp)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp)
- [api/extensions/index.tsp](file://api/extensions/index.tsp)
- [api/extensions/webhooks/index.tsp](file://api/extensions/webhooks/index.tsp)
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md)
- [api/tenant/models.tsp](file://api/tenant/models.tsp)
- [api/tenant/organizations.tsp](file://api/tenant/organizations.tsp)
- [api/tenant/workspaces.tsp](file://api/tenant/workspaces.tsp)
- [api/tenant/invitations.tsp](file://api/tenant/invitations.tsp)
</cite>

## æ›´æ–°æ‘˜è¦
**å˜æ›´å†…å®¹**
- æ›´æ–°äº†â€œå¼•è¨€â€ã€â€œé¡¹ç›®ç»“æ„â€å’Œâ€œæ ¸å¿ƒç»„ä»¶â€éƒ¨åˆ†ï¼Œä»¥åæ˜ å¤šç§Ÿæˆ·æ•°æ®æ¨¡å‹çš„æœ€æ–°è®¾è®¡ã€‚
- æ–°å¢äº†â€œå¤šç§Ÿæˆ·æ¶æ„â€ã€â€œç»„ç»‡ä¸å·¥ä½œåŒºâ€ã€â€œæ•°æ®æºå¼•ç”¨â€å’Œâ€œæƒé™çŸ©é˜µâ€å››ä¸ªç« èŠ‚ï¼Œè¯¦ç»†æè¿°äº† Organizationã€Workspaceã€DataSourceReference æ¨¡å‹ä»¥åŠåŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ã€‚
- æ›´æ–°äº†â€œæ¶æ„æ€»è§ˆâ€ä¸­çš„ Mermaid å›¾ï¼Œä»¥åŒ…å«æ–°çš„ç§Ÿæˆ·ç®¡ç†æ¨¡å—ã€‚
- æ›´æ–°äº†â€œè¯¦ç»†ç»„ä»¶åˆ†æâ€ä¸­çš„â€œç§Ÿæˆ·æ–‡æ¡£â€éƒ¨åˆ†ï¼Œä»¥åŒ¹é…æ–°çš„ API è·¯ç”±å’ŒåŠŸèƒ½ã€‚
- æ›´æ–°äº†â€œä¾èµ–åˆ†æâ€ä»¥åŒ…å«æ–°çš„ç§Ÿæˆ·ç®¡ç†æ¨¡å—ã€‚

## ç›®å½•
1. [å¼•è¨€](#å¼•è¨€)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
5. [è¯¦ç»†ç»„ä»¶åˆ†æ](#è¯¦ç»†ç»„ä»¶åˆ†æ)
6. [ä¾èµ–åˆ†æ](#ä¾èµ–åˆ†æ)
7. [æ€§èƒ½è€ƒè™‘](#æ€§èƒ½è€ƒè™‘)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## å¼•è¨€
æœ¬æ¶æ„æ–‡æ¡£èšç„¦ nexusbook-api çš„åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œå›´ç»•é¡¶å±‚å…¥å£ï¼ˆmain.tspï¼‰ã€åŸºç¡€å±‚ï¼ˆshared æ¨¡å—ï¼‰ã€è®¤è¯å±‚ï¼ˆauth æ¨¡å—ï¼‰ã€ä¸šåŠ¡å±‚ï¼ˆdocument æ¨¡å—ï¼‰ä¸æ‰©å±•å±‚ï¼ˆextensions æ¨¡å—ï¼‰å±•å¼€ã€‚æ–‡æ¡£å¼ºè°ƒå•å‘ä¾èµ–åŸåˆ™ï¼ˆä¸Šå±‚ä¾èµ–ä¸‹å±‚ï¼Œä¸”æ‰€æœ‰æ¨¡å—å‡ä¾èµ– shared åŸºç¡€å±‚ï¼‰ï¼Œå¹¶é˜è¿°æ¨¡å—åŒ–ä¸å•ä¸€èŒè´£åŸåˆ™ï¼Œè§£é‡Š Provider æ¨¡å¼å¦‚ä½•é€šè¿‡ {doc-type}/{doc-id} è·¯ç”±æ‰©å±•æ–°çš„æ–‡æ¡£ç±»å‹ï¼Œæœ€åç»“åˆ architecture.md ä¸­çš„ Mermaid å›¾ï¼Œç³»ç»ŸåŒ–è¯´æ˜ç»„ä»¶å…³ç³»ä¸æ•°æ®æµã€‚**æœ¬æ¬¡æ›´æ–°é‡ç‚¹åæ˜ å¤šç§Ÿæˆ·æ•°æ®æ¨¡å‹çš„æœ€æ–°è®¾è®¡ï¼ŒåŒ…æ‹¬ Organization å’Œ Workspace æ¦‚å¿µã€DataSourceReference æ¨¡å‹ä»¥åŠåŸºäºè§’è‰²çš„æƒé™çŸ©é˜µã€‚**

## é¡¹ç›®ç»“æ„
- é¡¶å±‚å…¥å£ï¼šapi/main.tsp å¯¼å…¥å¹¶ç»„ç»‡å„å­æ¨¡å—ï¼Œå®šä¹‰æœåŠ¡ä¸æœåŠ¡å™¨é…ç½®ã€‚
- åŸºç¡€å±‚ï¼šapi/shared/ æä¾›é€šç”¨ç±»å‹ã€é”™è¯¯ç ã€æŸ¥è¯¢ä¸è¿‡æ»¤æ¨¡å‹ã€æšä¸¾å¸¸é‡ç­‰ã€‚
- è®¤è¯å±‚ï¼šapi/auth/ æä¾› OAuth2/OIDCã€ç”¨æˆ·æ³¨å†Œ/ç™»å½•ã€API Key ç®¡ç†ç­‰ã€‚
- ä¸šåŠ¡å±‚ï¼šapi/document/ æä¾›æ–‡æ¡£æ ¸å¿ƒæ•°æ®ï¼ˆcoreï¼‰ã€å†…å®¹åä½œï¼ˆcontentï¼‰ã€å·¥ä½œæµï¼ˆworkflowï¼‰ã€èšåˆæŸ¥è¯¢ï¼ˆaggregateï¼‰ã€ç§Ÿæˆ·æ–‡æ¡£ï¼ˆtenant-documentï¼‰ç­‰ã€‚
- æ‰©å±•å±‚ï¼šapi/extensions/ æä¾› Webhooks ç­‰æ‰©å±•èƒ½åŠ›ï¼ˆé¢„ç•™é›†æˆï¼‰ã€‚
- **ç§Ÿæˆ·ç®¡ç†å±‚**ï¼šapi/tenant/ æä¾›ç”¨æˆ·ã€ç»„ç»‡ã€å·¥ä½œåŒºã€é‚€è¯·ä¸åŠ å…¥ç”³è¯·çš„ç®¡ç†åŠŸèƒ½ï¼Œæ˜¯å¤šç§Ÿæˆ·æ¶æ„çš„æ ¸å¿ƒã€‚

```mermaid
graph TB
subgraph "é¡¶å±‚"
MAIN["api/main.tsp"]
end
subgraph "åŸºç¡€å±‚"
SHARED["api/shared/"]
COMMON["common.tsp"]
CONST["constants.tsp"]
SHARED --> COMMON
SHARED --> CONST
end
subgraph "è®¤è¯å±‚"
AUTH["api/auth/"]
AUTHMODELS["models.tsp"]
AUTH --> AUTHMODELS
end
subgraph "ä¸šåŠ¡å±‚"
DOC["api/document/"]
CORE["core/"]
CONTENT["content/"]
WORKFLOW["workflow/"]
AGG["aggregate/"]
TENANT["tenant-document.tsp"]
DOC --> CORE
DOC --> CONTENT
DOC --> WORKFLOW
DOC --> AGG
DOC --> TENANT
end
subgraph "æ‰©å±•å±‚"
EXT["api/extensions/"]
WEBHOOKS["webhooks/"]
EXT --> WEBHOOKS
end
subgraph "ç§Ÿæˆ·ç®¡ç†å±‚"
TENANT_API["api/tenant/"]
ORG["organizations.tsp"]
WS["workspaces.tsp"]
INV["invitations.tsp"]
USER["users.tsp"]
MODELS["models.tsp"]
TENANT_API --> ORG
TENANT_API --> WS
TENANT_API --> INV
TENANT_API --> USER
TENANT_API --> MODELS
end
MAIN --> SHARED
MAIN --> AUTH
MAIN --> DOC
MAIN --> EXT
MAIN --> TENANT_API
AUTH --> SHARED
DOC --> SHARED
EXT --> SHARED
TENANT_API --> SHARED
CORE --> SHARED
CONTENT --> SHARED
WORKFLOW --> SHARED
AGG --> SHARED
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L121-L219)
- [api/main.tsp](file://api/main.tsp#L1-L20)
- [api/shared/index.tsp](file://api/shared/index.tsp#L1-L16)
- [api/auth/index.tsp](file://api/auth/index.tsp#L1-L37)
- [api/document/index.tsp](file://api/document/index.tsp#L1-L31)
- [api/extensions/index.tsp](file://api/extensions/index.tsp#L1-L13)
- [api/tenant/organizations.tsp](file://api/tenant/organizations.tsp#L1-L498)
- [api/tenant/workspaces.tsp](file://api/tenant/workspaces.tsp#L1-L649)
- [api/tenant/invitations.tsp](file://api/tenant/invitations.tsp#L1-L548)

ç« èŠ‚æ¥æº
- [api/main.tsp](file://api/main.tsp#L1-L20)
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L78-L118)

## æ ¸å¿ƒç»„ä»¶
- shared åŸºç¡€å±‚ï¼šæä¾›é€šç”¨å“åº”ç»“æ„ã€åˆ†é¡µæ¨¡å‹ã€é”™è¯¯ç ã€æŸ¥è¯¢è¿‡æ»¤æ¨¡å‹ã€èšåˆå‡½æ•°ã€å€¼ç±»å‹ä¸é™„ä»¶ç­‰ï¼Œç¡®ä¿å„æ¨¡å—çš„ä¸€è‡´æ€§ä¸å¤ç”¨æ€§ã€‚
- auth è®¤è¯å±‚ï¼šæä¾› OAuth2/OIDCã€ç”¨æˆ·æ³¨å†Œ/ç™»å½•ã€API Key ç®¡ç†ç­‰èƒ½åŠ›ï¼Œæ”¯æ’‘ä¸šåŠ¡å±‚çš„å®‰å…¨è®¿é—®ã€‚
- document ä¸šåŠ¡å±‚ï¼š
  - coreï¼šå…ƒæ•°æ®ï¼ˆå­—æ®µå®šä¹‰ã€è®¡ç®—/æ ¡éªŒï¼‰ã€æ•°æ®è¡Œï¼ˆç»“æ„åŒ–è¡Œã€æ‰¹é‡æ›´æ–°ã€ç‰ˆæœ¬æ§åˆ¶ï¼‰ã€å±æ€§ï¼ˆæ–‡æ¡£çº§å…ƒä¿¡æ¯ï¼‰ã€è§†å›¾ï¼ˆå¤šè§†å›¾é…ç½®ï¼‰ã€è®¾ç½®ï¼ˆæ–‡æ¡£/ç±»å‹çº§é…ç½®ï¼‰ã€‚
  - contentï¼šè¯„è®ºç³»ç»Ÿï¼ˆç»Ÿä¸€è¯„è®ºæ¨¡å‹ã€å›å¤æ ‘ã€é™„ä»¶ã€è¡¨æƒ…ååº”ã€ç½®é¡¶ä¸è§£å†³æ ‡è®°ï¼‰ã€‚
  - workflowï¼šå®¡æ‰¹æµç¨‹ï¼ˆçŠ¶æ€æœºã€å†å²è®°å½•ã€å†³ç­–ï¼‰ã€å˜æ›´è¯·æ±‚ä¸ä¿®è®¢å†å²ã€‚
  - aggregateï¼šèšåˆæŸ¥è¯¢æ¥å£ï¼Œæ”¯æŒä¸€æ¬¡æ€§è·å– properties/metadata/views/data/comments/revisions/settingsï¼Œå¹¶æŒ‰éœ€ includeã€‚
  - tenant-documentï¼šç»„ç»‡çº§ä¸å·¥ä½œåŒºçº§æ–‡æ¡£çš„èšåˆæ¥å£ä¸æ–‡æ¡£æ‘˜è¦æ¨¡å‹ã€‚
- extensions æ‰©å±•å±‚ï¼šWebhooks ç­‰æ‰©å±•èƒ½åŠ›ï¼Œé¢„ç•™é›†æˆã€‚
- **tenant ç§Ÿæˆ·ç®¡ç†å±‚**ï¼šæä¾›ç”¨æˆ·ã€ç»„ç»‡ã€å·¥ä½œåŒºã€é‚€è¯·ä¸åŠ å…¥ç”³è¯·çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ˜¯å®ç°å¤šç§Ÿæˆ· SaaS æ¶æ„çš„æ ¸å¿ƒã€‚

ç« èŠ‚æ¥æº
- [api/shared/common.tsp](file://api/shared/common.tsp#L1-L200)
- [api/shared/constants.tsp](file://api/shared/constants.tsp#L1-L120)
- [api/auth/index.tsp](file://api/auth/index.tsp#L1-L37)
- [api/document/core/index.tsp](file://api/document/core/index.tsp#L1-L21)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L1-L127)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L1-L120)
- [api/extensions/webhooks/index.tsp](file://api/extensions/webhooks/index.tsp#L1-L15)
- [api/tenant/models.tsp](file://api/tenant/models.tsp#L1-L996)
- [api/tenant/organizations.tsp](file://api/tenant/organizations.tsp#L1-L498)
- [api/tenant/workspaces.tsp](file://api/tenant/workspaces.tsp#L1-L649)

## æ¶æ„æ€»è§ˆ
ä¸‹å›¾å±•ç¤ºäº†æ¨¡å—é—´çš„ä¾èµ–å…³ç³»ä¸åˆ†å±‚ç»“æ„ï¼Œä½“ç°â€œå•å‘ä¾èµ–â€ä¸â€œåŸºç¡€ä¼˜å…ˆâ€çš„åŸåˆ™ã€‚æ–°å¢çš„ `api/tenant/` æ¨¡å—æ˜¯å®ç°å¤šç§Ÿæˆ·åŠŸèƒ½çš„æ ¸å¿ƒï¼Œæ‰€æœ‰ä¸ç”¨æˆ·ã€ç»„ç»‡ã€å·¥ä½œåŒºç›¸å…³çš„æ“ä½œéƒ½é€šè¿‡æ­¤æ¨¡å—è¿›è¡Œã€‚

```mermaid
graph TB
MAIN["api/main.tsp"]
SHARED["api/shared/"]
AUTH["api/auth/"]
DOC["api/document/"]
CORE["core/"]
CONTENT["content/"]
WORKFLOW["workflow/"]
AGG["aggregate/"]
EXT["api/extensions/"]
TENANT_API["api/tenant/"]
ORG["organizations.tsp"]
WS["workspaces.tsp"]
INV["invitations.tsp"]
USER["users.tsp"]
MODELS["models.tsp"]
MAIN --> SHARED
MAIN --> AUTH
MAIN --> DOC
MAIN --> EXT
MAIN --> TENANT_API
AUTH --> SHARED
DOC --> SHARED
EXT --> SHARED
TENANT_API --> SHARED
DOC --> CORE
DOC --> CONTENT
DOC --> WORKFLOW
DOC --> AGG
CORE --> SHARED
CONTENT --> SHARED
WORKFLOW --> SHARED
AGG --> SHARED
TENANT_API --> ORG
TENANT_API --> WS
TENANT_API --> INV
TENANT_API --> USER
TENANT_API --> MODELS
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L215-L219)
- [api/main.tsp](file://api/main.tsp#L1-L20)
- [api/document/index.tsp](file://api/document/index.tsp#L1-L31)
- [api/tenant/organizations.tsp](file://api/tenant/organizations.tsp#L1-L498)
- [api/tenant/workspaces.tsp](file://api/tenant/workspaces.tsp#L1-L649)

## è¯¦ç»†ç»„ä»¶åˆ†æ

### å¤šç§Ÿæˆ·æ¶æ„
NexusBook é‡‡ç”¨å¤šç§Ÿæˆ· SaaS æ¶æ„ï¼Œé€šè¿‡ **Organizationï¼ˆç»„ç»‡ï¼‰** å’Œ **Workspaceï¼ˆå·¥ä½œåŒºï¼‰** å®ç°æ•°æ®éš”ç¦»å’Œæƒé™ç®¡ç†ã€‚ä¸€ä¸ª **Userï¼ˆç”¨æˆ·ï¼‰** å¯ä»¥æ˜¯å¤šä¸ª Organization çš„æˆå‘˜ï¼Œè€Œæ¯ä¸ª Organization å†…å¯ä»¥åˆ›å»ºå¤šä¸ªåœ°ä½å¹³ç­‰çš„ Workspaceã€‚é€šè¿‡ **æ•°æ®æºå¼•ç”¨ï¼ˆData Source Referenceï¼‰** æœºåˆ¶ï¼ŒWorkspace å¯ä»¥é€‰æ‹©æ€§åœ°å¼•ç”¨å…¶ä»– Workspace çš„ç‰¹å®šæ•°æ®ã€‚

```mermaid
graph TB
subgraph "å¤šç§Ÿæˆ·æ¶æ„ Multi-Tenant Architecture"
User["ğŸ‘¤ ç”¨æˆ·<br/>ç‹¬ç«‹å®ä½“"]
subgraph "Organization ç»„ç»‡ç§Ÿæˆ·"
Org["ğŸ¢ Organization<br/>ç»„ç»‡/ç§Ÿæˆ·<br/><small>æ•°æ®éš”ç¦»è¾¹ç•Œ</small>"]
OrgMember["ğŸ‘¥ ç»„ç»‡æˆå‘˜<br/><small>owner/admin/member/guest</small>"]
subgraph "å·¥ä½œåŒº Workspaces"
WS1["ğŸ“š ä¸»æ•°æ®ä¸­å¿ƒ<br/>Workspace A<br/><small>åŒ…å« product, supplier</small>"]
WS2["ğŸœ æœé˜³é¤å…<br/>Workspace B<br/><small>å¼•ç”¨ A çš„ product</small>"]
WS3["ğŸ›ï¸ æµ·æ·€è¶…å¸‚<br/>Workspace C<br/><small>å¼•ç”¨ A çš„ product, supplier</small>"]
WS4["ğŸšš ç»¿æºä¾›åº”å•†<br/>Workspace D<br/><small>ç‹¬ç«‹æ•°æ®</small>"]
end
WSMember["ğŸ‘¥ å·¥ä½œåŒºæˆå‘˜<br/><small>owner/editor/viewer</small>"]
Invite["âœ‰ï¸ é‚€è¯·æœºåˆ¶<br/><small>é‚®ç®±é‚€è¯·</small>"]
JoinReq["ğŸ“ åŠ å…¥ç”³è¯·<br/><small>ç”¨æˆ·ä¸»åŠ¨ç”³è¯·</small>"]
end
subgraph "æ•°æ®å…±äº«å…³ç³» Data Sharing"
Ref1["ğŸ”— B å¼•ç”¨ A.product<br/><small>readonly</small>"]
Ref2["ğŸ”— C å¼•ç”¨ A.product<br/><small>readonly</small>"]
Ref3["ğŸ”— C å¼•ç”¨ A.supplier<br/><small>readonly</small>"]
end
end
User --> |æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»º| Org
User --> |owner| Org
User --> |åŠ å…¥| OrgMember
Org --> |åŒ…å«| WS1
Org --> |åŒ…å«| WS2
Org --> |åŒ…å«| WS3
Org --> |åŒ…å«| WS4
Org --> |åˆ›å»ºæ—¶è‡ªåŠ¨åˆ›å»º| WS1
OrgMember --> |éœ€æ˜¾å¼åŠ å…¥| WSMember
Org --> |é‚€è¯·ç”¨æˆ·| Invite
Org --> |æ¥å—ç”³è¯·| JoinReq
WS2 -.->|æ•°æ®æºå¼•ç”¨| Ref1
WS3 -.->|æ•°æ®æºå¼•ç”¨| Ref2
WS3 -.->|æ•°æ®æºå¼•ç”¨| Ref3
Ref1 --> WS1
Ref2 --> WS1
Ref3 --> WS1
style Org fill:#e1f5ff
style WS1 fill:#d4edda
style WS2 fill:#fff4e6
style WS3 fill:#fff4e6
style WS4 fill:#fff4e6
style User fill:#f0f0f0
style Ref1 fill:#ffeaa7
style Ref2 fill:#ffeaa7
style Ref3 fill:#ffeaa7
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L82-L143)

### ç»„ç»‡ä¸å·¥ä½œåŒº
#### 1. Userï¼ˆç”¨æˆ·ï¼‰- ç‹¬ç«‹èº«ä»½å®ä½“
- **ç‹¬ç«‹æ€§**ï¼šç”¨æˆ·æ˜¯ç³»ç»Ÿä¸­çš„ç‹¬ç«‹å®ä½“ï¼Œä¸ä¾é™„äºä»»ä½•ç»„ç»‡ã€‚
- **è‡ªåŠ¨ç»„ç»‡**ï¼šç”¨æˆ·æ³¨å†Œæ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª Personal ç±»å‹çš„ Organizationï¼Œç”¨æˆ·æˆä¸ºè¯¥ç»„ç»‡çš„ ownerã€‚
- **å¤šç»„ç»‡æˆå‘˜**ï¼šä¸€ä¸ªç”¨æˆ·å¯ä»¥åŒæ—¶æ˜¯å¤šä¸ª Organization çš„æˆå‘˜ã€‚
- **èº«ä»½éªŒè¯**ï¼šæ”¯æŒé‚®ç®±/å¯†ç ã€OAuth ç¬¬ä¸‰æ–¹ç™»å½•ï¼ˆGoogleã€GitHubã€å¾®ä¿¡ã€é’‰é’‰ã€é£ä¹¦ï¼‰ã€‚

#### 2. Organizationï¼ˆç»„ç»‡ï¼‰- ç§Ÿæˆ·è¾¹ç•Œ
- **ç§Ÿæˆ·éš”ç¦»**ï¼šOrganization æ˜¯æ•°æ®éš”ç¦»çš„åŸºæœ¬å•å…ƒï¼Œç±»ä¼¼ Miro çš„ Teamã€‚
- **ç»„ç»‡ç±»å‹**ï¼š
  - `personal`ï¼šä¸ªäººç»„ç»‡ï¼ˆç”¨æˆ·æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚
  - `team`ï¼šå›¢é˜Ÿç»„ç»‡ã€‚
  - `enterprise`ï¼šä¼ä¸šç»„ç»‡ã€‚
- **æˆå‘˜è§’è‰²**ï¼š
  - `owner`ï¼šç»„ç»‡æ‹¥æœ‰è€…ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ï¼ˆåŒ…æ‹¬åˆ é™¤ç»„ç»‡ã€è½¬è®©æ‰€æœ‰æƒï¼‰ã€‚
  - `admin`ï¼šç®¡ç†å‘˜ï¼Œå¯ç®¡ç†æˆå‘˜ã€å·¥ä½œåŒºã€ç»„ç»‡è®¾ç½®ã€‚
  - `member`ï¼šæ™®é€šæˆå‘˜ï¼Œå¯è®¿é—®è¢«æˆæƒçš„å·¥ä½œåŒºã€‚
  - `guest`ï¼šè®¿å®¢ï¼Œä»…èƒ½è®¿é—®ç‰¹å®šèµ„æºã€‚
- **é»˜è®¤å·¥ä½œåŒº**ï¼šåˆ›å»ºç»„ç»‡æ—¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªé»˜è®¤ Workspaceï¼Œé€šå¸¸ä½œä¸ºä¸»æ•°æ®ä¸­å¿ƒä½¿ç”¨ã€‚

#### 3. Workspaceï¼ˆå·¥ä½œåŒºï¼‰- ä¸šåŠ¡å®¹å™¨
- **æ•°æ®éš”ç¦»**ï¼šæ¯ä¸ª Workspace çš„ Document æ•°æ®é»˜è®¤ç‹¬ç«‹éš”ç¦»ã€‚
- **çµæ´»å…±äº«**ï¼šå¯é€‰æ‹©æ€§åœ°å¼•ç”¨å…¶ä»– Workspace çš„ç‰¹å®š document type æ•°æ®ã€‚
- **æ˜¾å¼åŠ å…¥**ï¼šç»„ç»‡æˆå‘˜éœ€è¦è¢«æ˜¾å¼æ·»åŠ åˆ° Workspace æ‰èƒ½è®¿é—®å…¶ä¸­çš„å†…å®¹ã€‚
- **æˆå‘˜è§’è‰²**ï¼š
  - `owner`ï¼šå·¥ä½œåŒºè´Ÿè´£äººï¼Œå¯ç®¡ç†å·¥ä½œåŒºå’Œæˆå‘˜ã€‚
  - `editor`ï¼šç¼–è¾‘è€…ï¼Œå¯åˆ›å»ºå’Œç¼–è¾‘æ–‡æ¡£ã€‚
  - `viewer`ï¼šæŸ¥çœ‹è€…ï¼Œåªè¯»æƒé™ã€‚
- **å¯è§æ€§æ§åˆ¶**ï¼š
  - `public`ï¼šç»„ç»‡å†…æ‰€æœ‰æˆå‘˜å¯è§ï¼ˆå»ºè®®ä¸»æ•°æ®ä¸­å¿ƒä½¿ç”¨ï¼‰ã€‚
  - `private`ï¼šä»…æˆå‘˜å¯è§ï¼ˆå»ºè®®ä¸šåŠ¡å·¥ä½œåŒºä½¿ç”¨ï¼‰ã€‚

ç« èŠ‚æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L147-L187)
- [api/tenant/models.tsp](file://api/tenant/models.tsp#L219-L714)

### æ•°æ®æºå¼•ç”¨
#### 4. æ•°æ®æºå¼•ç”¨æœºåˆ¶ï¼ˆData Source Referenceï¼‰
- **æ›¿æ¢æ¨¡å¼**ï¼šWorkspace æ”¯æŒå¼•ç”¨å…¶ä»– Workspace çš„ç‰¹å®š document type æ•°æ®ã€‚å¼•ç”¨åï¼ŒæŸ¥è¯¢è¯¥ç±»å‹æ•°æ®æ—¶ï¼Œåªè¿”å›æº Workspace çš„æ•°æ®ï¼ˆåªè¯»ï¼‰ï¼Œæœ¬åœ°æ•°æ®è¢«éšè—ä½†æœªåˆ é™¤ã€‚è§£é™¤å¼•ç”¨åï¼Œæœ¬åœ°æ•°æ®æ¢å¤æ˜¾ç¤ºã€‚
- **æŸ¥è¯¢é€»è¾‘**ï¼š
  - æœ‰æ´»è·ƒå¼•ç”¨ï¼šæŸ¥è¯¢æº Workspace çš„æ•°æ®ï¼Œæ ‡è®°ä¸ºåªè¯»ã€‚
  - æ— å¼•ç”¨æˆ–å¼•ç”¨å·²åœç”¨ï¼šæŸ¥è¯¢æœ¬åœ°æ•°æ®ï¼Œå¯ç¼–è¾‘ã€‚

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant WS as "å·¥ä½œåŒºB"
participant SourceWS as "æºå·¥ä½œåŒºA"
Client->>WS : GET /doc/product
alt æœ‰æ´»è·ƒå¼•ç”¨
WS->>SourceWS : æŸ¥è¯¢ product æ•°æ®
SourceWS-->>WS : è¿”å›åªè¯»æ•°æ®
WS-->>Client : è¿”å›åªè¯»æ•°æ®
else æ— å¼•ç”¨
WS->>WS : æŸ¥è¯¢æœ¬åœ° product æ•°æ®
WS-->>Client : è¿”å›å¯ç¼–è¾‘æ•°æ®
end
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L189-L200)
- [api/tenant/models.tsp](file://api/tenant/models.tsp#L545-L576)

### æƒé™çŸ©é˜µ
#### 6. è§’è‰²æƒé™çŸ©é˜µ
**Organization è§’è‰²æƒé™**ï¼š
| æ“ä½œ | owner | admin | member | guest |
|------|-------|-------|--------|-------|
| æŸ¥çœ‹ç»„ç»‡ä¿¡æ¯ | âœ… | âœ… | âœ… | âœ… |
| æ›´æ–°ç»„ç»‡è®¾ç½® | âœ… | âœ… | âŒ | âŒ |
| åˆ é™¤ç»„ç»‡ | âœ… | âŒ | âŒ | âŒ |
| é‚€è¯·æˆå‘˜ | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†æˆå‘˜è§’è‰² | âœ… | âœ… | âŒ | âŒ |
| ç§»é™¤æˆå‘˜ | âœ… | âœ… | âŒ | âŒ |
| åˆ›å»ºå·¥ä½œåŒº | âœ… | âœ… | âŒ | âŒ |
| ç®¡ç†å·¥ä½œåŒº | âœ… | âœ… | âŒ | âŒ |

**Workspace è§’è‰²æƒé™**ï¼š
| æ“ä½œ | owner | editor | viewer |
|------|-------|--------|--------|
| æŸ¥çœ‹å·¥ä½œåŒº | âœ… | âœ… | âœ… |
| æŸ¥çœ‹æ–‡æ¡£ | âœ… | âœ… | âœ… |
| åˆ›å»ºæ–‡æ¡£ | âœ… | âœ… | âŒ |
| ç¼–è¾‘æ–‡æ¡£ | âœ… | âœ… | âŒ |
| åˆ é™¤æ–‡æ¡£ | âœ… | âœ… | âŒ |
| ç®¡ç†æˆå‘˜ | âœ… | âŒ | âŒ |
| å·¥ä½œåŒºè®¾ç½® | âœ… | âŒ | âŒ |

ç« èŠ‚æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L247-L271)
- [api/tenant/models.tsp](file://api/tenant/models.tsp#L396-L424)
- [api/tenant/models.tsp](file://api/tenant/models.tsp#L692-L714)

### Provider æ¨¡å¼ä¸ {doc-type}/{doc-id} è·¯ç”±
- è·¯ç”±å½¢æ€ï¼š/api/v1/doc/{doc-type}/{doc-id}ï¼Œé€šè¿‡ Provider è§£æ {doc-type}ï¼Œå°†è¯·æ±‚è·¯ç”±åˆ°å¯¹åº” Provider å®ç°ï¼Œä»è€Œæ‰©å±•æ–°çš„æ–‡æ¡£ç±»å‹ã€‚
- æ‰©å±•æ–¹å¼ï¼šæ–°å¢ Provider å³å¯æ¥å…¥æ–°ç±»å‹ï¼Œæ— éœ€ä¿®æ”¹ API å®šä¹‰ï¼›èšåˆæŸ¥è¯¢ä¸ç§Ÿæˆ·æ–‡æ¡£æ¥å£åŒæ ·éµå¾ªè¯¥æ¨¡å¼ï¼Œæ”¯æŒç»„ç»‡çº§ä¸å·¥ä½œåŒºçº§æ–‡æ¡£ã€‚

```mermaid
flowchart TD
A["è¯·æ±‚ /api/v1/doc/{doc-type}/{doc-id}"] --> B["Provider è§£æ doc-type"]
B --> C{"å­˜åœ¨å¯¹åº” Provider ?"}
C --> |æ˜¯| D["è°ƒç”¨å¯¹åº” Provider å®ç°"]
C --> |å¦| E["è¿”å›é”™è¯¯æœªçŸ¥æ–‡æ¡£ç±»å‹"]
D --> F["è¿”å›èšåˆæ•°æ®metadata/views/data/..."]
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L364-L383)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L92-L127)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L112-L191)

ç« èŠ‚æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L364-L383)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L92-L127)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L112-L191)

### èšåˆæŸ¥è¯¢ä¸ DocBundle
- èšåˆæ¥å£ï¼šä¸€æ¬¡æ€§è·å–æ–‡æ¡£çš„ properties/metadata/views/data/comments/revisions/settingsï¼Œæ”¯æŒ include é€‰æ‹©ã€åˆ†é¡µä¸é™åˆ¶æ•°é‡ã€‚
- DocBundleï¼šèšåˆè½½è·ï¼ŒæŒ‰éœ€åŒ…å«ä¸Šè¿°å„éƒ¨åˆ†ï¼Œä¾¿äºå‰ç«¯ä¸€æ¬¡æ€§æ¸²æŸ“ã€‚

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant API as "èšåˆæ¥å£"
participant Core as "æ ¸å¿ƒæ¨¡å—"
participant Content as "å†…å®¹æ¨¡å—"
participant WF as "å·¥ä½œæµæ¨¡å—"
Client->>API : GET /doc/{doc-type}/{doc-id}?include=...
API->>Core : è¯»å– metadata/properties/views/settings
API->>Core : è¯»å– dataåˆ†é¡µ
API->>Content : è¯»å– commentsé™åˆ¶æ•°é‡
API->>WF : è¯»å– revisionsé™åˆ¶æ•°é‡
API-->>Client : è¿”å› DocBundle
```

å›¾è¡¨æ¥æº
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L92-L127)
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L183-L200)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L199-L220)
- [api/document/content/comments.tsp](file://api/document/content/comments.tsp#L1-L120)
- [api/document/workflow/approvals.tsp](file://api/document/workflow/approvals.tsp#L1-L60)

ç« èŠ‚æ¥æº
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L1-L127)

### è®¤è¯ä¸æˆæƒï¼ˆAuthï¼‰
- åŠŸèƒ½è¦ç‚¹ï¼šOAuth2/OIDCã€ç”¨æˆ·æ³¨å†Œ/ç™»å½•ã€API Key ç®¡ç†ã€ä»¤ç‰Œç®¡ç†ä¸æƒé™æ§åˆ¶ã€‚
- ä¾èµ–å…³ç³»ï¼šauth ä¾èµ– sharedï¼Œæä¾›æ ‡å‡† OIDC å‘ç°ç«¯ç‚¹ä¸ä»¤ç‰Œç®¡ç†ã€‚

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant Auth as "è®¤è¯æœåŠ¡"
participant Shared as "å…±äº«ç±»å‹"
Client->>Auth : è·å–æˆæƒç /å®¢æˆ·ç«¯å‡­è¯
Auth->>Shared : ä½¿ç”¨é€šç”¨é”™è¯¯ç /å“åº”ç»“æ„
Auth-->>Client : è¿”å›è®¿é—®ä»¤ç‰Œ/åˆ·æ–°ä»¤ç‰Œ
```

å›¾è¡¨æ¥æº
- [api/auth/index.tsp](file://api/auth/index.tsp#L1-L37)
- [api/shared/common.tsp](file://api/shared/common.tsp#L153-L177)

ç« èŠ‚æ¥æº
- [api/auth/index.tsp](file://api/auth/index.tsp#L1-L37)
- [api/shared/common.tsp](file://api/shared/common.tsp#L153-L177)

### æ–‡æ¡£æ ¸å¿ƒï¼ˆCoreï¼‰
- å…ƒæ•°æ®ï¼ˆmetadataï¼‰ï¼šå­—æ®µå®šä¹‰ã€ç±»å‹ã€è®¡ç®—/æŸ¥æ‰¾/æ±‡æ€»ã€æ ¡éªŒè§„åˆ™ã€‚
- æ•°æ®è¡Œï¼ˆdataï¼‰ï¼šè¡Œç»“æ„ã€æ‰¹é‡æ›´æ–°ã€ç‰ˆæœ¬æ§åˆ¶ä¸å¹¶å‘æ§åˆ¶ã€‚
- å±æ€§ï¼ˆpropertiesï¼‰ï¼šæ–‡æ¡£çº§å…ƒä¿¡æ¯å­—æ®µå®šä¹‰ã€‚
- è§†å›¾ï¼ˆviewsï¼‰ï¼šå¤šè§†å›¾é…ç½®ã€‚
- è®¾ç½®ï¼ˆsettingsï¼‰ï¼šæ–‡æ¡£/ç±»å‹çº§é…ç½®ã€‚

```mermaid
classDiagram
class Metadata {
+fields : Field[]
+properties? : Field[]
}
class Field {
+id : string
+name : string
+type : FieldType
+required? : boolean
+unique? : boolean
+readOnly? : boolean
+selectOptions? : SelectOption[]
+formula? : string
+lookup? : LookupConfig
+rollup? : RollupConfig
+validations? : Validation[]
}
class Row {
+id : string
+values : ValueEntry[]
+version : int32
+createdAt : string
+createdBy : UserRef
}
class BulkUpdate {
+target : any
+value : any
}
Metadata --> Field : "åŒ…å«"
Row --> ValueEntry : "åŒ…å«"
BulkUpdate --> Row : "ç”¨äºæ‰¹é‡æ›´æ–°"
```

å›¾è¡¨æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L1-L200)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L1-L200)
- [api/shared/common.tsp](file://api/shared/common.tsp#L544-L576)

ç« èŠ‚æ¥æº
- [api/document/core/metadata.tsp](file://api/document/core/metadata.tsp#L1-L200)
- [api/document/core/data.tsp](file://api/document/core/data.tsp#L1-L200)
- [api/shared/common.tsp](file://api/shared/common.tsp#L544-L576)

### å†…å®¹åä½œï¼ˆCommentsï¼‰
- ç»Ÿä¸€è¯„è®ºæ¨¡å‹ï¼šæ”¯æŒæ–‡æ¡£/å­—æ®µ/è¡Œ/å•å…ƒæ ¼å¤šå±‚çº§å®šä½ï¼Œå›å¤æ ‘ã€@æåŠã€é™„ä»¶ã€è¡¨æƒ…ååº”ã€ç½®é¡¶ä¸è§£å†³æ ‡è®°ã€‚
- ä½ç½®å®šä½å™¨ï¼šCommentTarget ç²¾ç¡®å®šä½è¯„è®ºæ‰€åœ¨ä½ç½®ã€‚

```mermaid
classDiagram
class CommentTarget {
+scope : string
+fieldId? : string
+rowId? : string
}
class Comment {
+id : string
+target : CommentTarget
+parentId? : string
+content : string
+mentions? : UserRef[]
+attachments? : Attachment[]
+reactions? : Reaction[]
+resolved? : boolean
+resolvedAt? : string
+resolvedBy? : UserRef
}
class Reaction {
+emoji : string
+users : UserRef[]
+count : int32
}
Comment --> CommentTarget : "å®šä½"
Comment --> Reaction : "åŒ…å«"
```

å›¾è¡¨æ¥æº
- [api/document/content/comments.tsp](file://api/document/content/comments.tsp#L1-L200)
- [api/shared/common.tsp](file://api/shared/common.tsp#L359-L449)

ç« èŠ‚æ¥æº
- [api/document/content/comments.tsp](file://api/document/content/comments.tsp#L1-L200)
- [api/shared/common.tsp](file://api/shared/common.tsp#L359-L449)

### å·¥ä½œæµï¼ˆApprovalsï¼‰
- å®¡æ‰¹å®ä¾‹ï¼šçŠ¶æ€ï¼ˆpending/approved/rejected/canceledï¼‰ã€å½“å‰èŠ‚ç‚¹ã€å†å²è®°å½•ï¼ˆèŠ‚ç‚¹IDã€æ“ä½œäººã€å†³ç­–ã€å¤‡æ³¨ã€æ—¶é—´æˆ³ï¼‰ã€‚
- æ¥å£ï¼šè·å–å®¡æ‰¹ã€å‘èµ·å®¡æ‰¹ã€å®¡æ‰¹è¯¦æƒ…ã€å®¡æ‰¹å†³ç­–ã€‚

```mermaid
stateDiagram-v2
[*] --> å¾…å®¡æ‰¹
å¾…å®¡æ‰¹ --> å·²é€šè¿‡ : "æ‰¹å‡†"
å¾…å®¡æ‰¹ --> å·²æ‹’ç» : "æ‹’ç»"
å¾…å®¡æ‰¹ --> å·²å–æ¶ˆ : "å–æ¶ˆ"
å·²é€šè¿‡ --> [*]
å·²æ‹’ç» --> [*]
å·²å–æ¶ˆ --> [*]
```

å›¾è¡¨æ¥æº
- [api/document/workflow/approvals.tsp](file://api/document/workflow/approvals.tsp#L1-L156)
- [api/shared/constants.tsp](file://api/shared/constants.tsp#L33-L86)

ç« èŠ‚æ¥æº
- [api/document/workflow/approvals.tsp](file://api/document/workflow/approvals.tsp#L1-L156)
- [api/shared/constants.tsp](file://api/shared/constants.tsp#L33-L86)

### ç§Ÿæˆ·æ–‡æ¡£ï¼ˆOrganization/Workspaceï¼‰
- **ä½œç”¨åŸŸ**ï¼šorganization/workspaceã€‚
- **æ¥å£**ï¼šç»„ç»‡çº§ä¸å·¥ä½œåŒºçº§æ–‡æ¡£èšåˆæ¥å£ã€æ–‡æ¡£åˆ—è¡¨æ¥å£ï¼Œæ”¯æŒ docType è¿‡æ»¤ã€æœç´¢ã€æ’åºã€åˆ†é¡µã€‚
- **API è·¯ç”±**ï¼š
  - ç»„ç»‡çº§ï¼š`GET /organizations/{orgId}/doc/{docType}/{docId}`
  - å·¥ä½œåŒºçº§ï¼š`GET /organizations/{orgId}/workspaces/{wsId}/doc/{docType}/{docId}`

```mermaid
sequenceDiagram
participant Client as "å®¢æˆ·ç«¯"
participant OrgAPI as "ç»„ç»‡æ–‡æ¡£æ¥å£"
participant WSAPI as "å·¥ä½œåŒºæ–‡æ¡£æ¥å£"
Client->>OrgAPI : GET /organizations/{orgId}/doc/{docType}/{docId}?include=...
OrgAPI-->>Client : è¿”å› DocBundle
Client->>WSAPI : GET /organizations/{orgId}/workspaces/{wsId}/doc/{docType}/{docId}?include=...
WSAPI-->>Client : è¿”å› DocBundle
```

å›¾è¡¨æ¥æº
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L112-L191)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L260-L345)

ç« èŠ‚æ¥æº
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L1-L120)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L112-L191)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L260-L345)

## ä¾èµ–åˆ†æ
- å•å‘ä¾èµ–åŸåˆ™ï¼šä¸Šå±‚æ¨¡å—ä¾èµ–ä¸‹å±‚æ¨¡å—ï¼›æ‰€æœ‰æ¨¡å—å‡ä¾èµ– shared åŸºç¡€å±‚ã€‚
- èšåˆæ¨¡å—ï¼ˆaggregateï¼‰ç»„åˆ core/content/workflow çš„èƒ½åŠ›ï¼Œå½¢æˆç»Ÿä¸€çš„èšåˆæŸ¥è¯¢å…¥å£ã€‚
- è®¤è¯æ¨¡å—ï¼ˆauthï¼‰ä¸ä¸šåŠ¡æ¨¡å—ï¼ˆdocumentï¼‰å‡ä¾èµ– sharedï¼Œä¿è¯é€šç”¨ç±»å‹ä¸é”™è¯¯ç çš„ä¸€è‡´æ€§ã€‚
- æ‰©å±•æ¨¡å—ï¼ˆextensionsï¼‰ä¸ä¸šåŠ¡æ¨¡å—è§£è€¦ï¼Œé€šè¿‡é¢„ç•™æ¥å£ä¸å…±äº«ç±»å‹è¿›è¡Œé›†æˆã€‚
- **ç§Ÿæˆ·ç®¡ç†æ¨¡å—ï¼ˆtenantï¼‰** ä¾èµ– shared åŸºç¡€å±‚ï¼Œä¸ºæ•´ä¸ªç³»ç»Ÿæä¾›ç”¨æˆ·ã€ç»„ç»‡ã€å·¥ä½œåŒºçš„ç®¡ç†èƒ½åŠ›ï¼Œæ˜¯å®ç°å¤šç§Ÿæˆ·åŠŸèƒ½çš„åŸºç¡€ã€‚

```mermaid
graph TB
SHARED["shared/*"]
AUTH["auth/*"]
DOC["document/*"]
CORE["document/core/*"]
CONTENT["document/content/*"]
WF["document/workflow/*"]
AGG["document/aggregate/*"]
EXT["extensions/*"]
TENANT_API["tenant/*"]
ORG["organizations.tsp"]
WS["workspaces.tsp"]
INV["invitations.tsp"]
AUTH --> SHARED
DOC --> SHARED
EXT --> SHARED
TENANT_API --> SHARED
DOC --> CORE
DOC --> CONTENT
DOC --> WF
DOC --> AGG
AGG --> CORE
AGG --> CONTENT
AGG --> WF
TENANT_API --> ORG
TENANT_API --> WS
TENANT_API --> INV
```

å›¾è¡¨æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L227-L233)
- [api/document/index.tsp](file://api/document/index.tsp#L1-L31)
- [api/document/aggregate/index.tsp](file://api/document/aggregate/index.tsp#L1-L33)
- [api/tenant/organizations.tsp](file://api/tenant/organizations.tsp#L1-L498)
- [api/tenant/workspaces.tsp](file://api/tenant/workspaces.tsp#L1-L649)

ç« èŠ‚æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L227-L233)
- [api/document/index.tsp](file://api/document/index.tsp#L1-L31)
- [api/tenant/organizations.tsp](file://api/tenant/organizations.tsp#L1-L498)

## æ€§èƒ½è€ƒè™‘
- èšåˆæŸ¥è¯¢ï¼šé€šè¿‡ include å‚æ•°æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘å¾€è¿”æ¬¡æ•°ï¼Œæå‡å‰ç«¯æ¸²æŸ“æ•ˆç‡ã€‚
- åˆ†é¡µä¸é™åˆ¶ï¼šæ•°æ®åˆ†é¡µã€è¯„è®º/ä¿®è®¢æ•°é‡é™åˆ¶ï¼Œé™ä½å¤§åˆ—è¡¨æŸ¥è¯¢çš„è´Ÿè½½ã€‚
- æ‰¹é‡æ›´æ–°ï¼šç®€åŒ–å®¢æˆ·ç«¯æäº¤ç»“æ„ï¼ŒæœåŠ¡ç«¯æ ¹æ® metadata è‡ªåŠ¨è§£æç±»å‹ï¼Œå‡å°‘é‡å¤ä¼ è¾“ä¸è½¬æ¢æˆæœ¬ã€‚
- å¹¶å‘æ§åˆ¶ï¼šç‰ˆæœ¬å·ä¹è§‚é”ï¼Œé¿å…å†²çªå¯¼è‡´çš„é‡è¯•ä¸å›æ»šå¼€é”€ã€‚

## æ•…éšœæ’æŸ¥æŒ‡å—
- ç»Ÿä¸€é”™è¯¯ç ä¸å“åº”ç»“æ„ï¼šä½¿ç”¨ shared ä¸­çš„ ApiResponse ä¸ ErrorCodeï¼Œä¾¿äºå®šä½é—®é¢˜ç±»åˆ«ï¼ˆè®¤è¯ã€æ–‡æ¡£ã€è§†å›¾ã€æ•°æ®ã€è¯„è®ºã€å®¡æ‰¹ã€è¯·æ±‚ã€ç”¨æˆ·ã€ç»„ç»‡ã€å·¥ä½œåŒºã€é‚€è¯·ã€åŠ å…¥ç”³è¯·ç­‰ï¼‰ã€‚
- è·¯ç”±ä¸ Providerï¼šç¡®è®¤ {doc-type} æ˜¯å¦å­˜åœ¨å¯¹åº” Providerï¼Œå¦åˆ™è¿”å›â€œæœªçŸ¥æ–‡æ¡£ç±»å‹â€é”™è¯¯ã€‚
- æƒé™ä¸ä½œç”¨åŸŸï¼šç»„ç»‡çº§/å·¥ä½œåŒºçº§æ–‡æ¡£éœ€æ»¡è¶³æˆå‘˜æƒé™è¦æ±‚ï¼›å®¡æ‰¹æµç¨‹éœ€æ£€æŸ¥å½“å‰èŠ‚ç‚¹ä¸æƒé™ã€‚
- å¹¶å‘å†²çªï¼šæ›´æ–°å¤±è´¥æ—¶æ£€æŸ¥ç‰ˆæœ¬å·æ˜¯å¦è¿‡æœŸï¼Œé‡æ–°æ‹‰å–æœ€æ–°æ•°æ®åé‡è¯•ã€‚

ç« èŠ‚æ¥æº
- [api/shared/common.tsp](file://api/shared/common.tsp#L80-L151)
- [api/shared/common.tsp](file://api/shared/common.tsp#L153-L177)
- [api/document/tenant-document.tsp](file://api/document/tenant-document.tsp#L112-L191)
- [api/document/workflow/approvals.tsp](file://api/document/workflow/approvals.tsp#L1-L60)

## ç»“è®º
nexusbook-api é‡‡ç”¨æ¸…æ™°çš„åˆ†å±‚æ¶æ„ä¸ä¸¥æ ¼çš„å•å‘ä¾èµ–åŸåˆ™ï¼Œshared åŸºç¡€å±‚æä¾›ç»Ÿä¸€çš„ç±»å‹ä¸é”™è¯¯æ¨¡å‹ï¼Œauth ä¿éšœå®‰å…¨è®¿é—®ï¼Œdocument ä¸šåŠ¡å±‚å›´ç»•æ–‡æ¡£æŠ½è±¡æä¾›æ ¸å¿ƒæ•°æ®ã€åä½œä¸å·¥ä½œæµèƒ½åŠ›ï¼Œextensions æä¾›å¯æ‰©å±•çš„é›†æˆèƒ½åŠ›ã€‚Provider æ¨¡å¼ä¸èšåˆæŸ¥è¯¢è¿›ä¸€æ­¥æå‡äº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ä¸æ˜“ç”¨æ€§ï¼Œç¬¦åˆé«˜å†…èšã€ä½è€¦åˆçš„è®¾è®¡ç›®æ ‡ã€‚**æœ¬æ¬¡æ›´æ–°å¼•å…¥çš„ç§Ÿæˆ·ç®¡ç†å±‚ï¼ˆtenantï¼‰é€šè¿‡ Organizationã€Workspace å’Œ DataSourceReference æ¨¡å‹ï¼Œå®ç°äº†å¼ºå¤§çš„å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»ä¸å…±äº«èƒ½åŠ›ï¼Œå¹¶é€šè¿‡ç²¾ç»†çš„åŸºäºè§’è‰²çš„æƒé™çŸ©é˜µï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ä¸çµæ´»æ€§ã€‚**

## é™„å½•
- è®¾è®¡åŸåˆ™ï¼šåˆ†å±‚æ¶æ„ã€å•ä¸€èŒè´£ã€ä¾èµ–ç®¡ç†ã€å¯æ‰©å±•æ€§ã€æ¨¡å—åŒ–ã€‚
- æ¨¡å—èŒè´£æ¦‚è§ˆï¼šsharedï¼ˆåŸºç¡€è®¾æ–½ï¼‰ã€authï¼ˆè®¤è¯æˆæƒï¼‰ã€document/coreï¼ˆæ ¸å¿ƒæ•°æ®ï¼‰ã€document/contentï¼ˆå†…å®¹åä½œï¼‰ã€document/workflowï¼ˆå·¥ä½œæµï¼‰ã€document/aggregateï¼ˆèšåˆæŸ¥è¯¢ï¼‰ã€extensionsï¼ˆæ‰©å±•åŠŸèƒ½ï¼‰ã€tenantï¼ˆç§Ÿæˆ·ç®¡ç†ï¼‰ã€‚

ç« èŠ‚æ¥æº
- [docs-src/guides/architecture.md](file://docs-src/guides/architecture.md#L234-L253)